<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Handling different Android versions with strategy pattern · Piotr Wittchen</title><meta name="description" content="Handling different Android versions with strategy pattern - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">WRITING</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Handling different Android versions with strategy pattern</h1><div class="post-info">Mar 26, 2017</div><div class="post-content"><p>When we’re developing Android apps, we have to remember that different users have different versions of the Android OS. Unfortunately, not all of them has the newest version of the system and some of them have older devices with older systems. Some of these devices may be even unsupported because e.g. Google supports their devices like Nexus and Pixel for only 2 years. When we want to reach as many users as possible and make the app available for almost everyone, we have to handle different Android versions. One of the solutions for that problem is <strong>strategy design pattern</strong> (it’s also called Policy in Domain-Driven Design). I’m developing an Android open-source library called <a href="https://github.com/pwittchen/ReactiveNetwork" target="_blank" rel="noopener">ReactiveNetwork</a>, which is used for monitoring connectivity with the network in the system. Network monitoring strategies vary between different versions of Android and I wanted to choose an appropriate strategy for appropriate Android version. To do so, I’ve created <code>NetworkObservingStrategy</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NetworkObservingStrategy</span> </span>&#123;</span><br><span class="line">  <span class="function">Observable <span class="title">observeNetworkConnectivity</span><span class="params">(<span class="keyword">final</span> Context context)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">onError</span><span class="params">(<span class="keyword">final</span> String message, <span class="keyword">final</span> Exception exception)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This interface can have many implementations like <code>LollipopNetworkObservingStrategy</code>, <code>PreLollipopNetworkObservingStrategy</code> and <code>MarshmallowNetworkObservingStrategy</code>. Morever, more implementations can be added in the future. After that, we can choose a valid strategy for the concrete version of the system:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Observable&lt;Connectivity&gt; <span class="title">observeNetworkConnectivity</span><span class="params">(<span class="keyword">final</span> Context context)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> NetworkObservingStrategy strategy;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (Preconditions.isAtLeastAndroidMarshmallow()) &#123;</span><br><span class="line">    strategy = <span class="keyword">new</span> MarshmallowNetworkObservingStrategy();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Preconditions.isAtLeastAndroidLollipop()) &#123;</span><br><span class="line">    strategy = <span class="keyword">new</span> LollipopNetworkObservingStrategy();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    strategy = <span class="keyword">new</span> PreLollipopNetworkObservingStrategy();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> strategy.observeNetworkConnectivity(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>That’s it. Now, we have the separate code working for Android M, L and all devices with system version lower than L. This approach can also be applied to other areas.</p>
</div></article></div></main><footer><div class="paginator"><a href="/how-to-make-open-source-projects-which-people-want-to-use/" class="prev">PREV</a><a href="/review-your-changes-before-the-commit/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'handling-different-android-versions-with-strategy-pattern/';
var disqus_title = 'Handling different Android versions with strategy pattern';
var disqus_url = 'http://wittchen.io/handling-different-android-versions-with-strategy-pattern/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2019 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io" target="_blank" rel="noopener">source</a> / <a href="/feed.xml">rss</a> / <a href="/archives">archives</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest" target="_blank" rel="noopener">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>