<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Emitting different observables conditionally · Piotr Wittchen</title><meta name="description" content="Emitting different observables conditionally - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"><link rel="alternate" href="/feed.xml" title="Piotr Wittchen" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">WRITING</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Emitting different observables conditionally</h1><div class="post-info">May 14, 2017</div><div class="post-content"><p>Sometimes, we may need to emit different RxJava Observables depending on the specific condition dynamically. Moreover, it’s good to do it right without breaking a chain (stream of Observables). We want to combine different Observables together and do not want to nest one subscription inside another subscription because this will lead us to “subscription hell” similar to “callback hell”. Luckily RxJava has mechanisms to deal with such problems. In this article, I’m basing my examples on RxJava 2.1.0. Let’s say we have two Observables:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Observable&lt;String&gt; <span class="title">trueObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Observable.fromCallable(() -&gt; <span class="string">"trueObservable"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Observable&lt;String&gt; <span class="title">falseObservable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Observable.fromCallable(() -&gt; <span class="string">"falseObservable"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and we have another Observable wrapping <code>Boolean</code> value:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Observable&lt;Boolean&gt; <span class="title">createCondition</span><span class="params">(<span class="keyword">boolean</span> returnedValue)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Observable.fromCallable(() -&gt; returnedValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This Observable can emit <code>true</code> or <code>false</code> depending on the provided parameter. What we want to do is to:</p>
<ul>
<li>emit <code>trueObservable()</code> when <code>createCondition(boolean)</code> returns <code>true</code></li>
<li>emit <code>falseObservable()</code> when <code>createCondition(boolean)</code> returns <code>false</code></li>
<li>emit <code>falseObservable()</code> when <code>createCondition(boolean)</code> emits empty Observable (default behaviour)</li>
</ul>
<p>We can do it in the following way:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Observable&lt;String&gt; <span class="title">emitTrueObservableDynamically</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createCondition(<span class="keyword">true</span>)</span><br><span class="line">      .defaultIfEmpty(<span class="keyword">false</span>)</span><br><span class="line">      .flatMap(condition -&gt; condition ? trueObservable() : falseObservable());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In such case, this method will emit <code>trueObservable()</code>. When we change parameter of the <code>createCondition(boolean)</code> method to false, Observable will emit <code>falseObservable()</code>. When we replace <code>createCondition(boolean)</code> method with <code>Observable.empty()</code>, method will return <code>falseObservable()</code> by default. As we can see, it’s easily solved with <a href="http://reactivex.io/documentation/operators/flatmap.html" target="_blank" rel="noopener">flatMap</a> and <a href="http://reactivex.io/documentation/operators/defaultifempty.html" target="_blank" rel="noopener">defaultIfEmpty</a> operators. This is quite useful technique, which we can apply to reactive applications to control our flow without breaking the chain. Please note, it’s just an example you can create more complicated constructions and handle more complicated types than just boolean and more than two use cases.</p>
<hr>
<p>Reference thread for this article on StackOverflow: <a href="http://stackoverflow.com/questions/34195218/rxjava-exequte-observable-only-if-first-was-empty" target="_blank" rel="noopener">http://stackoverflow.com/questions/34195218/rxjava-exequte-observable-only-if-first-was-empty</a>.</p>
</div></article></div></main><footer><div class="paginator"><a href="/joining-lists-of-rxjava-observables/" class="prev">PREV</a><a href="/basic-code-refactoring-principles/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'emitting-different-rxjava-observables-depending-on-the-condition-with-flatmap/';
var disqus_title = 'Emitting different observables conditionally';
var disqus_url = 'http://wittchen.io/emitting-different-rxjava-observables-depending-on-the-condition-with-flatmap/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2020 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io">source</a> / <a href="https://stats.uptimerobot.com/ZwxAGU5rxy">uptime</a> / <a href="/feed.xml">rss</a> / <a href="/archives">writing</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>