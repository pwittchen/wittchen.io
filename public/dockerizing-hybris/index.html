<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Dockerizing Hybris · Piotr Wittchen</title><meta name="description" content="Dockerizing Hybris - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">WRITING</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Dockerizing Hybris</h1><div class="post-info">Jul 27, 2016</div><div class="post-content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>A few months ago, I started work at <a href="http://hybris.com/" target="_blank" rel="noopener">Hybris</a>, which was acquired by SAP, so our “division” is officially called SAP Hybris. I work in a team developing an extension for Hybris platform with assisting extensions and internal framework. There are many teams around the world developing their own extensions, which are finally integrated and packed into Commerce Suite provided to the clients and partners. We have our own development environment, but sometimes there’s need to build and run whole Commerce Suite in the case of system tests, bug reproduction, verification, etc. It’s not really hard, but you have to know what to do and you have to perform a lot of steps manually. This is kind of old approach in present days. Moreover, it’s really big project, so build and initialization process takes time. You have to download huge zipped package, unpack it, run Gradle script with installation recipe, compile project, run initialization and finally start the server.</p>
<h2 id="Automating-work"><a href="#Automating-work" class="headerlink" title="Automating work"></a>Automating work</h2><p>I wondered if it’s possible to automate mentioned process. Moreover, I wanted to learn more about <a href="https://www.docker.com/" target="_blank" rel="noopener">Docker</a> and create more advanced <code>Dockerfile</code> than “hello world”, which will be real life use case. That’s why I decided to dockerize SAP Hybris Commerce Suite. I called this project <a href="https://github.com/pwittchen/ydocker" target="_blank" rel="noopener"><strong>ydocker</strong></a> and you can find it at <a href="https://github.com/pwittchen/ydocker" target="_blank" rel="noopener">https://github.com/pwittchen/ydocker</a>. Before you start doing anything, you need to remember to install Docker on your system. You can check out my notes about <a href="https://github.com/pwittchen/learning-docker#installation-on-linux" target="_blank" rel="noopener">installation Docker on Linux</a> in <a href="https://github.com/pwittchen/learning-docker" target="_blank" rel="noopener">learning-docker</a> repository. <strong>Note #1</strong>: <strong>It’s not official company solution</strong> yet. Right now it’s just my personal proof of concept. <strong>Note #2</strong>: I had problems with building and running this Docker container on OS X and I haven’t tested it on MS Windows. These systems need to use boot2docker, Docker Toolbox or another approach like that. <strong>I had no problems with it on Linux (Ubuntu 14.04 LTS)</strong>, so this system is recommended if you want to build and run this container successfully. Probably other Linux distributions or Ubuntu versions will handle this as well. <strong>Note #3 (update from 01.10.2016)</strong>: Guys working on Docker improved their software for Mac, so it should work without any problems on this system now. It was tested on OS X El Capitan 10.11.6 and works fine. We just need to get <a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="noopener">Docker for Mac</a>.</p>
<h2 id="Building-Docker-container"><a href="#Building-Docker-container" class="headerlink" title="Building Docker container"></a>Building Docker container</h2><p>Except for <code>Dockerfile</code>, ydocker repository also contains helper script <code>ydocker</code>, which has the following parameters:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-b    building Docker container</span><br><span class="line">-r    running Hybris Server in Docker container</span><br><span class="line">-c    running Docker container with CLI</span><br><span class="line">-i    showing info about Docker container</span><br><span class="line">-u    showing Commerce Suite Download Url</span><br><span class="line">-d    deleting Docker container</span><br><span class="line">-h    showing help</span><br></pre></td></tr></table></figure>

<p>This script uses configuration file <code>ydocker.conf</code>, which has the following contents:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DOCKER_IMAGE_NAME=sap-hybris-commerce-suite</span><br><span class="line">COMMERCE_SUITE_VERSION=latest</span><br><span class="line">RECIPE=b2c_acc</span><br><span class="line">HOST_PORT=9002</span><br><span class="line">CONTAINER_PORT=9002</span><br></pre></td></tr></table></figure>

<p>You can customize this configuration. E.g. choose a different version of the suite, different recipe or change server port.<br>To build container, you can just type:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ydocker -b</span><br></pre></td></tr></table></figure>

<p>Then, provide your credentials and Docker will:</p>
<ol>
<li>create container based on Ubuntu</li>
<li>install Java 8</li>
<li>set Java 8 as default Java version</li>
<li>install wget</li>
<li>download SAP Hybris Commerce Suite via wget</li>
<li>unpack downloaded SAP Hybris Commerce Suite</li>
<li>remove downloaded zipped package to save some disk space</li>
<li>run configured installation recipe</li>
<li>compile the project</li>
<li>run system initialization</li>
</ol>
<p>It may take some time. If you have good hardware setup it may take about 30 minutes.</p>
<h2 id="Running-Docker-container"><a href="#Running-Docker-container" class="headerlink" title="Running Docker container"></a>Running Docker container</h2><p>When everything is done, you can run docker image, with the command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ydocker -r</span><br></pre></td></tr></table></figure>

<p>After that, Docker will start the server at <code>localhost</code> (<code>127.0.0.1</code>) and port <code>9002</code>, which is exposed. Commerce Suite will be started in a default configuration, which is not production ready, but is good for testing and demonstration purposes. You need to wait for a few minutes to let the server warm up and then you can open administration console from the browser at <code>http://127.0.0.1:9002</code>. In addition, if you want to browse generated configuration or unpacked suite, you can run Docker container with CLI with the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ydocker -c</span><br></pre></td></tr></table></figure>

<p>It won’t start the server, but allow you to take a look around container via terminal.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>That’s it! This proof of concept shows that we can get, build and run complicated and a huge project like SAP Hybris Commerce Suite inside Docker container, automate a lot of manual work and transform old school manual deployment and build process into elegant and standardized Docker container.</p>
</div></article></div></main><footer><div class="paginator"><a href="/lifting-quality-of-a-shell-script/" class="prev">PREV</a><a href="/reactive-network-2/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'dockerizing-hybris/';
var disqus_title = 'Dockerizing Hybris';
var disqus_url = 'http://wittchen.io/dockerizing-hybris/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2019 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io" target="_blank" rel="noopener">source</a> / <a href="https://stats.uptimerobot.com/ZwxAGU5rxy" target="_blank" rel="noopener">uptime</a> / <a href="/feed.xml">rss</a> / <a href="/archives">writing</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest" target="_blank" rel="noopener">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>