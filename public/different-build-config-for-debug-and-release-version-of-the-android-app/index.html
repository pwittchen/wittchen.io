<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Different build config for debug and release version of the Android app · Piotr Wittchen</title><meta name="description" content="Different build config for debug and release version of the Android app - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"><link rel="alternate" href="/feed.xml" title="Piotr Wittchen" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">WRITING</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Different build config for debug and release version of the Android app</h1><div class="post-info">Oct 8, 2014</div><div class="post-content"><p>Sometimes we may want to set different address of the back-end web service for debuggable and release version of our Android app. E.g. predefined static host and port for release version of the application and our local IP address and predefined port for debuggable version of the application. In second case, we can deploy back-end webservice on our local machine for testing purposes. We can customize all of that in build.gradle file. We can use <code>variant.buildType.isDebuggable()</code> instruction to check build type of the app. I described way of <a href="http://blog.wittchen.biz.pl/updating-android-xml-resources-dynamically-before-compilation-via-gradle/" target="_blank" rel="noopener">Updating Android XML resources before compilation via Gradle</a> in <a href="http://blog.wittchen.biz.pl/updating-android-xml-resources-dynamically-before-compilation-via-gradle/" target="_blank" rel="noopener">one of my previous posts</a>, so you can check it if you don’t understand <code>replaceBackendAddressInResources(variant, host, port)</code> method. After proper configuration, setting of the back-end url is straightforward. Please check the code between <code>// configuration of the back-end address - begin</code> and <code>// configuration of the back-end address - end</code> comments. </p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat</span><br><span class="line">apply plugin: <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">20</span></span><br><span class="line">    buildToolsVersion <span class="string">'20.0.0'</span></span><br><span class="line"></span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        <span class="keyword">sourceCompatibility</span> JavaVersion.VERSION_1_7</span><br><span class="line">        <span class="keyword">targetCompatibility</span> JavaVersion.VERSION_1_7</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lintOptions &#123;</span><br><span class="line">        abortOnError <span class="keyword">false</span></span><br><span class="line">        disable <span class="string">'MissingTranslation'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">"com.android.app"</span></span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">19</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName gitSha() + <span class="string">'-'</span> + buildTime()</span><br><span class="line">        testInstrumentationRunner <span class="string">"com.google.android.apps.common.testing.testrunner.GoogleInstrumentationTestRunner"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            runProguard <span class="keyword">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">            signingConfig signingConfigs.releaseConfig</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// configuration of the back-end address - begin</span></span><br><span class="line"></span><br><span class="line">    applicationVariants.all &#123; variant -&gt;</span><br><span class="line">        variant.mergeResources.<span class="keyword">doLast</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(variant.buildType.isDebuggable()) &#123;</span><br><span class="line">                replaceBackendAddressInResources(variant, obtainLocalIpAddress(), <span class="string">"8443"</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                replaceBackendAddressInResources(variant, <span class="string">"PUT YOUR PRODUCTION SERVER ADRESS HERE"</span>, <span class="string">"PRODUCTION PORT"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// configuration of the back-end address - end</span></span><br><span class="line"></span><br><span class="line">    packagingOptions &#123;</span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/DEPENDENCIES.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/LICENSE.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'LICENSE.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/NOTICE.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/NOTICE'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/LICENSE'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/DEPENDENCIES'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/notice.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/license.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/dependencies.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/LGPL2.1'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'ASL-2.0.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'LGPL-3.0.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/ASL-2.0.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/LGPL-3.0.txt'</span></span><br><span class="line">        <span class="keyword">exclude</span> <span class="string">'META-INF/services/javax.annotation.processing.Processor'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> replaceBackendAddressInResources(variant, host, port) &#123;</span><br><span class="line">    <span class="comment">// replace the #const_backend_url# with your specific ip address</span></span><br><span class="line">    <span class="keyword">def</span> protocol = <span class="string">"https://"</span></span><br><span class="line">    <span class="keyword">def</span> backendAddress = protocol + host + <span class="string">":"</span> + port + <span class="string">"/"</span></span><br><span class="line">    <span class="keyword">File</span> valuesFile = <span class="keyword">file</span>(<span class="string">"$&#123;buildDir&#125;/intermediates/res/$&#123;variant.dirName&#125;/values/values.xml"</span>)</span><br><span class="line">    <span class="keyword">if</span> (valuesFile.exists()) &#123;</span><br><span class="line">        String content = valuesFile.<span class="keyword">getText</span>(<span class="string">'UTF-8'</span>)</span><br><span class="line">        content = content.replaceAll(<span class="string">"#const_backend_url#"</span>, backendAddress)</span><br><span class="line">        valuesFile.<span class="keyword">write</span>(content, <span class="string">'UTF-8'</span>)</span><br><span class="line">        <span class="keyword">println</span>(<span class="string">"Replacing #const_backend_url# with "</span> + backendAddress + <span class="string">" in file: "</span> + valuesFile.name)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">println</span>(<span class="string">"File: "</span> + valuesFile.path + <span class="string">" does not exist"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> obtainLocalIpAddress() &#123;</span><br><span class="line">    InetAddress inetAddress = InetAddress.getLocalHost();</span><br><span class="line">    <span class="keyword">byte</span>[] address = inetAddress.getAddress();</span><br><span class="line">    String ipAddress = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; address.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            ipAddress += <span class="string">"."</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ipAddress += address[i] &amp; <span class="number">0</span>xFF;</span><br><span class="line">    &#125;</span><br><span class="line">    ipAddress</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> buildTime() &#123;</span><br><span class="line">    <span class="keyword">def</span> df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmss"</span>)</span><br><span class="line">    df.setTimeZone(TimeZone.getTimeZone(<span class="string">"Europe/Warsaw"</span>))</span><br><span class="line">    <span class="keyword">return</span> df.format(<span class="keyword">new</span> Date())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> gitSha() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'git rev-parse --short HEAD'</span>.execute().text.trim()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, you can create release and debug version of the app with different addresses of the web service what is very useful during the process of development and deployment of the project. We can use this trick also for setting different parameters depending on our needs.</p>
</div></article></div></main><footer><div class="paginator"><a href="/the-future-of-programming/" class="prev">PREV</a><a href="/weather-icons-for-android-applications/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'different-build-config-for-debug-and-release-version-of-the-android-app/';
var disqus_title = 'Different build config for debug and release version of the Android app';
var disqus_url = 'http://wittchen.io/different-build-config-for-debug-and-release-version-of-the-android-app/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2020 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io">source</a> / <a href="https://stats.uptimerobot.com/ZwxAGU5rxy">uptime</a> / <a href="/feed.xml">rss</a> / <a href="/archives">writing</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>