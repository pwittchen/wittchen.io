<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Introduction #  I recently I had an opportunity to join &ldquo;Kyma meets CCV2 Hackathon&rdquo; in the SAP Labs Poland office in Gliwice. The goal of the hackathon was to create a simple project, which will use Kyma to integrate external services with the SAP Hybris Commerce Platform. CCV2 stands for &ldquo;Commerce Cloud Version 2&rdquo;, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that&rsquo;s a long story described in a short way).">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Kyma meets CCV2 hackathon summary" />
<meta property="og:description" content="Introduction #  I recently I had an opportunity to join &ldquo;Kyma meets CCV2 Hackathon&rdquo; in the SAP Labs Poland office in Gliwice. The goal of the hackathon was to create a simple project, which will use Kyma to integrate external services with the SAP Hybris Commerce Platform. CCV2 stands for &ldquo;Commerce Cloud Version 2&rdquo;, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that&rsquo;s a long story described in a short way)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://wittchen.io/posts/kyma-meets-ccv2-hackathon-summary/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-14T14:34:01+00:00" />
<meta property="article:modified_time" content="2020-08-15T18:09:42+02:00" />

<title>Kyma meets CCV2 hackathon summary | Piotr Wittchen</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css" integrity="sha256-gsXb0jRHzuC0wqo&#43;0Izglh&#43;qQOH6Nw7uT4yfAuDUa18=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.085fb702e65f15a4a9d3ec2a4fa5600d67d3df36eeef61231b361cb5479aff43.js" integrity="sha256-CF&#43;3AuZfFaSp0&#43;wqT6VgDWfT3zbu72EjGzYctUea/0M=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Piotr Wittchen</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  <ul>
<li><a href="/">About</a></li>
<li><a href="/posts/">Posts</a></li>
<li><a href="/gh/">Code</a></li>
<li><a href="/talks/">Talks</a></li>
<li><a href="/contact/">Contact</a></li>
</ul>










</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Kyma meets CCV2 hackathon summary</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#application-overview">Application overview</a></li>
    <li><a href="#creating-a-microservice">Creating a microservice</a></li>
    <li><a href="#deployment-of-the-microservice">Deployment of the microservice</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/kyma-meets-ccv2-hackathon-summary/">Kyma meets CCV2 hackathon summary</a>
  </h1>
  
  <h5>Dec 14, 2018</h5>



  
  <div>
    
      <a href="/tags/kotlin/">kotlin</a>
  </div>
  



<h2 id="introduction">
  Introduction
  <a class="anchor" href="#introduction">#</a>
</h2>
<p>I recently I had an opportunity to join &ldquo;Kyma meets CCV2 Hackathon&rdquo; in the <a href="https://www.sap.com/poland/index.html">SAP Labs Poland</a> office in Gliwice. The goal of the hackathon was to create a simple project, which will use <a href="https://github.com/kyma-project/kyma">Kyma</a> to integrate external services with the <a href="https://cx.sap.com/en/products/commerce">SAP Hybris Commerce Platform</a>. CCV2 stands for &ldquo;Commerce Cloud Version 2&rdquo;, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that&rsquo;s a long story described in a short way). I joined a team consisting of people from a few different departments in the office, so we didn&rsquo;t actually know each other before the event. We decided to create a simple application consisting of a few microservices, which will send an e-mail with a promotional link to the user once he or she add something to the cart in the on-line shop. After clicking on the link sent via the e-mail, user will be redirected to the front-end application, where he or she has to click on the button as many times as possible in a given period of time.</p>
<p><img src="/posts/2018/kyma-meets-ccv2-hackathon-summary/clickr_frontend.png" alt="" /></p>
<p>The more clicks were performed, the higher discount user will get, but not higher than 20%. When game is finished, front-end application is sending a request to the voucher service from which we can retrieve a promotional code.</p>
<p><img src="/posts/2018/kyma-meets-ccv2-hackathon-summary/clickr_frontend2.png" alt="" /></p>
<p>With this code, we can go to the SAP Hybris Commerce store-front&hellip;</p>
<p><img src="/posts/2018/kyma-meets-ccv2-hackathon-summary/storefront1.png" alt="" /></p>
<p>&hellip;and get our discount!</p>
<p><img src="posts/2018/kyma-meets-ccv2-hackathon-summary/storefront2.png" alt="" /></p>
<h2 id="application-overview">
  Application overview
  <a class="anchor" href="#application-overview">#</a>
</h2>
<p>General concept of the application flow is presented on the diagram below.</p>
<p><img src="/posts/2018/kyma-meets-ccv2-hackathon-summary/diagram.png" alt="" /></p>
<p>We decided to create three microservices:</p>
<ul>
<li>mailing service written in Node.js</li>
<li>front-end application with clicking game written in JavaScript</li>
<li>voucher service written in Kotlin</li>
</ul>
<p>All microservices needed to have corresponsing Docker containers, which were deployed to the Kyma instance. Kyma was communicating with SAP Hybris Commerce platform written in Java. Thanks to clear separation of a different environments, we were able to integrate services using different technologies.</p>
<h2 id="creating-a-microservice">
  Creating a microservice
  <a class="anchor" href="#creating-a-microservice">#</a>
</h2>
<p>I was responsible for writing voucher storage microservice. On daily basis I use Java programming language, but I wanted to try something new, so I chose Kotlin. Kotlin is a JVM language, so it runs on the same runtime as regular Java applications. Moreover, I could use tools I&rsquo;m familiar with like IntelliJ, Gradle, etc. In my microservice I used <a href="https://gradle.org/">Gradle</a> as a build tool, <a href="http://javalin.io/">Javalin</a> for designing REST API and <a href="https://github.com/google/dagger">Dagger</a> for Dependency Injection. Moreover, for writing unit tests I used <a href="https://junit.org">JUnit</a>, <a href="https://github.com/Pragmatists/JUnitParams">JUnitParams</a>, <a href="https://github.com/google/truth">Truth</a> and <a href="https://github.com/mockito/mockito">Mockito</a>. I also wrote a few integration tests for the API with <a href="https://github.com/rest-assured/rest-assured">REST Assured</a>. As you can see, I could easily use Java libraries in the Kotlin application because those two languages are fully interoperable.</p>
<p>REST API definition of my application looks pretty simple:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Application</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">companion</span> <span style="color:#66d9ef">object</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> logger = LoggerFactory.getLogger(Application<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> component = DaggerApplicationComponent.create()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> voucherController = component.voucherController()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> voucherHttpFacade = component.voucherHttpFacade()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@JvmStatic</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>(args: Array&lt;String&gt;) {
</span></span><span style="display:flex;"><span>      Javalin
</span></span><span style="display:flex;"><span>          .create()
</span></span><span style="display:flex;"><span>          .enableCorsForAllOrigins()
</span></span><span style="display:flex;"><span>          .requestLogger { ctx, time <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>            logger.info(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${ctx.method()}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${ctx.path()}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${ctx.status()}</span><span style="color:#e6db74"> took </span><span style="color:#e6db74">$time</span><span style="color:#e6db74"> ms&#34;</span>)
</span></span><span style="display:flex;"><span>          }.routes {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;/voucher&#34;</span>) { voucherHttpFacade.getAll(<span style="color:#66d9ef">it</span>) }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;/voucher/:group&#34;</span>) { voucherHttpFacade.getGroup(<span style="color:#66d9ef">it</span>) }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;/health&#34;</span>) { <span style="color:#66d9ef">it</span>.json(Health(<span style="color:#e6db74">&#34;UP&#34;</span>)).status(HttpStatus.OK_200) }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#34;/&#34;</span>) { <span style="color:#66d9ef">it</span>.status(HttpStatus.FORBIDDEN_403) }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          .event(JavalinEvent.SERVER_STARTING) { voucherController.loadVouchers() }
</span></span><span style="display:flex;"><span>          .start(<span style="color:#ae81ff">7000</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I have an endpoint for gathering all vouchers, gathering single voucher for a given group and deactivating it and health-check. In addition, I&rsquo;m loading all the vouchers into the application memory on the server startup using <a href="https://kotlinlang.org/docs/reference/coroutines-overview.html">Kotlin coroutine</a> under the hood asynchronously.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">loadVouchers</span>() {
</span></span><span style="display:flex;"><span>  GlobalScope.async { loadVouchersFromAllGroups() }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Application can be build with Gradle as follows:</p>
<pre tabindex="0"><code>./gradlew build
</code></pre><p>I&rsquo;m using <a href="https://github.com/johnrengelman/shadow">Shadow Gradle plugin</a> to create fat jar. Once, build is finished, I can start the application with embdedded Jetty HTTP server on the port 7000.</p>
<pre tabindex="0"><code>java -jar build/libs/app-1.0-all.jar
</code></pre><p>You can find source code of the whole application at: <a href="https://github.com/pwittchen/voucher-storage-service">https://github.com/pwittchen/voucher-storage-service</a>.</p>
<h2 id="deployment-of-the-microservice">
  Deployment of the microservice
  <a class="anchor" href="#deployment-of-the-microservice">#</a>
</h2>
<p>In order to deploy the microservice to the Kyma, I needed to prepare <code>Dockerfile</code>, which looks as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> openjdk:8-jre-alpine</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">MAINTAINER</span><span style="color:#e6db74"> pwittchen</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> build/libs/app-1.0-all.jar .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> ls -la /app<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> java -jar app-1.0-all.jar<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>It&rsquo;s just a lightweight Alpine Linux with Java 8 and Kotlin application compiled into fat jar.</p>
<p>To build the container, I invoked command:</p>
<pre tabindex="0"><code>sudo docker build -t pwittchen/voucher-storage-service .
</code></pre><p>and to run it, I invoked command:</p>
<pre tabindex="0"><code>sudo docker run -p 127.0.0.1:7000:7000 -t pwittchen/voucher-storage-service
</code></pre><p>I also pushed it to the <a href="https://hub.docker.com/r/pwittchen/voucher-storage-service/">docker hub</a> because Kyma gets required containers from there.</p>
<p>Next, I created <code>deployment.yml</code> file for Kubernetess, which is used by Kyma under the hood.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">extensions/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">voucher-storage-service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">voucher-storage-service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">voucher-storage-service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">voucher-storage-service</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">web</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker.io/pwittchen/voucher-storage-service:latest</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">7000</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">voucher-storage-service</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">voucher-storage-service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">http</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">7000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">voucher-storage-service</span>
</span></span></code></pre></div><p>Such configuration had to be provided for Kyma by all microservices.</p>
<h2 id="summary">
  Summary
  <a class="anchor" href="#summary">#</a>
</h2>
<p>Once, we deployed all the microservices and tested the whole flow, we needed to apply a few adjustments. When issues were fixed, whole application worked correctly. This proves that external services written in different technologies can be integrated with SAP Hybris Commerce using Kyma. This hackathon was pretty nice experience, learning opportunity and productive distraction from daily projects. Moreover, our team won the whole event ex aequo with another team located in Germany. Thanks to this hackathon, I have better understanding of Kyma and integration tooling for the SAP Hybris Commerce platform.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/pwittchen/wittchen.io/commit/d00fe6d9b20b9e5911002fc6f5b17542dafb3520" title='Last modified by Piotr Wittchen | Aug 15, 2020' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>Aug 15, 2020</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/pwittchen/wittchen.io/edit/master/content/content/posts/kyma-meets-ccv2-hackathon-summary.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#application-overview">Application overview</a></li>
    <li><a href="#creating-a-microservice">Creating a microservice</a></li>
    <li><a href="#deployment-of-the-microservice">Deployment of the microservice</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












