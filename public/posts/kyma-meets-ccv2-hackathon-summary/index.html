<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kyma meets CCV2 hackathon summary | Piotr Wittchen</title>
<meta name=keywords content="kotlin"><meta name=description content="Introduction
I recently I had an opportunity to join &ldquo;Kyma meets CCV2 Hackathon&rdquo; in the SAP Labs Poland office in Gliwice. The goal of the hackathon was to create a simple project, which will use Kyma to integrate external services with the SAP Hybris Commerce Platform. CCV2 stands for &ldquo;Commerce Cloud Version 2&rdquo;, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that&rsquo;s a long story described in a short way). I joined a team consisting of people from a few different departments in the office, so we didn&rsquo;t actually know each other before the event. We decided to create a simple application consisting of a few microservices, which will send an e-mail with a promotional link to the user once he or she add something to the cart in the on-line shop. After clicking on the link sent via the e-mail, user will be redirected to the front-end application, where he or she has to click on the button as many times as possible in a given period of time."><meta name=author content="Piotr Wittchen"><link rel=canonical href=https://wittchen.io/posts/kyma-meets-ccv2-hackathon-summary/><link crossorigin=anonymous href=/assets/css/stylesheet.4a824105f186decca41ccc96dd9047842de7c7350551e0447bbf802e4461e6c7.css integrity="sha256-SoJBBfGG3sykHMyW3ZBHhC3nxzUFUeBEe7+ALkRh5sc=" rel="preload stylesheet" as=style><link rel=icon href=https://wittchen.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wittchen.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wittchen.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wittchen.io/apple-touch-icon.png><link rel=mask-icon href=https://wittchen.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wittchen.io/posts/kyma-meets-ccv2-hackathon-summary/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://wittchen.io/posts/kyma-meets-ccv2-hackathon-summary/"><meta property="og:site_name" content="Piotr Wittchen"><meta property="og:title" content="Kyma meets CCV2 hackathon summary"><meta property="og:description" content="Introduction I recently I had an opportunity to join “Kyma meets CCV2 Hackathon” in the SAP Labs Poland office in Gliwice. The goal of the hackathon was to create a simple project, which will use Kyma to integrate external services with the SAP Hybris Commerce Platform. CCV2 stands for “Commerce Cloud Version 2”, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that’s a long story described in a short way). I joined a team consisting of people from a few different departments in the office, so we didn’t actually know each other before the event. We decided to create a simple application consisting of a few microservices, which will send an e-mail with a promotional link to the user once he or she add something to the cart in the on-line shop. After clicking on the link sent via the e-mail, user will be redirected to the front-end application, where he or she has to click on the button as many times as possible in a given period of time."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-12-14T14:34:01+00:00"><meta property="article:modified_time" content="2018-12-14T14:34:01+00:00"><meta property="article:tag" content="Kotlin"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kyma meets CCV2 hackathon summary"><meta name=twitter:description content="Introduction
I recently I had an opportunity to join &ldquo;Kyma meets CCV2 Hackathon&rdquo; in the SAP Labs Poland office in Gliwice. The goal of the hackathon was to create a simple project, which will use Kyma to integrate external services with the SAP Hybris Commerce Platform. CCV2 stands for &ldquo;Commerce Cloud Version 2&rdquo;, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that&rsquo;s a long story described in a short way). I joined a team consisting of people from a few different departments in the office, so we didn&rsquo;t actually know each other before the event. We decided to create a simple application consisting of a few microservices, which will send an e-mail with a promotional link to the user once he or she add something to the cart in the on-line shop. After clicking on the link sent via the e-mail, user will be redirected to the front-end application, where he or she has to click on the button as many times as possible in a given period of time."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wittchen.io/posts/"},{"@type":"ListItem","position":2,"name":"Kyma meets CCV2 hackathon summary","item":"https://wittchen.io/posts/kyma-meets-ccv2-hackathon-summary/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kyma meets CCV2 hackathon summary","name":"Kyma meets CCV2 hackathon summary","description":"Introduction I recently I had an opportunity to join \u0026ldquo;Kyma meets CCV2 Hackathon\u0026rdquo; in the SAP Labs Poland office in Gliwice. The goal of the hackathon was to create a simple project, which will use Kyma to integrate external services with the SAP Hybris Commerce Platform. CCV2 stands for \u0026ldquo;Commerce Cloud Version 2\u0026rdquo;, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that\u0026rsquo;s a long story described in a short way). I joined a team consisting of people from a few different departments in the office, so we didn\u0026rsquo;t actually know each other before the event. We decided to create a simple application consisting of a few microservices, which will send an e-mail with a promotional link to the user once he or she add something to the cart in the on-line shop. After clicking on the link sent via the e-mail, user will be redirected to the front-end application, where he or she has to click on the button as many times as possible in a given period of time.\n","keywords":["kotlin"],"articleBody":"Introduction I recently I had an opportunity to join “Kyma meets CCV2 Hackathon” in the SAP Labs Poland office in Gliwice. The goal of the hackathon was to create a simple project, which will use Kyma to integrate external services with the SAP Hybris Commerce Platform. CCV2 stands for “Commerce Cloud Version 2”, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that’s a long story described in a short way). I joined a team consisting of people from a few different departments in the office, so we didn’t actually know each other before the event. We decided to create a simple application consisting of a few microservices, which will send an e-mail with a promotional link to the user once he or she add something to the cart in the on-line shop. After clicking on the link sent via the e-mail, user will be redirected to the front-end application, where he or she has to click on the button as many times as possible in a given period of time.\nThe more clicks were performed, the higher discount user will get, but not higher than 20%. When game is finished, front-end application is sending a request to the voucher service from which we can retrieve a promotional code.\nWith this code, we can go to the SAP Hybris Commerce store-front…\n…and get our discount!\nApplication overview General concept of the application flow is presented on the diagram below.\nWe decided to create three microservices:\nmailing service written in Node.js front-end application with clicking game written in JavaScript voucher service written in Kotlin All microservices needed to have corresponsing Docker containers, which were deployed to the Kyma instance. Kyma was communicating with SAP Hybris Commerce platform written in Java. Thanks to clear separation of a different environments, we were able to integrate services using different technologies.\nCreating a microservice I was responsible for writing voucher storage microservice. On daily basis I use Java programming language, but I wanted to try something new, so I chose Kotlin. Kotlin is a JVM language, so it runs on the same runtime as regular Java applications. Moreover, I could use tools I’m familiar with like IntelliJ, Gradle, etc. In my microservice I used Gradle as a build tool, Javalin for designing REST API and Dagger for Dependency Injection. Moreover, for writing unit tests I used JUnit, JUnitParams, Truth and Mockito. I also wrote a few integration tests for the API with REST Assured. As you can see, I could easily use Java libraries in the Kotlin application because those two languages are fully interoperable.\nREST API definition of my application looks pretty simple:\nclass Application { companion object { private val logger = LoggerFactory.getLogger(Application::class.java) private val component = DaggerApplicationComponent.create() private val voucherController = component.voucherController() private val voucherHttpFacade = component.voucherHttpFacade() @JvmStatic fun main(args: Array\u003cString\u003e) { Javalin .create() .enableCorsForAllOrigins() .requestLogger { ctx, time -\u003e logger.info(\"${ctx.method()} ${ctx.path()} ${ctx.status()} took $time ms\") }.routes { get(\"/voucher\") { voucherHttpFacade.getAll(it) } get(\"/voucher/:group\") { voucherHttpFacade.getGroup(it) } get(\"/health\") { it.json(Health(\"UP\")).status(HttpStatus.OK_200) } get(\"/\") { it.status(HttpStatus.FORBIDDEN_403) } } .event(JavalinEvent.SERVER_STARTING) { voucherController.loadVouchers() } .start(7000) } } } I have an endpoint for gathering all vouchers, gathering single voucher for a given group and deactivating it and health-check. In addition, I’m loading all the vouchers into the application memory on the server startup using Kotlin coroutine under the hood asynchronously.\noverride fun loadVouchers() { GlobalScope.async { loadVouchersFromAllGroups() } } Application can be build with Gradle as follows:\n./gradlew build I’m using Shadow Gradle plugin to create fat jar. Once, build is finished, I can start the application with embdedded Jetty HTTP server on the port 7000.\njava -jar build/libs/app-1.0-all.jar You can find source code of the whole application at: https://github.com/pwittchen/voucher-storage-service.\nDeployment of the microservice In order to deploy the microservice to the Kyma, I needed to prepare Dockerfile, which looks as follows:\nFROM openjdk:8-jre-alpine MAINTAINER pwittchen WORKDIR /app COPY build/libs/app-1.0-all.jar . RUN ls -la /app CMD java -jar app-1.0-all.jar It’s just a lightweight Alpine Linux with Java 8 and Kotlin application compiled into fat jar.\nTo build the container, I invoked command:\nsudo docker build -t pwittchen/voucher-storage-service . and to run it, I invoked command:\nsudo docker run -p 127.0.0.1:7000:7000 -t pwittchen/voucher-storage-service I also pushed it to the docker hub because Kyma gets required containers from there.\nNext, I created deployment.yml file for Kubernetess, which is used by Kyma under the hood.\napiVersion: extensions/v1beta1 kind: Deployment metadata: name: voucher-storage-service labels: app: voucher-storage-service spec: selector: matchLabels: app: voucher-storage-service template: metadata: labels: app: voucher-storage-service spec: containers: - name: web image: docker.io/pwittchen/voucher-storage-service:latest ports: - containerPort: 7000 --- apiVersion: v1 kind: Service metadata: name: voucher-storage-service labels: app: voucher-storage-service spec: ports: - name: http port: 7000 selector: app: voucher-storage-service Such configuration had to be provided for Kyma by all microservices.\nSummary Once, we deployed all the microservices and tested the whole flow, we needed to apply a few adjustments. When issues were fixed, whole application worked correctly. This proves that external services written in different technologies can be integrated with SAP Hybris Commerce using Kyma. This hackathon was pretty nice experience, learning opportunity and productive distraction from daily projects. Moreover, our team won the whole event ex aequo with another team located in Germany. Thanks to this hackathon, I have better understanding of Kyma and integration tooling for the SAP Hybris Commerce platform.\n","wordCount":"885","inLanguage":"en","datePublished":"2018-12-14T14:34:01Z","dateModified":"2018-12-14T14:34:01Z","author":{"@type":"Person","name":"Piotr Wittchen"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wittchen.io/posts/kyma-meets-ccv2-hackathon-summary/"},"publisher":{"@type":"Organization","name":"Piotr Wittchen","logo":{"@type":"ImageObject","url":"https://wittchen.io/favicon.ico"}}}</script><script defer data-website-id=dfid_D4sN47CVgrrCRR7KCciN3 data-domain=wittchen.io src=https://datafa.st/js/script.js></script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wittchen.io/ accesskey=h title="Piotr Wittchen (Alt + H)">Piotr Wittchen</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wittchen.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://wittchen.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://wittchen.io/talks/ title=talks><span>talks</span></a></li><li><a href=https://wittchen.io/projects/ title=projects><span>projects</span></a></li><li><a href=https://wittchen.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://wittchen.io/contact/ title=contact><span>contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wittchen.io/>Home</a>&nbsp;»&nbsp;<a href=https://wittchen.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Kyma meets CCV2 hackathon summary</h1><div class=post-meta><span title='2018-12-14 14:34:01 +0000 UTC'>December 14, 2018</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;885 words&nbsp;·&nbsp;Piotr Wittchen&nbsp;|&nbsp;<a href=https://github.com/pwittchen/wittchen.io/blob/master/content/posts/kyma-meets-ccv2-hackathon-summary.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>I recently I had an opportunity to join &ldquo;Kyma meets CCV2 Hackathon&rdquo; in the <a href=https://www.sap.com/poland/index.html>SAP Labs Poland</a> office in Gliwice. The goal of the hackathon was to create a simple project, which will use <a href=https://github.com/kyma-project/kyma>Kyma</a> to integrate external services with the <a href=https://cx.sap.com/en/products/commerce>SAP Hybris Commerce Platform</a>. CCV2 stands for &ldquo;Commerce Cloud Version 2&rdquo;, which are basically SAP Hybris Commerce solutions deployed on the MS Azure Cloud (that&rsquo;s a long story described in a short way). I joined a team consisting of people from a few different departments in the office, so we didn&rsquo;t actually know each other before the event. We decided to create a simple application consisting of a few microservices, which will send an e-mail with a promotional link to the user once he or she add something to the cart in the on-line shop. After clicking on the link sent via the e-mail, user will be redirected to the front-end application, where he or she has to click on the button as many times as possible in a given period of time.</p><p><img loading=lazy src=/posts/2018/kyma-meets-ccv2-hackathon-summary/clickr_frontend.png></p><p>The more clicks were performed, the higher discount user will get, but not higher than 20%. When game is finished, front-end application is sending a request to the voucher service from which we can retrieve a promotional code.</p><p><img loading=lazy src=/posts/2018/kyma-meets-ccv2-hackathon-summary/clickr_frontend2.png></p><p>With this code, we can go to the SAP Hybris Commerce store-front&mldr;</p><p><img loading=lazy src=/posts/2018/kyma-meets-ccv2-hackathon-summary/storefront1.png></p><p>&mldr;and get our discount!</p><p><img loading=lazy src=posts/2018/kyma-meets-ccv2-hackathon-summary/storefront2.png></p><h2 id=application-overview>Application overview<a hidden class=anchor aria-hidden=true href=#application-overview>#</a></h2><p>General concept of the application flow is presented on the diagram below.</p><p><img loading=lazy src=/posts/2018/kyma-meets-ccv2-hackathon-summary/diagram.png></p><p>We decided to create three microservices:</p><ul><li>mailing service written in Node.js</li><li>front-end application with clicking game written in JavaScript</li><li>voucher service written in Kotlin</li></ul><p>All microservices needed to have corresponsing Docker containers, which were deployed to the Kyma instance. Kyma was communicating with SAP Hybris Commerce platform written in Java. Thanks to clear separation of a different environments, we were able to integrate services using different technologies.</p><h2 id=creating-a-microservice>Creating a microservice<a hidden class=anchor aria-hidden=true href=#creating-a-microservice>#</a></h2><p>I was responsible for writing voucher storage microservice. On daily basis I use Java programming language, but I wanted to try something new, so I chose Kotlin. Kotlin is a JVM language, so it runs on the same runtime as regular Java applications. Moreover, I could use tools I&rsquo;m familiar with like IntelliJ, Gradle, etc. In my microservice I used <a href=https://gradle.org/>Gradle</a> as a build tool, <a href=http://javalin.io/>Javalin</a> for designing REST API and <a href=https://github.com/google/dagger>Dagger</a> for Dependency Injection. Moreover, for writing unit tests I used <a href=https://junit.org>JUnit</a>, <a href=https://github.com/Pragmatists/JUnitParams>JUnitParams</a>, <a href=https://github.com/google/truth>Truth</a> and <a href=https://github.com/mockito/mockito>Mockito</a>. I also wrote a few integration tests for the API with <a href=https://github.com/rest-assured/rest-assured>REST Assured</a>. As you can see, I could easily use Java libraries in the Kotlin application because those two languages are fully interoperable.</p><p>REST API definition of my application looks pretty simple:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>Application</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>logger</span> <span class=p>=</span> <span class=nc>LoggerFactory</span><span class=p>.</span><span class=n>getLogger</span><span class=p>(</span><span class=n>Application</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>component</span> <span class=p>=</span> <span class=nc>DaggerApplicationComponent</span><span class=p>.</span><span class=n>create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>voucherController</span> <span class=p>=</span> <span class=n>component</span><span class=p>.</span><span class=n>voucherController</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>voucherHttpFacade</span> <span class=p>=</span> <span class=n>component</span><span class=p>.</span><span class=n>voucherHttpFacade</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@JvmStatic</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>(</span><span class=n>args</span><span class=p>:</span> <span class=n>Array</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Javalin</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=n>create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=n>enableCorsForAllOrigins</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=n>requestLogger</span> <span class=p>{</span> <span class=n>ctx</span><span class=p>,</span> <span class=n>time</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=p>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>${ctx.method()}</span><span class=s2> </span><span class=si>${ctx.path()}</span><span class=s2> </span><span class=si>${ctx.status()}</span><span class=s2> took </span><span class=si>$time</span><span class=s2> ms&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>}.</span><span class=n>routes</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>get</span><span class=p>(</span><span class=s2>&#34;/voucher&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>voucherHttpFacade</span><span class=p>.</span><span class=n>getAll</span><span class=p>(</span><span class=k>it</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>get</span><span class=p>(</span><span class=s2>&#34;/voucher/:group&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>voucherHttpFacade</span><span class=p>.</span><span class=n>getGroup</span><span class=p>(</span><span class=k>it</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>get</span><span class=p>(</span><span class=s2>&#34;/health&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=k>it</span><span class=p>.</span><span class=n>json</span><span class=p>(</span><span class=n>Health</span><span class=p>(</span><span class=s2>&#34;UP&#34;</span><span class=p>)).</span><span class=n>status</span><span class=p>(</span><span class=nc>HttpStatus</span><span class=p>.</span><span class=n>OK_200</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=k>it</span><span class=p>.</span><span class=n>status</span><span class=p>(</span><span class=nc>HttpStatus</span><span class=p>.</span><span class=n>FORBIDDEN_403</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=n>event</span><span class=p>(</span><span class=nc>JavalinEvent</span><span class=p>.</span><span class=n>SERVER_STARTING</span><span class=p>)</span> <span class=p>{</span> <span class=n>voucherController</span><span class=p>.</span><span class=n>loadVouchers</span><span class=p>()</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>.</span><span class=n>start</span><span class=p>(</span><span class=m>7000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>I have an endpoint for gathering all vouchers, gathering single voucher for a given group and deactivating it and health-check. In addition, I&rsquo;m loading all the vouchers into the application memory on the server startup using <a href=https://kotlinlang.org/docs/reference/coroutines-overview.html>Kotlin coroutine</a> under the hood asynchronously.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>override</span> <span class=k>fun</span> <span class=nf>loadVouchers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nc>GlobalScope</span><span class=p>.</span><span class=n>async</span> <span class=p>{</span> <span class=n>loadVouchersFromAllGroups</span><span class=p>()</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Application can be build with Gradle as follows:</p><pre tabindex=0><code>./gradlew build
</code></pre><p>I&rsquo;m using <a href=https://github.com/johnrengelman/shadow>Shadow Gradle plugin</a> to create fat jar. Once, build is finished, I can start the application with embdedded Jetty HTTP server on the port 7000.</p><pre tabindex=0><code>java -jar build/libs/app-1.0-all.jar
</code></pre><p>You can find source code of the whole application at: <a href=https://github.com/pwittchen/voucher-storage-service>https://github.com/pwittchen/voucher-storage-service</a>.</p><h2 id=deployment-of-the-microservice>Deployment of the microservice<a hidden class=anchor aria-hidden=true href=#deployment-of-the-microservice>#</a></h2><p>In order to deploy the microservice to the Kyma, I needed to prepare <code>Dockerfile</code>, which looks as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> openjdk:8-jre-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>MAINTAINER</span><span class=s> pwittchen</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> build/libs/app-1.0-all.jar .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> ls -la /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> java -jar app-1.0-all.jar<span class=err>
</span></span></span></code></pre></div><p>It&rsquo;s just a lightweight Alpine Linux with Java 8 and Kotlin application compiled into fat jar.</p><p>To build the container, I invoked command:</p><pre tabindex=0><code>sudo docker build -t pwittchen/voucher-storage-service .
</code></pre><p>and to run it, I invoked command:</p><pre tabindex=0><code>sudo docker run -p 127.0.0.1:7000:7000 -t pwittchen/voucher-storage-service
</code></pre><p>I also pushed it to the <a href=https://hub.docker.com/r/pwittchen/voucher-storage-service/>docker hub</a> because Kyma gets required containers from there.</p><p>Next, I created <code>deployment.yml</code> file for Kubernetess, which is used by Kyma under the hood.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>extensions/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>voucher-storage-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>voucher-storage-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>voucher-storage-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>voucher-storage-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/pwittchen/voucher-storage-service:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>7000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>voucher-storage-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>voucher-storage-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>7000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>voucher-storage-service</span><span class=w>
</span></span></span></code></pre></div><p>Such configuration had to be provided for Kyma by all microservices.</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>Once, we deployed all the microservices and tested the whole flow, we needed to apply a few adjustments. When issues were fixed, whole application worked correctly. This proves that external services written in different technologies can be integrated with SAP Hybris Commerce using Kyma. This hackathon was pretty nice experience, learning opportunity and productive distraction from daily projects. Moreover, our team won the whole event ex aequo with another team located in Germany. Thanks to this hackathon, I have better understanding of Kyma and integration tooling for the SAP Hybris Commerce platform.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wittchen.io/tags/kotlin/>Kotlin</a></li></ul><nav class=paginav><a class=prev href=https://wittchen.io/posts/publishing-jar-aar-to-maven-central/><span class=title>« Prev</span><br><span>Publishing a JAR/AAR to the Maven Central</span>
</a><a class=next href=https://wittchen.io/posts/bci-sci-fi-or-reality-oredev-2018/><span class=title>Next »</span><br><span>Brain-Computer Interfaces - Science Fiction or Reality?</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wittchen.io/>Piotr Wittchen</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>