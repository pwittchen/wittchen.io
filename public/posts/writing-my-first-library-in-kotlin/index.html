<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Writing my first library in Kotlin | Piotr Wittchen</title><meta name=keywords content="java,kotlin,android,gradle"><meta name=description content="Introduction Recently, I decided to create a tiny Android library called RxBattery, which is monitoring battery state of the device with RxJava and RxKotlin. I created a few Java and Android libraries already and this time I decided to use Kotlin programming language instead of Java to learn something new and write something more complicated than &ldquo;Hello World&rdquo; app. Here are my observations.
Build System I used Gradle to build the project."><meta name=author content="Piotr Wittchen"><link rel=canonical href=https://wittchen.io/posts/writing-my-first-library-in-kotlin/><link crossorigin=anonymous href=/assets/css/stylesheet.cdcf872f971c70fddc7fd480e8457cd308ed0cf287b498bcdc6183fc6d147858.css integrity="sha256-zc+HL5cccP3cf9SA6EV80wjtDPKHtJi83GGD/G0UeFg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wittchen.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wittchen.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wittchen.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wittchen.io/apple-touch-icon.png><link rel=mask-icon href=https://wittchen.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Writing my first library in Kotlin"><meta property="og:description" content="Introduction Recently, I decided to create a tiny Android library called RxBattery, which is monitoring battery state of the device with RxJava and RxKotlin. I created a few Java and Android libraries already and this time I decided to use Kotlin programming language instead of Java to learn something new and write something more complicated than &ldquo;Hello World&rdquo; app. Here are my observations.
Build System I used Gradle to build the project."><meta property="og:type" content="article"><meta property="og:url" content="https://wittchen.io/posts/writing-my-first-library-in-kotlin/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-08-19T10:24:19+00:00"><meta property="article:modified_time" content="2018-08-19T10:24:19+00:00"><meta property="og:site_name" content="Piotr Wittchen"><meta name=twitter:card content="summary"><meta name=twitter:title content="Writing my first library in Kotlin"><meta name=twitter:description content="Introduction Recently, I decided to create a tiny Android library called RxBattery, which is monitoring battery state of the device with RxJava and RxKotlin. I created a few Java and Android libraries already and this time I decided to use Kotlin programming language instead of Java to learn something new and write something more complicated than &ldquo;Hello World&rdquo; app. Here are my observations.
Build System I used Gradle to build the project."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wittchen.io/posts/"},{"@type":"ListItem","position":2,"name":"Writing my first library in Kotlin","item":"https://wittchen.io/posts/writing-my-first-library-in-kotlin/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Writing my first library in Kotlin","name":"Writing my first library in Kotlin","description":"Introduction Recently, I decided to create a tiny Android library called RxBattery, which is monitoring battery state of the device with RxJava and RxKotlin. I created a few Java and Android libraries already and this time I decided to use Kotlin programming language instead of Java to learn something new and write something more complicated than \u0026ldquo;Hello World\u0026rdquo; app. Here are my observations.\nBuild System I used Gradle to build the project.","keywords":["java","kotlin","android","gradle"],"articleBody":"Introduction Recently, I decided to create a tiny Android library called RxBattery, which is monitoring battery state of the device with RxJava and RxKotlin. I created a few Java and Android libraries already and this time I decided to use Kotlin programming language instead of Java to learn something new and write something more complicated than “Hello World” app. Here are my observations.\nBuild System I used Gradle to build the project. It’s popular for JVM and Android apps nowadays and works fine with Kotlin. I just needed to add Kotlin Gradle Plugin and Kotlin STD Lib to the /library/build.gradle file to the classpath dependencies in buildscript section. I also needed to define sourceSets to allow IntelliJ and Android Studio recognize directories with sources.\nandroid { sourceSets { androidTest.java.srcDirs += \"src/androidTest/kotlin\" main.java.srcDirs += \"src/main/kotlin\" test.java.srcDirs += \"src/test/kotlin\" } } To keep the project clean, I defined all dependencies and version numbers in top-level build.gradle file, so I could reuse them in all modules.\next { minSdkVersion = 14 compileSdkVersion = 28 buildToolsVersion = '28' gradleVersion = '4.4.1' kotlinVersion = '1.2.60' detektVersion = '1.0.0.RC6-1' } ext.deps = [ rxjava2 : 'io.reactivex.rxjava2:rxjava:2.2.0', rxandroid2 : 'io.reactivex.rxjava2:rxandroid:2.0.2', rxkotlin2 : 'io.reactivex.rxjava2:rxkotlin:2.3.0', supportannotations : 'com.android.support:support-annotations:28.0.0-rc01', appcompatv7 : 'com.android.support:appcompat-v7:28.0.0-rc01', constraintlayout : 'com.android.support.constraint:constraint-layout:1.1.2', junit : 'junit:junit:4.12', truth : 'com.google.truth:truth:0.42', robolectric : 'org.robolectric:robolectric:4.0-alpha-3', mockitocore : 'org.mockito:mockito-core:2.21.0', mockitokotlin : 'com.nhaarman.mockitokotlin2:mockito-kotlin:2.0.0-RC1', dokka : 'org.jetbrains.dokka:dokka-gradle-plugin:0.9.17', detekt : \"gradle.plugin.io.gitlab.arturbosch.detekt:detekt-gradle-plugin:$detektVersion\", ktlintgradle : \"gradle.plugin.org.jlleitschuh.gradle:ktlint-gradle:4.1.0\", kotlinstdlib : \"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlinVersion\", kotlingradleplugin : \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion\" ] Static Code Analysis For static code analysis, I used CheckStyle, FindBugs, PMD and Android Lint as usual. Moreover, I used ktlint via ktlint-gradle plugin and detekt. I’ve added these dependencies to classpath in buildscript section in library/build.gradle file as previosuly\nbuildscript { repositories { mavenCentral() jcenter() google() maven { url 'https://plugins.gradle.org/m2/' } } dependencies { classpath deps.kotlingradleplugin classpath deps.detekt classpath deps.ktlintgradle classpath deps.dokka } } I also applied minimal configuration for these plugins.\ndetekt { version = rootProject.ext.detektVersion profile(\"main\") { input = \"$projectDir\" config = \"$projectDir/detekt.yml\" filters = \".*test.*,.*/resources/.*,.*/tmp/.*\" } } ktlint { verbose = true reporters = [\"CHECKSTYLE\", \"PLAIN\"] } I also tried to generate code coverage report, to be able to verify what amount of code is covered by unit tests, but unfortunately Jacoco wasn’t able to analyze Kotlin code. I saw on the web that people struggled with the same problem and a few of them could have solved that issue. Maybe I missed something and I could update it in the future.\nContinuous Integration In my open-source projects, I use Travis for CI. Everything can be configured in .travis.yml file and setup looks exactly the same as for Android libraries written in Java.\nlanguage: android android: components: - tools - platform-tools - build-tools-28 - android-28 - extra-android-support - extra-android-m2repository licenses: - android-sdk-license-5be876d5 - android-sdk-license-c81a61d9 - 'android-sdk-preview-license-.+' - 'android-sdk-license-.+' - 'google-gdk-license-.+' jdk: oraclejdk8 before_install: - yes | sdkmanager \"platforms;android-27\" install: - true script: - ./gradlew clean build test check cache: directories: - $HOME/.m2 I suppose that in case of writing pure Kotlin (non-Android), library configuration would be the same as in regular Java project because everything is built via Gradle. Configuration, which works fine for one of my pure Java libraries looks like that:\nlanguage: java install: # Check install section: http://docs.travis-ci.com/user/build-configuration/#install # If you'd like to skip the install stage entirely, set it to true and nothing will be run. - true after_success: - bash I don’t think that it would require any significant change in case of Kotlin.\nKotlin vs. Java I’ve decided to use Kotlin instead of Java to learn a bit more about this language and try something new. Google promotes this language during Google I/O events and recommends to use it for Android development. Moreover, it’s regular JVM language, so we can use it anywhere we want - on Android (mobile), on servers and even on desktop apps. I haven’t discovered all the features of this language during writing this tiny project, but I have a few observations. Writing code is a bit strange because I got used to programming in Java. In Kotlin, we define the function or variable name first, then we put colon and we define the type next. It’s opposite to Java, where types are defined first.\nfun createBroadcastReceiver(emitter: FlowableEmitterBatteryState): BroadcastReceiver { ... val status: Int = intent.getIntExtra(BatteryManager.EXTRA_STATUS, UNKNOWN) ... } Moreover, there’s type inference in Kotlin and sometimes compiler is able to guess our type, so we don’t have to provide it. See the following example:\nval emitter = mock(FlowableEmitter::class.java) In addition, we don’t have to put semicolon in the end of the statement as you can see on the code snippets above, what is really convenient. The thing, I really like about Kotlin is null safety\nif (intent != null) { val status: Int = intent.getIntExtra(BatteryManager.EXTRA_STATUS, UNKNOWN) } If we don’t do that, code won’t compile. We can avoid such null-checks, by using !!. operator like here:\nval status: Int = intent!!.getIntExtra(BatteryManager.EXTRA_STATUS, UNKNOWN) but by looking at the code, we can see that there are two exclamation marks, so clearly something must be wrong here and we should think about improvement. Moreover, when NPE occurs, it’ll be easier to find.\nKotlin is also more concise than Java. It’s hard to say if it’s an advantage or drawback. In Java we have more code, but we clearly know what’s going on when the code is clean. In Kotlin a lot of stuff is implicit.\nE.g. inheritance looks as follows:\nclass MainActivity : AppCompatActivity() and sometimes we don’t have variable provided in the lambda, when there’s only one value and we can invoke this value by calling it object\nbatteryDisposable = RxBattery .observe(this) .subscribeOn(Schedulers.io()) .observeOn(AndroidSchedulers.mainThread()) .subscribe { textView.text = it.toString() } The thing I like about implicit Kotlin code is data classes. We can create something like that:\ndata class BatteryState( val status: Int, val plugged: Int, val health: Int, val level: Int, val temperature: Int, val voltage: Int ) and it will generate constructor with all these values, getters and toString() method. In Java, we would need to write it by hand, use code generators in the IDE or code generation libraries like Lombok.\nWhen we take a look at the control flow in Kotlin, except for if expression, for and while loops, we also have when expression, which can be kind of neat equivalent to switch instruction in Java. It looks like this:\nfun plugged(): Plugged { return when (pluggedCode) { BatteryManager.BATTERY_PLUGGED_AC - Plugged.AC BatteryManager.BATTERY_PLUGGED_USB - Plugged.USB BatteryManager.BATTERY_PLUGGED_WIRELESS - Plugged.WIRELESS else - Plugged.UNKNOWN } } It’s worth to say that there’s good inter-operability between Java and Kotlin. We can use Kotlin modules and libraries in Java projects and vice-versa because everything compiles to the same byte-code. We can even create pure Java code in the Kotlin module. For example, I wanted to have static method called from the Kotlin library. In order to achieve that, I needed to wrap whole class in a Companion Object.\nclass RxBattery { companion object { ... } } Next, in the Kotlin module, I could call it like this:\nRxBattery.observe(this) but in Java module it wasn’t possible and I needed to write something like this:\nRxBattery.Companion.observe(context); I didn’t want library users to call this Companion value explicitely in Java projects, so I created additional Java class.\npublic class RxBatteryFactory { private RxBatteryFactory() { } public static FlowableBatteryState observe(Context context) { return RxBattery.Companion.observe(context); } } and put it next to the Kotlin classes. Now In Java module, people could call method like that:\nRxBatteryFactory.observe(this) It’s good to know that it’s possible because when we got stuck with implicit Kotlin syntaxt, we can always use Java in one particular scenario.\nLater, I figured out, we can simply add @JvmStatic annotation before the method signature and since now, method method will be visible as static in the Java modules as well and we no longer need additional Java code.\n@JvmStatic fun observe(context: Context): FlowableBatteryState { ... } Moreover, all classes created in Kotlin are final by default. It can cause a problems during writing unit tests and creating mocks. If we want to have non-final class (e.g. in order to mock it), we need to mark it explicitly as open.\nopen class MyClass Of course, things mentioned above are not all features of Kotlin. There’s much more to discover - e.g. couroutines. To learn more, check Kotlin Language Reference, open-source projects in this language, books, and other articles on the web.\nIt’s hard to say if in more complex project Kotlin would be a better choice. Right now, I’m more familar and comfortable with Java, but on the other hand, Kotlin has a few interesting features, which makes development better. Maybe I’ll give this language more chances in the future to learn it better.\nUnit Tests Unit tests in Kotlin are pretty similar to Java.\n@Test fun shouldCreateBroadcastReceiver() { // given  val emitter = mock(FlowableEmitter::class.java) // when  val broadcastReceiver: BroadcastReceiver = RxBattery.createBroadcastReceiver( emitter as FlowableEmitterBatteryState ) // then  assertThat(broadcastReceiver).isNotNull() } We can use JUnit and Java assertion libraries like Google Truth and mocking libraries like Mockito. There’s also mockit-kotlin library, but in my case, I used mockito-core. There are also other mocking libraries like Mockk and libraries for BDD like Spek. Moreover, we can achieve more concise syntax for unit tests using various kotlin libraries like kotlintest. I haven’t used it in this project yet, but I may update it in the future.\nJavaDoc Generating JavaDoc (or KotlinDoc?) in Kotlin projects is not straightforward. In order to generate documentation, I used dokka gradle plugin. It’s pretty easy to use, we just need to add appropriate dependency, apply the plugin and create configuration in build.gradle file.\ndokka { outputFormat = 'html' outputDirectory = \"$buildDir/javadoc\" } Next, we just call: ./gradlew dokka and our JavaDoc is generated in defined outputDirectory.\nLibrary Deployment Library deployment of the Kotlin project is exactly the same as Java project. I simply used maven_push.gradle script created by Chris Banes some time ago, applied it in the library module and configured everything in gradle.properties and library/gradle.properties. Of course, I also needed to have my credentials configured in ~/.gradle/gradle.properties file. Next, I could just call ./gradlew uploadArchives, close and release library on the OSS SonaType website.\nSummary To wrap up, Kotlin is an interesting language. It’s hard to say, if it’s really better than Java although it has a few interesting features. Nevertheless, it’s good to familiarize with it because it’s being promoted by Google and JetBrains. JetBrains company actually created and develops this language, so due to this fact, I’m able to put more trust in that project. If you would like to see complete code and configuration of the project mentioned in this article, check out my RxBattery repository on GitHub. Last, but not least, learning new things broadens our mind and horizon.\n","wordCount":"1804","inLanguage":"en","datePublished":"2018-08-19T10:24:19Z","dateModified":"2018-08-19T10:24:19Z","author":{"@type":"Person","name":"Piotr Wittchen"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wittchen.io/posts/writing-my-first-library-in-kotlin/"},"publisher":{"@type":"Organization","name":"Piotr Wittchen","logo":{"@type":"ImageObject","url":"https://wittchen.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wittchen.io/ accesskey=h title="Piotr Wittchen (Alt + H)">Piotr Wittchen</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wittchen.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://wittchen.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://wittchen.io/talks/ title=talks><span>talks</span></a></li><li><a href=https://wittchen.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://wittchen.io/contact/ title=contact><span>contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wittchen.io/>Home</a>&nbsp;»&nbsp;<a href=https://wittchen.io/posts/>Posts</a></div><h1 class=post-title>Writing my first library in Kotlin</h1><div class=post-meta><span title="2018-08-19 10:24:19 +0000 UTC">August 19, 2018</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1804 words&nbsp;·&nbsp;Piotr Wittchen&nbsp;|&nbsp;<a href=https://github.com/pwittchen/wittchen.io/blob/master/content/posts/writing-my-first-library-in-kotlin.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Recently, I decided to create a tiny Android library called <a href=https://github.com/pwittchen/RxBattery>RxBattery</a>, which is monitoring battery state of the device with RxJava and RxKotlin. I created a few Java and Android libraries already and this time I decided to use <a href=https://kotlinlang.org/>Kotlin</a> programming language instead of Java to learn something new and write something more complicated than &ldquo;Hello World&rdquo; app. Here are my observations.</p><h2 id=build-system>Build System<a hidden class=anchor aria-hidden=true href=#build-system>#</a></h2><p>I used <a href=https://gradle.org/>Gradle</a> to build the project. It&rsquo;s popular for JVM and Android apps nowadays and works fine with Kotlin. I just needed to add Kotlin Gradle Plugin and Kotlin STD Lib to the <code>/library/build.gradle</code> file to the <code>classpath</code> dependencies in <code>buildscript</code> section. I also needed to define <code>sourceSets</code> to allow IntelliJ and Android Studio recognize directories with sources.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>android</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>sourceSets</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>androidTest</span><span class=o>.</span><span class=na>java</span><span class=o>.</span><span class=na>srcDirs</span> <span class=o>+=</span> <span class=s2>&#34;src/androidTest/kotlin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=o>.</span><span class=na>java</span><span class=o>.</span><span class=na>srcDirs</span> <span class=o>+=</span> <span class=s2>&#34;src/main/kotlin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>test</span><span class=o>.</span><span class=na>java</span><span class=o>.</span><span class=na>srcDirs</span> <span class=o>+=</span> <span class=s2>&#34;src/test/kotlin&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>To keep the project clean, I defined all dependencies and version numbers in top-level <code>build.gradle</code> file, so I could reuse them in all modules.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>ext</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>minSdkVersion</span> <span class=o>=</span> <span class=mi>14</span>
</span></span><span class=line><span class=cl>  <span class=n>compileSdkVersion</span> <span class=o>=</span> <span class=mi>28</span>
</span></span><span class=line><span class=cl>  <span class=n>buildToolsVersion</span> <span class=o>=</span> <span class=s1>&#39;28&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>gradleVersion</span> <span class=o>=</span> <span class=s1>&#39;4.4.1&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>kotlinVersion</span> <span class=o>=</span> <span class=s1>&#39;1.2.60&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>detektVersion</span> <span class=o>=</span> <span class=s1>&#39;1.0.0.RC6-1&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ext</span><span class=o>.</span><span class=na>deps</span> <span class=o>=</span> <span class=o>[</span> <span class=n>rxjava2</span>              <span class=o>:</span> <span class=s1>&#39;io.reactivex.rxjava2:rxjava:2.2.0&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>rxandroid2</span>           <span class=o>:</span> <span class=s1>&#39;io.reactivex.rxjava2:rxandroid:2.0.2&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>rxkotlin2</span>            <span class=o>:</span> <span class=s1>&#39;io.reactivex.rxjava2:rxkotlin:2.3.0&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>supportannotations</span>   <span class=o>:</span> <span class=s1>&#39;com.android.support:support-annotations:28.0.0-rc01&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>appcompatv7</span>          <span class=o>:</span> <span class=s1>&#39;com.android.support:appcompat-v7:28.0.0-rc01&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>constraintlayout</span>     <span class=o>:</span> <span class=s1>&#39;com.android.support.constraint:constraint-layout:1.1.2&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>junit</span>                <span class=o>:</span> <span class=s1>&#39;junit:junit:4.12&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>truth</span>                <span class=o>:</span> <span class=s1>&#39;com.google.truth:truth:0.42&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>robolectric</span>          <span class=o>:</span> <span class=s1>&#39;org.robolectric:robolectric:4.0-alpha-3&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>mockitocore</span>          <span class=o>:</span> <span class=s1>&#39;org.mockito:mockito-core:2.21.0&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>mockitokotlin</span>        <span class=o>:</span> <span class=s1>&#39;com.nhaarman.mockitokotlin2:mockito-kotlin:2.0.0-RC1&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>dokka</span>                <span class=o>:</span> <span class=s1>&#39;org.jetbrains.dokka:dokka-gradle-plugin:0.9.17&#39;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>detekt</span>               <span class=o>:</span> <span class=s2>&#34;gradle.plugin.io.gitlab.arturbosch.detekt:detekt-gradle-plugin:$detektVersion&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>ktlintgradle</span>         <span class=o>:</span> <span class=s2>&#34;gradle.plugin.org.jlleitschuh.gradle:ktlint-gradle:4.1.0&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>kotlinstdlib</span>         <span class=o>:</span> <span class=s2>&#34;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlinVersion&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>             <span class=n>kotlingradleplugin</span>   <span class=o>:</span> <span class=s2>&#34;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion&#34;</span> <span class=o>]</span>
</span></span></code></pre></div><h2 id=static-code-analysis>Static Code Analysis<a hidden class=anchor aria-hidden=true href=#static-code-analysis>#</a></h2><p>For static code analysis, I used CheckStyle, FindBugs, PMD and Android Lint as usual. Moreover, I used <a href=https://github.com/shyiko/ktlint>ktlint</a> via <a href=https://github.com/JLLeitschuh/ktlint-gradle>ktlint-gradle plugin</a> and <a href=https://github.com/arturbosch/detekt>detekt</a>. I&rsquo;ve added these dependencies to <code>classpath</code> in <code>buildscript</code> section in <code>library/build.gradle</code> file as previosuly</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>buildscript</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>repositories</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>mavenCentral</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=n>jcenter</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=n>google</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=n>maven</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>url</span> <span class=s1>&#39;https://plugins.gradle.org/m2/&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>classpath</span> <span class=n>deps</span><span class=o>.</span><span class=na>kotlingradleplugin</span>
</span></span><span class=line><span class=cl>    <span class=n>classpath</span> <span class=n>deps</span><span class=o>.</span><span class=na>detekt</span>
</span></span><span class=line><span class=cl>    <span class=n>classpath</span> <span class=n>deps</span><span class=o>.</span><span class=na>ktlintgradle</span>
</span></span><span class=line><span class=cl>    <span class=n>classpath</span> <span class=n>deps</span><span class=o>.</span><span class=na>dokka</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>I also applied minimal configuration for these plugins.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>detekt</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>version</span> <span class=o>=</span> <span class=n>rootProject</span><span class=o>.</span><span class=na>ext</span><span class=o>.</span><span class=na>detektVersion</span>
</span></span><span class=line><span class=cl>  <span class=n>profile</span><span class=o>(</span><span class=s2>&#34;main&#34;</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>input</span> <span class=o>=</span> <span class=s2>&#34;$projectDir&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>config</span> <span class=o>=</span> <span class=s2>&#34;$projectDir/detekt.yml&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>filters</span> <span class=o>=</span> <span class=s2>&#34;.*test.*,.*/resources/.*,.*/tmp/.*&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ktlint</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>verbose</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=n>reporters</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;CHECKSTYLE&#34;</span><span class=o>,</span> <span class=s2>&#34;PLAIN&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>I also tried to generate <strong>code coverage report</strong>, to be able to verify what amount of code is covered by unit tests, but unfortunately Jacoco wasn&rsquo;t able to analyze Kotlin code. I saw on the web that people struggled with the same problem and a few of them could have solved that issue. Maybe I missed something and I could update it in the future.</p><h2 id=continuous-integration>Continuous Integration<a hidden class=anchor aria-hidden=true href=#continuous-integration>#</a></h2><p>In my open-source projects, I use <a href=https://travis-ci.org/>Travis</a> for CI. Everything can be configured in <code>.travis.yml</code> file and setup looks exactly the same as for Android libraries written in Java.</p><pre tabindex=0><code>language: android

android:
  components:
    - tools
    - platform-tools
    - build-tools-28
    - android-28
    - extra-android-support
    - extra-android-m2repository
  licenses:
    - android-sdk-license-5be876d5
    - android-sdk-license-c81a61d9
    - &#39;android-sdk-preview-license-.+&#39;
    - &#39;android-sdk-license-.+&#39;
    - &#39;google-gdk-license-.+&#39;

jdk: oraclejdk8

before_install:
  - yes | sdkmanager &#34;platforms;android-27&#34;

install:
  - true

script:
  - ./gradlew clean build test check

cache:
  directories:
- $HOME/.m2
</code></pre><p>I suppose that in case of writing pure Kotlin (non-Android), library configuration would be the same as in regular Java project because everything is built via Gradle. Configuration, which works fine for one of my pure Java libraries looks like that:</p><pre tabindex=0><code>language: java

install:
  # Check install section: http://docs.travis-ci.com/user/build-configuration/#install
  # If you&#39;d like to skip the install stage entirely, set it to true and nothing will be run.
  - true

after_success:
  - bash &lt;(curl -s https://codecov.io/bash)
  - python &lt;(curl -s https://raw.githubusercontent.com/TouK/sputnik-ci/master/sputnik-ci.py)

script:
- ./gradlew clean build test check
</code></pre><p>I don&rsquo;t think that it would require any significant change in case of Kotlin.</p><h2 id=kotlin-vs-java>Kotlin vs. Java<a hidden class=anchor aria-hidden=true href=#kotlin-vs-java>#</a></h2><p>I&rsquo;ve decided to use Kotlin instead of Java to learn a bit more about this language and try something new. Google promotes this language during Google I/O events and recommends to use it for Android development. Moreover, it&rsquo;s regular JVM language, so we can use it anywhere we want - on Android (mobile), on servers and even on desktop apps. I haven&rsquo;t discovered all the features of this language during writing this tiny project, but I have a few observations. Writing code is a bit strange because I got used to programming in Java. In Kotlin, we define the function or variable name first, then we put colon and we define the type next. It&rsquo;s opposite to Java, where types are defined first.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>fun</span> <span class=nf>createBroadcastReceiver</span><span class=p>(</span><span class=n>emitter</span><span class=p>:</span> <span class=n>FlowableEmitter</span><span class=p>&lt;</span><span class=n>BatteryState</span><span class=p>&gt;):</span> <span class=n>BroadcastReceiver</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>status</span><span class=p>:</span> <span class=n>Int</span> <span class=p>=</span> <span class=n>intent</span><span class=p>.</span><span class=n>getIntExtra</span><span class=p>(</span><span class=n>BatteryManager</span><span class=p>.</span><span class=n>EXTRA_STATUS</span><span class=p>,</span> <span class=n>UNKNOWN</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Moreover, there&rsquo;s type inference in Kotlin and sometimes compiler is able to guess our type, so we don&rsquo;t have to provide it. See the following example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>emitter</span> <span class=p>=</span> <span class=n>mock</span><span class=p>(</span><span class=n>FlowableEmitter</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>
</span></span></code></pre></div><p>In addition, we don&rsquo;t have to put semicolon in the end of the statement as you can see on the code snippets above, what is really convenient. The thing, I really like about Kotlin is <strong>null safety</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>intent</span> <span class=o>!=</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>status</span><span class=p>:</span> <span class=n>Int</span> <span class=p>=</span> <span class=n>intent</span><span class=p>.</span><span class=n>getIntExtra</span><span class=p>(</span><span class=n>BatteryManager</span><span class=p>.</span><span class=n>EXTRA_STATUS</span><span class=p>,</span> <span class=n>UNKNOWN</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If we don&rsquo;t do that, code won&rsquo;t compile. We can avoid such null-checks, by using <code>!!.</code> operator like here:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>status</span><span class=p>:</span> <span class=n>Int</span> <span class=p>=</span> <span class=n>intent</span><span class=o>!!</span><span class=p>.</span><span class=n>getIntExtra</span><span class=p>(</span><span class=n>BatteryManager</span><span class=p>.</span><span class=n>EXTRA_STATUS</span><span class=p>,</span> <span class=n>UNKNOWN</span><span class=p>)</span>
</span></span></code></pre></div><p>but by looking at the code, we can see that there are two exclamation marks, so clearly something must be wrong here and we should think about improvement. Moreover, when NPE occurs, it&rsquo;ll be easier to find.</p><p>Kotlin is also <strong>more concise</strong> than Java. It&rsquo;s hard to say if it&rsquo;s an advantage or drawback. In Java we have more code, but we clearly know what&rsquo;s going on when the code is clean. In Kotlin a lot of stuff is <strong>implicit</strong>.</p><p>E.g. inheritance looks as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>()</span>
</span></span></code></pre></div><p>and sometimes we don&rsquo;t have variable provided in the lambda, when there&rsquo;s only one value and we can invoke this value by calling <code>it</code> object</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>batteryDisposable</span> <span class=p>=</span> <span class=n>RxBattery</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=n>observe</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=n>subscribeOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=n>io</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=n>observeOn</span><span class=p>(</span><span class=n>AndroidSchedulers</span><span class=p>.</span><span class=n>mainThread</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=n>subscribe</span> <span class=p>{</span> <span class=n>textView</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=k>it</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span> <span class=p>}</span>
</span></span></code></pre></div><p>The thing I like about implicit Kotlin code is <strong>data classes</strong>. We can create something like that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>data</span> <span class=k>class</span> <span class=nc>BatteryState</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>status</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>plugged</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>health</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>level</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>temperature</span><span class=p>:</span> <span class=n>Int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>voltage</span><span class=p>:</span> <span class=n>Int</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>and it will generate constructor with all these values, getters and <code>toString()</code> method. In Java, we would need to write it by hand, use code generators in the IDE or code generation libraries like Lombok.</p><p>When we take a look at the <strong>control flow</strong> in Kotlin, except for <code>if</code> expression, <code>for</code> and <code>while</code> loops, we also have <code>when</code> expression, which can be kind of neat equivalent to <code>switch</code> instruction in Java. It looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl> <span class=k>fun</span> <span class=nf>plugged</span><span class=p>():</span> <span class=n>Plugged</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=k>when</span> <span class=p>(</span><span class=n>pluggedCode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=n>BatteryManager</span><span class=p>.</span><span class=n>BATTERY_PLUGGED_AC</span> <span class=o>-&gt;</span> <span class=n>Plugged</span><span class=p>.</span><span class=n>AC</span>
</span></span><span class=line><span class=cl>     <span class=n>BatteryManager</span><span class=p>.</span><span class=n>BATTERY_PLUGGED_USB</span> <span class=o>-&gt;</span> <span class=n>Plugged</span><span class=p>.</span><span class=n>USB</span>
</span></span><span class=line><span class=cl>     <span class=n>BatteryManager</span><span class=p>.</span><span class=n>BATTERY_PLUGGED_WIRELESS</span> <span class=o>-&gt;</span> <span class=n>Plugged</span><span class=p>.</span><span class=n>WIRELESS</span>
</span></span><span class=line><span class=cl>     <span class=k>else</span> <span class=o>-&gt;</span> <span class=n>Plugged</span><span class=p>.</span><span class=n>UNKNOWN</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It&rsquo;s worth to say that there&rsquo;s good <strong>inter-operability</strong> between Java and Kotlin. We can use Kotlin modules and libraries in Java projects and vice-versa because everything compiles to the same byte-code. We can even create pure Java code in the Kotlin module. For example, I wanted to have static method called from the Kotlin library. In order to achieve that, I needed to wrap whole class in a Companion Object.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>RxBattery</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Next, in the Kotlin module, I could call it like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>RxBattery</span><span class=p>.</span><span class=n>observe</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span></code></pre></div><p>but in Java module it wasn&rsquo;t possible and I needed to write something like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RxBattery</span><span class=o>.</span><span class=na>Companion</span><span class=o>.</span><span class=na>observe</span><span class=o>(</span><span class=n>context</span><span class=o>);</span>
</span></span></code></pre></div><p>I didn&rsquo;t want library users to call this <code>Companion</code> value explicitely in Java projects, so I created additional Java class.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>RxBatteryFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=nf>RxBatteryFactory</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Flowable</span><span class=o>&lt;</span><span class=n>BatteryState</span><span class=o>&gt;</span> <span class=nf>observe</span><span class=o>(</span><span class=n>Context</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>RxBattery</span><span class=o>.</span><span class=na>Companion</span><span class=o>.</span><span class=na>observe</span><span class=o>(</span><span class=n>context</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>and put it next to the Kotlin classes. Now In Java module, people could call method like that:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RxBatteryFactory</span><span class=o>.</span><span class=na>observe</span><span class=o>(</span><span class=k>this</span><span class=o>)</span>
</span></span></code></pre></div><p>It&rsquo;s good to know that it&rsquo;s possible because when we got stuck with implicit Kotlin syntaxt, we can always use Java in one particular scenario.</p><p>Later, I figured out, we can simply add <code>@JvmStatic</code> annotation before the method signature and since now, method method will be visible as <code>static</code> in the Java modules as well and we no longer need additional Java code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@JvmStatic</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>observe</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=n>Context</span><span class=p>):</span> <span class=n>Flowable</span><span class=p>&lt;</span><span class=n>BatteryState</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Moreover, all classes created in Kotlin are <strong>final by default</strong>. It can cause a problems during writing unit tests and creating mocks. If we want to have non-final class (e.g. in order to mock it), we need to mark it explicitly as <code>open</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>open</span> <span class=k>class</span> <span class=nc>MyClass</span>
</span></span></code></pre></div><p>Of course, things mentioned above are not all features of Kotlin. There&rsquo;s much more to discover - e.g. <a href=https://kotlinlang.org/docs/reference/coroutines.html>couroutines</a>. To learn more, check <a href=https://kotlinlang.org/docs/reference/>Kotlin Language Reference</a>, open-source projects in this language, books, and other articles on the web.</p><p>It&rsquo;s hard to say if in more complex project Kotlin would be a better choice. Right now, I&rsquo;m more familar and comfortable with Java, but on the other hand, Kotlin has a few interesting features, which makes development better. Maybe I&rsquo;ll give this language more chances in the future to learn it better.</p><h2 id=unit-tests>Unit Tests<a hidden class=anchor aria-hidden=true href=#unit-tests>#</a></h2><p>Unit tests in Kotlin are pretty similar to Java.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Test</span> <span class=k>fun</span> <span class=nf>shouldCreateBroadcastReceiver</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// given
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>val</span> <span class=py>emitter</span> <span class=p>=</span> <span class=n>mock</span><span class=p>(</span><span class=n>FlowableEmitter</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// when
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>val</span> <span class=py>broadcastReceiver</span><span class=p>:</span> <span class=n>BroadcastReceiver</span> <span class=p>=</span> <span class=n>RxBattery</span><span class=p>.</span><span class=n>createBroadcastReceiver</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>emitter</span> <span class=k>as</span> <span class=n>FlowableEmitter</span><span class=p>&lt;</span><span class=n>BatteryState</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// then
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>assertThat</span><span class=p>(</span><span class=n>broadcastReceiver</span><span class=p>).</span><span class=n>isNotNull</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can use JUnit and Java assertion libraries like Google Truth and mocking libraries like Mockito. There&rsquo;s also <a href=https://github.com/nhaarman/mockito-kotlin>mockit-kotlin</a> library, but in my case, I used <a href=https://github.com/mockito/mockito>mockito-core</a>. There are also other mocking libraries like <a href=https://github.com/mockk/mockk>Mockk</a> and libraries for BDD like <a href=https://github.com/spekframework/spek>Spek</a>. Moreover, we can achieve more concise syntax for unit tests using various kotlin libraries like <a href=https://github.com/kotlintest/kotlintest>kotlintest</a>. I haven&rsquo;t used it in this project yet, but I may update it in the future.</p><h2 id=javadoc>JavaDoc<a hidden class=anchor aria-hidden=true href=#javadoc>#</a></h2><p>Generating JavaDoc (or KotlinDoc?) in Kotlin projects is not straightforward. In order to generate documentation, I used <a href=https://github.com/Kotlin/dokka>dokka</a> gradle plugin. It&rsquo;s pretty easy to use, we just need to add appropriate dependency, apply the plugin and create configuration in <code>build.gradle</code> file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>dokka</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>outputFormat</span> <span class=o>=</span> <span class=s1>&#39;html&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>outputDirectory</span> <span class=o>=</span> <span class=s2>&#34;$buildDir/javadoc&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Next, we just call: <code>./gradlew dokka</code> and our JavaDoc is generated in defined <code>outputDirectory</code>.</p><h2 id=library-deployment>Library Deployment<a hidden class=anchor aria-hidden=true href=#library-deployment>#</a></h2><p>Library deployment of the Kotlin project is exactly the same as Java project. I simply used <a href=https://github.com/pwittchen/RxBattery/blob/master/maven_push.gradle><code>maven_push.gradle</code></a> script created by Chris Banes some time ago, applied it in the library module and configured everything in <code>gradle.properties</code> and <code>library/gradle.properties</code>. Of course, I also needed to have my credentials configured in <code>~/.gradle/gradle.properties</code> file. Next, I could just call <code>./gradlew uploadArchives</code>, close and release library on the OSS SonaType website.</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>To wrap up, Kotlin is an interesting language. It&rsquo;s hard to say, if it&rsquo;s really better than Java although it has a few interesting features. Nevertheless, it&rsquo;s good to familiarize with it because it&rsquo;s being promoted by Google and JetBrains. JetBrains company actually created and develops this language, so due to this fact, I&rsquo;m able to put more trust in that project. If you would like to see complete code and configuration of the project mentioned in this article, check out my <a href=https://github.com/pwittchen/RxBattery>RxBattery</a> repository on GitHub. Last, but not least, learning new things broadens our mind and horizon.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wittchen.io/tags/java/>java</a></li><li><a href=https://wittchen.io/tags/kotlin/>kotlin</a></li><li><a href=https://wittchen.io/tags/android/>android</a></li><li><a href=https://wittchen.io/tags/gradle/>gradle</a></li></ul><nav class=paginav><a class=prev href=https://wittchen.io/posts/testing-exceptions/><span class=title>« Prev</span><br><span>Testing exceptions</span></a>
<a class=next href=https://wittchen.io/posts/solving-problems-with-avd-and-kvm-on-linux/><span class=title>Next »</span><br><span>Solving problems with AVD and KVM on Linux</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://wittchen.io/>Piotr Wittchen</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>