<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Routing internet via SSH tunnel on Raspberry Pi | Piotr Wittchen</title><meta name=keywords content="linux"><meta name=description content="Problem overview Recently I had the following problem. I wanted to connect to my Raspberry Pi from my laptop. For some reason WiFi dongle on the Raspberry Pi was not working properly. Moreover, I had only one slot available for the LAN connection via cable to the router, so I could connect only one device this way. I wanted to have reliable and fast internet connection on my laptop, but via WiFi it&rsquo;s quite slow."><meta name=author content="Piotr Wittchen"><link rel=canonical href=https://wittchen.io/posts/routing-internet-via-ssh-tunnel-on-raspberry-pi/><link crossorigin=anonymous href=/assets/css/stylesheet.cdcf872f971c70fddc7fd480e8457cd308ed0cf287b498bcdc6183fc6d147858.css integrity="sha256-zc+HL5cccP3cf9SA6EV80wjtDPKHtJi83GGD/G0UeFg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wittchen.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wittchen.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wittchen.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wittchen.io/apple-touch-icon.png><link rel=mask-icon href=https://wittchen.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Routing internet via SSH tunnel on Raspberry Pi"><meta property="og:description" content="Problem overview Recently I had the following problem. I wanted to connect to my Raspberry Pi from my laptop. For some reason WiFi dongle on the Raspberry Pi was not working properly. Moreover, I had only one slot available for the LAN connection via cable to the router, so I could connect only one device this way. I wanted to have reliable and fast internet connection on my laptop, but via WiFi it&rsquo;s quite slow."><meta property="og:type" content="article"><meta property="og:url" content="https://wittchen.io/posts/routing-internet-via-ssh-tunnel-on-raspberry-pi/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-07-25T01:38:00+00:00"><meta property="article:modified_time" content="2015-07-25T01:38:00+00:00"><meta property="og:site_name" content="Piotr Wittchen"><meta name=twitter:card content="summary"><meta name=twitter:title content="Routing internet via SSH tunnel on Raspberry Pi"><meta name=twitter:description content="Problem overview Recently I had the following problem. I wanted to connect to my Raspberry Pi from my laptop. For some reason WiFi dongle on the Raspberry Pi was not working properly. Moreover, I had only one slot available for the LAN connection via cable to the router, so I could connect only one device this way. I wanted to have reliable and fast internet connection on my laptop, but via WiFi it&rsquo;s quite slow."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wittchen.io/posts/"},{"@type":"ListItem","position":2,"name":"Routing internet via SSH tunnel on Raspberry Pi","item":"https://wittchen.io/posts/routing-internet-via-ssh-tunnel-on-raspberry-pi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Routing internet via SSH tunnel on Raspberry Pi","name":"Routing internet via SSH tunnel on Raspberry Pi","description":"Problem overview Recently I had the following problem. I wanted to connect to my Raspberry Pi from my laptop. For some reason WiFi dongle on the Raspberry Pi was not working properly. Moreover, I had only one slot available for the LAN connection via cable to the router, so I could connect only one device this way. I wanted to have reliable and fast internet connection on my laptop, but via WiFi it\u0026rsquo;s quite slow.","keywords":["linux"],"articleBody":"Problem overview Recently I had the following problem. I wanted to connect to my Raspberry Pi from my laptop. For some reason WiFi dongle on the Raspberry Pi was not working properly. Moreover, I had only one slot available for the LAN connection via cable to the router, so I could connect only one device this way. I wanted to have reliable and fast internet connection on my laptop, but via WiFi it’s quite slow. To sum the things up two goals were clear:\n to have fast and reliable internet connection on the laptop to be able to connect to Raspberry Pi via SSH in order to control it from the laptop  Enabling SSH server on Raspberry Pi Before we proceed to the next steps, we need to enable SSH server on Raspberry Pi if we haven’t done it in the past. In order to do that, we need to go through the following steps:\n login with the following information when prompted: username: pi password: raspberry type the following command in the terminal: sudo raspi-config then navigate to ssh hit Enter select enable ssh server reboot device we are done!  Sshuttle to the rescue I tried a few different approaches to solve described problem, but up to now the only one solution satisfies me well. I’ve found discussion starting with the question How do I route my internet through a SSH tunnel? In this discussion, I’ve read about great tool called sshuttle, which works as a poor man’s VPN.\n sshuttle is a transparent proxy server that forwards over a SSH connection and sets up a proxy by running Python scripts on the remote server. sshuttle can be run under the following conditions:\n client machine or router is Linux-based, FreeBSD or Mac OS administrative privileges on client access to remote network via SSH no administrator privileges on remote network availability of Python on remote server   sshutle can be installed with the following command:\nsudo apt-get install sshuttle The basic command for running sshuttle with routing all traffic is:\nsshuttle -r username@sshserver:port 0/0  Upon the execution of the command, a sudo password prompt will appear and subsequently the password to SSH account. No other details will appear except for a short message and return to shell upon failure. For more status messages, run sshuttle in verbose mode with the -v flag. In this example all internet traffic except DNS is routed through the VPN. -r flag denotes the remote hostname and optional username and port that follows in the above example. 0/0 is short for 0.0.0.0/0 that represents the subnets to route over the VPN. The usage of 0/0 routes all the traffic except DNS requests to the remote server. DNS tunelling is possible with the usage of -H flag. Please read the man page (man sshuttle) for the details of options and modes under which sshuttle can run. For information about the concept and more examples, refer to the project page.\n - André Paramés on askubuntu.com\nConnecting to Raspberry Pi and tunneling internet connection Luckily, all requirements were satisfied by Raspberry Pi and I could use it with sshuttle, so I’ve installed this software on my laptop. I’ve connected to my local network through WiFi. Then, I’ve scanned network with nmap to find IP of Raspberry Pi.\nnmap -sP 192.168.1.0/24 My local network consists of only few devices and each of them has a description, so I could easily identify IP of the Raspberry Pi. Output looked like this:\nNmap scan report for livebox.home (192.168.1.1) Host is up (0.0070s latency). Nmap scan report for laptop-piotra-\\*samsung-ultrabook\\*.home (192.168.1.14) Host is up (0.00011s latency). Nmap scan report for pc36.home (192.168.1.17) Host is up (0.018s latency). Nmap done: 256 IP addresses (3 hosts up) scanned in 2.64 seconds Right now, active devices in my network are: router, my laptop and Raspberry Pi, with IP: 192.168.1.17. After that, I connected to Raspberry Pi with the following command:\nsshuttle -r pi@192.168.1.17 0/0 It asked me about the local password and then about the password of remote host, which is raspberry by default and I saw the following message:\nConnected. Everything was fine. I was connected to Raspberry Pi and I was able to access internet through it. Next, I opened another terminal window and tried to connect to Raspberry Pi via SSH. Please note, that you have to enable remote access via SSH on Raspberry Pi before you try to establish connection. When SSH is enabled, you can type the following command:\nssh pi@192.168.1.17 Then I typed correct password and I was connected!\nLinux raspberrypi 3.18.7+ #755 PREEMPT Thu Feb 12 17:14:31 GMT 2015 armv6l The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Jul 25 01:49:00 2015 from pc36.home Short summary What is surprising tunneled internet connection was fast and stable when I was accessing it through Raspberry Pi. When I was accessing internet directly through WiFi on the router it was really slow for some unknown reason. Luckily, I’ve achieved my goals: I’ve fast internet connection on the laptop and I could establish SSH connection with Raspberry Pi over local network.\n","wordCount":"880","inLanguage":"en","datePublished":"2015-07-25T01:38:00Z","dateModified":"2015-07-25T01:38:00Z","author":{"@type":"Person","name":"Piotr Wittchen"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wittchen.io/posts/routing-internet-via-ssh-tunnel-on-raspberry-pi/"},"publisher":{"@type":"Organization","name":"Piotr Wittchen","logo":{"@type":"ImageObject","url":"https://wittchen.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wittchen.io/ accesskey=h title="Piotr Wittchen (Alt + H)"><img src=https://wittchen.io/apple-touch-icon.png alt aria-label=logo height=35>Piotr Wittchen</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wittchen.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://wittchen.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://wittchen.io/talks/ title=talks><span>talks</span></a></li><li><a href=https://wittchen.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://wittchen.io/contact/ title=contact><span>contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wittchen.io/>Home</a>&nbsp;»&nbsp;<a href=https://wittchen.io/posts/>Posts</a></div><h1 class=post-title>Routing internet via SSH tunnel on Raspberry Pi</h1><div class=post-meta><span title="2015-07-25 01:38:00 +0000 UTC">July 25, 2015</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;880 words&nbsp;·&nbsp;Piotr Wittchen&nbsp;|&nbsp;<a href=https://github.com/pwittchen/wittchen.io/blob/master/content/posts/routing-internet-via-ssh-tunnel-on-raspberry-pi.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=problem-overview>Problem overview<a hidden class=anchor aria-hidden=true href=#problem-overview>#</a></h2><p>Recently I had the following problem. I wanted to connect to my Raspberry Pi from my laptop. For some reason WiFi dongle on the Raspberry Pi was not working properly. Moreover, I had only one slot available for the LAN connection via cable to the router, so I could connect only one device this way. I wanted to have reliable and fast internet connection on my laptop, but via WiFi it&rsquo;s quite slow. To sum the things up two goals were clear:</p><ol><li>to have fast and reliable internet connection on the laptop</li><li>to be able to connect to Raspberry Pi via SSH in order to control it from the laptop</li></ol><h2 id=enabling-ssh-server-on-raspberry-pi>Enabling SSH server on Raspberry Pi<a hidden class=anchor aria-hidden=true href=#enabling-ssh-server-on-raspberry-pi>#</a></h2><p>Before we proceed to the next steps, we need to enable SSH server on Raspberry Pi if we haven&rsquo;t done it in the past. In order to do that, we need to go through the following steps:</p><ol><li>login with the following information when prompted: username: <code>pi</code> password: <code>raspberry</code></li><li>type the following command in the terminal: <code>sudo raspi-config</code></li><li>then navigate to <code>ssh</code></li><li>hit Enter</li><li>select <code>enable ssh server</code></li><li>reboot device</li><li>we are done!</li></ol><h2 id=sshuttle-to-the-rescue>Sshuttle to the rescue<a hidden class=anchor aria-hidden=true href=#sshuttle-to-the-rescue>#</a></h2><p>I tried a few different approaches to solve described problem, but up to now the only one solution satisfies me well. I&rsquo;ve found discussion starting with the question <a href=http://askubuntu.com/questions/45075/how-do-i-route-my-internet-through-a-ssh-tunnel>How do I route my internet through a SSH tunnel?</a> In this discussion, I&rsquo;ve read about great tool called <a href=https://github.com/apenwarr/sshuttle/>sshuttle</a>, which works as a poor man&rsquo;s VPN.</p><blockquote><p><strong>sshuttle</strong> is a transparent proxy server that forwards over a SSH connection and sets up a proxy by running Python scripts on the remote server. sshuttle can be run under the following conditions:</p><ul><li>client machine or router is Linux-based, FreeBSD or Mac OS</li><li>administrative privileges on client</li><li>access to remote network via SSH</li><li>no administrator privileges on remote network</li><li>availability of Python on remote server</li></ul></blockquote><p>sshutle can be installed with the following command:</p><pre tabindex=0><code>sudo apt-get install sshuttle
</code></pre><p>The basic command for running sshuttle with routing all traffic is:</p><pre tabindex=0><code>sshuttle -r username@sshserver:port 0/0
</code></pre><blockquote><p>Upon the execution of the command, a sudo password prompt will appear and subsequently the password to SSH account. No other details will appear except for a short message and return to shell upon failure. For more status messages, run sshuttle in verbose mode with the -v flag. In this example all internet traffic except DNS is routed through the VPN. -r flag denotes the remote hostname and optional username and port that follows in the above example. 0/0 is short for 0.0.0.0/0 that represents the subnets to route over the VPN. The usage of 0/0 routes all the traffic except DNS requests to the remote server. DNS tunelling is possible with the usage of -H flag. Please read the man page (man sshuttle) for the details of options and modes under which sshuttle can run. For information about the concept and more examples, refer to the project page.</p></blockquote><p>- André Paramés on askubuntu.com</p><h2 id=connecting-to-raspberry-pi-and-tunneling-internet-connection>Connecting to Raspberry Pi and tunneling internet connection<a hidden class=anchor aria-hidden=true href=#connecting-to-raspberry-pi-and-tunneling-internet-connection>#</a></h2><p>Luckily, all requirements were satisfied by Raspberry Pi and I could use it with sshuttle, so I&rsquo;ve installed this software on my laptop. I&rsquo;ve connected to my local network through WiFi. Then, I&rsquo;ve scanned network with <code>nmap</code> to find IP of Raspberry Pi.</p><pre tabindex=0><code>nmap -sP 192.168.1.0/24
</code></pre><p>My local network consists of only few devices and each of them has a description, so I could easily identify IP of the Raspberry Pi. Output looked like this:</p><pre tabindex=0><code>Nmap scan report for livebox.home (192.168.1.1)
Host is up (0.0070s latency).
Nmap scan report for laptop-piotra-\*samsung-ultrabook\*.home (192.168.1.14)
Host is up (0.00011s latency).
Nmap scan report for pc36.home (192.168.1.17)
Host is up (0.018s latency).
Nmap done: 256 IP addresses (3 hosts up) scanned in 2.64 seconds
</code></pre><p>Right now, active devices in my network are: router, my laptop and Raspberry Pi, with IP: 192.168.1.17. After that, I connected to Raspberry Pi with the following command:</p><pre tabindex=0><code>sshuttle -r pi@192.168.1.17 0/0
</code></pre><p>It asked me about the local password and then about the password of remote host, which is <code>raspberry</code> by default and I saw the following message:</p><pre tabindex=0><code>Connected.
</code></pre><p>Everything was fine. I was connected to Raspberry Pi and I was able to access internet through it. Next, I opened another terminal window and tried to connect to Raspberry Pi via SSH. Please note, that you have to enable remote access via SSH on Raspberry Pi before you try to establish connection. When SSH is enabled, you can type the following command:</p><pre tabindex=0><code>ssh pi@192.168.1.17
</code></pre><p>Then I typed correct password and I was connected!</p><pre tabindex=0><code>Linux raspberrypi 3.18.7+ #755 PREEMPT Thu Feb 12 17:14:31 GMT 2015 armv6l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sat Jul 25 01:49:00 2015 from pc36.home
</code></pre><h2 id=short-summary>Short summary<a hidden class=anchor aria-hidden=true href=#short-summary>#</a></h2><p>What is surprising tunneled internet connection was fast and stable when I was accessing it through Raspberry Pi. When I was accessing internet directly through WiFi on the router it was really slow for some unknown reason. Luckily, I&rsquo;ve achieved my goals: I&rsquo;ve fast internet connection on the laptop and I could establish SSH connection with Raspberry Pi over local network.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wittchen.io/tags/linux/>linux</a></li></ul><nav class=paginav><a class=prev href=https://wittchen.io/posts/releasing-network-events-2/><span class=title>« Prev</span><br><span>Releasing NetworkEvents 2.0.0</span></a>
<a class=next href=https://wittchen.io/posts/searching-word-in-a-string-with-kmp-algorithm/><span class=title>Next »</span><br><span>Searching word in a string with KMP algorithm</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://wittchen.io/>Piotr Wittchen</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>