<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Air quality monitoring script for Argos (Linux) and BitBar (macOS) | Piotr Wittchen</title><meta name=keywords content="linux"><meta name=description content="From some time, I wanted to create my own app, which will display some data in top panel in macOS or Gnome environment on Linux. I collected some resources about that and I knew that for macOS I need to write an app in Obj-C and for Gnome I need to write a plugin in JavaScript. In both cases it requires some ceremony and preparation. Recently I&rsquo;ve found a great app for macOS called BitBar (by the way it&rsquo;s open-source)."><meta name=author content="Piotr Wittchen"><link rel=canonical href=https://wittchen.io/posts/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/><link crossorigin=anonymous href=/assets/css/stylesheet.cdcf872f971c70fddc7fd480e8457cd308ed0cf287b498bcdc6183fc6d147858.css integrity="sha256-zc+HL5cccP3cf9SA6EV80wjtDPKHtJi83GGD/G0UeFg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wittchen.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wittchen.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wittchen.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wittchen.io/apple-touch-icon.png><link rel=mask-icon href=https://wittchen.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Air quality monitoring script for Argos (Linux) and BitBar (macOS)"><meta property="og:description" content="From some time, I wanted to create my own app, which will display some data in top panel in macOS or Gnome environment on Linux. I collected some resources about that and I knew that for macOS I need to write an app in Obj-C and for Gnome I need to write a plugin in JavaScript. In both cases it requires some ceremony and preparation. Recently I&rsquo;ve found a great app for macOS called BitBar (by the way it&rsquo;s open-source)."><meta property="og:type" content="article"><meta property="og:url" content="https://wittchen.io/posts/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-12-29T10:02:00+00:00"><meta property="article:modified_time" content="2017-12-29T10:02:00+00:00"><meta property="og:site_name" content="Piotr Wittchen"><meta name=twitter:card content="summary"><meta name=twitter:title content="Air quality monitoring script for Argos (Linux) and BitBar (macOS)"><meta name=twitter:description content="From some time, I wanted to create my own app, which will display some data in top panel in macOS or Gnome environment on Linux. I collected some resources about that and I knew that for macOS I need to write an app in Obj-C and for Gnome I need to write a plugin in JavaScript. In both cases it requires some ceremony and preparation. Recently I&rsquo;ve found a great app for macOS called BitBar (by the way it&rsquo;s open-source)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wittchen.io/posts/"},{"@type":"ListItem","position":2,"name":"Air quality monitoring script for Argos (Linux) and BitBar (macOS)","item":"https://wittchen.io/posts/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Air quality monitoring script for Argos (Linux) and BitBar (macOS)","name":"Air quality monitoring script for Argos (Linux) and BitBar (macOS)","description":"From some time, I wanted to create my own app, which will display some data in top panel in macOS or Gnome environment on Linux. I collected some resources about that and I knew that for macOS I need to write an app in Obj-C and for Gnome I need to write a plugin in JavaScript. In both cases it requires some ceremony and preparation. Recently I\u0026rsquo;ve found a great app for macOS called BitBar (by the way it\u0026rsquo;s open-source).","keywords":["linux"],"articleBody":"From some time, I wanted to create my own app, which will display some data in top panel in macOS or Gnome environment on Linux. I collected some resources about that and I knew that for macOS I need to write an app in Obj-C and for Gnome I need to write a plugin in JavaScript. In both cases it requires some ceremony and preparation. Recently I’ve found a great app for macOS called BitBar (by the way it’s open-source). BitBar allows to put anything to macOS menu bar (top panel) in no time! With this project creating top panel apps is simplified to the limit. Moreover, there’s another project called Argos, which does the same thing, but for Linux with Gnome (it’s an open-source Gnome Extension). In both cases, we just need to create a shell script, put it into appropriate directory (in case of Argos, it’s ~/.config/argos/ and in case of BitBar, we define it during the installation or first run) and then app displays our data automatically. We can also set refresh rate. E.g. if we want our script to be executed every 60 seconds, we can name it script.60s.sh. We can also create more advanced scripts and more details can be found in BitBar and Argos documentation. In my case, I wanted to create a script, which reads CAQI (Common Air Quality Index) in my current location based on Airly sensors. Airly provides nice API, which we can use in our projects. Please remember that most of the sensors are located in Poland. On my Ubuntu Linux with Gnome 3, I created a new script in the following path:\n~/.config/argos/caqi.60s.sh For a BitBar script location could be different. Both for BitBar and Argos follow the same naming convention. My script looks as follows:\n#!/usr/bin/env bash  CAQI=$(curl -s -X GET --header 'Accept: application/json' --header 'apikey: YOUR_API_KEY' \\  'https://airapi.airly.eu/v1/nearestSensor/measurements?latitude=YOUR_LATITUDE\u0026longitude=YOUR_LONGITUDE\u0026maxDistance=1000' \\  | jq .airQualityIndex | cut -f1 -d\".\") MSG=\"Unknown\" case 1 in $(($CAQI = 25))) MSG=\"Great!\";; $(($CAQI = 50))) MSG=\"Good!\";; $(($CAQI = 75))) MSG=\"Medium\";; $(($CAQI = 100))) MSG=\"Bad\";; $(($CAQI = 101))) MSG=\"Very Bad\";; esac echo \"CAQI: $CAQI($MSG)\" Please note, script above was created for API v. 1. If you’re interested in the latest version of the script, have a look at https://github.com/pwittchen/airly.sh repository.\nIt works fine on Linux. The only requirement is to install jq. For macOS, I needed to change jq to /usr/local/bin/jq to make it work. I gathered information about air quality level from this website: https://www.airqualitynow.eu/pl/about_indices_definition.php [PL]. Of course, we need to replace API_KEY with our api key, which we can get from https://developer.airly.eu/ website as well as YOUR_LATITUDE and YOUR_LONGITUDE with coordinates of our location. It can be static location in our city. We can get them e.g. from Google Maps.\nAs a result, we have beautiful text in our top panel:\nThis screenshot was taken on Ubuntu Linux with Gnome 3. On macOS it works the same (I checked it).\n","wordCount":"486","inLanguage":"en","datePublished":"2017-12-29T10:02:00Z","dateModified":"2017-12-29T10:02:00Z","author":{"@type":"Person","name":"Piotr Wittchen"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wittchen.io/posts/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/"},"publisher":{"@type":"Organization","name":"Piotr Wittchen","logo":{"@type":"ImageObject","url":"https://wittchen.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wittchen.io/ accesskey=h title="Piotr Wittchen (Alt + H)"><img src=https://wittchen.io/apple-touch-icon.png alt aria-label=logo height=35>Piotr Wittchen</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wittchen.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://wittchen.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://wittchen.io/talks/ title=talks><span>talks</span></a></li><li><a href=https://github.com/pwittchen title=code><span>code</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://wittchen.io/setup/ title=setup><span>setup</span></a></li><li><a href=https://wittchen.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://wittchen.io/contact/ title=contact><span>contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wittchen.io/>Home</a>&nbsp;»&nbsp;<a href=https://wittchen.io/posts/>Posts</a></div><h1 class=post-title>Air quality monitoring script for Argos (Linux) and BitBar (macOS)</h1><div class=post-meta><span title="2017-12-29 10:02:00 +0000 UTC">December 29, 2017</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;486 words&nbsp;·&nbsp;Piotr Wittchen&nbsp;|&nbsp;<a href=https://github.com/pwittchen/wittchen.io/blob/master/content/posts/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>From some time, I wanted to create my own app, which will display some data in top panel in macOS or Gnome environment on Linux. I collected some resources about that and I knew that for macOS I need to write an app in Obj-C and for Gnome I need to write a plugin in JavaScript. In both cases it requires some ceremony and preparation. Recently I&rsquo;ve found a great app for macOS called <a href=https://getbitbar.com/>BitBar</a> (by the way it&rsquo;s <a href=https://github.com/matryer/bitbar>open-source</a>). BitBar allows to put anything to macOS menu bar (top panel) in no time! With this project creating top panel apps is simplified to the limit. Moreover, there&rsquo;s another project called <a href=https://extensions.gnome.org/extension/1176/argos/>Argos</a>, which does the same thing, but for Linux with Gnome (it&rsquo;s an <a href=https://github.com/p-e-w/argos>open-source</a> Gnome Extension). In both cases, we just need to create a shell script, put it into appropriate directory (in case of Argos, it&rsquo;s <code>~/.config/argos/</code> and in case of BitBar, we define it during the installation or first run) and then app displays our data automatically. We can also set refresh rate. E.g. if we want our script to be executed every 60 seconds, we can name it <code>script.60s.sh</code>. We can also create more advanced scripts and more details can be found in BitBar and Argos documentation. In my case, I wanted to create a script, which reads <code>CAQI</code> (Common Air Quality Index) in my current location based on <a href=http://airly.eu/>Airly</a> sensors. Airly provides nice <a href=https://airly.eu/en/api/>API</a>, which we can use in our projects. Please remember that most of the sensors are located in Poland. On my Ubuntu Linux with Gnome 3, I created a new script in the following path:</p><pre tabindex=0><code>~/.config/argos/caqi.60s.sh
</code></pre><p>For a BitBar script location could be different. Both for BitBar and Argos follow the same naming convention. My script looks as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>CAQI</span><span class=o>=</span><span class=k>$(</span>curl -s -X GET --header <span class=s1>&#39;Accept: application/json&#39;</span> --header <span class=s1>&#39;apikey: YOUR_API_KEY&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=s1>&#39;https://airapi.airly.eu/v1/nearestSensor/measurements?latitude=YOUR_LATITUDE&amp;longitude=YOUR_LONGITUDE&amp;maxDistance=1000&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=p>|</span> jq .airQualityIndex <span class=p>|</span> cut -f1 -d<span class=s2>&#34;.&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>MSG</span><span class=o>=</span><span class=s2>&#34;Unknown&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=m>1</span> in
</span></span><span class=line><span class=cl>  <span class=k>$((</span><span class=nv>$CAQI</span> &lt;<span class=o>=</span> <span class=m>25</span><span class=k>))</span><span class=o>)</span>  <span class=nv>MSG</span><span class=o>=</span><span class=s2>&#34;Great!&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>$((</span><span class=nv>$CAQI</span> &lt;<span class=o>=</span> <span class=m>50</span><span class=k>))</span><span class=o>)</span>  <span class=nv>MSG</span><span class=o>=</span><span class=s2>&#34;Good!&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>$((</span><span class=nv>$CAQI</span> &lt;<span class=o>=</span> <span class=m>75</span><span class=k>))</span><span class=o>)</span>  <span class=nv>MSG</span><span class=o>=</span><span class=s2>&#34;Medium&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>$((</span><span class=nv>$CAQI</span> &lt;<span class=o>=</span> <span class=m>100</span><span class=k>))</span><span class=o>)</span> <span class=nv>MSG</span><span class=o>=</span><span class=s2>&#34;Bad&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>$((</span><span class=nv>$CAQI</span> &gt;<span class=o>=</span> <span class=m>101</span><span class=k>))</span><span class=o>)</span> <span class=nv>MSG</span><span class=o>=</span><span class=s2>&#34;Very Bad&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;CAQI: </span><span class=nv>$CAQI</span><span class=s2> (</span><span class=nv>$MSG</span><span class=s2>)&#34;</span>
</span></span></code></pre></div><p>Please note, script above was created for API v. 1. If you&rsquo;re interested in the latest version of the script, have a look at <a href=https://github.com/pwittchen/airly.sh>https://github.com/pwittchen/airly.sh</a> repository.</p><p>It works fine on Linux. The only requirement is to install <a href=https://stedolan.github.io/jq/>jq</a>. For macOS, I needed to change <code>jq</code> to <code>/usr/local/bin/jq</code> to make it work. I gathered information about air quality level from this website: <a href=https://www.airqualitynow.eu/pl/about_indices_definition.php>https://www.airqualitynow.eu/pl/about_indices_definition.php</a> [PL]. Of course, we need to replace <code>API_KEY</code> with our api key, which we can get from <a href=https://developer.airly.eu/>https://developer.airly.eu/</a> website as well as <code>YOUR_LATITUDE</code> and <code>YOUR_LONGITUDE</code> with coordinates of our location. It can be static location in our city. We can get them e.g. from Google Maps.</p><p>As a result, we have beautiful text in our top panel:</p><p><img loading=lazy src=/posts/2017/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/caqish.png alt></p><p>This screenshot was taken on Ubuntu Linux with Gnome 3. On macOS it works the same (I checked it).</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wittchen.io/tags/linux/>linux</a></li></ul><nav class=paginav><a class=prev href=https://wittchen.io/posts/quality-meetup-15-fixing-a-billion-dollar-mistake/><span class=title>« Prev</span><br><span>Quality Meetup no. 15 - Fixing a billion dollar mistake</span></a>
<a class=next href=https://wittchen.io/posts/creating-a-docker-container-with-alpine-linux-including-java-8-and-9/><span class=title>Next »</span><br><span>Creating a Docker container with Alpine Linux including Java 8 and 9</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://wittchen.io/>Piotr Wittchen</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>