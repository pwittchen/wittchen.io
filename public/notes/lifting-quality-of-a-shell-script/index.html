<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Lifting quality of a shell script | Piotr Wittchen</title><meta name=keywords content="testing,linux"><meta name=description content="Introduction
In release cycle of our team at work, we need to perform so-called system tests. In order to do that, we need to log into Artifactory, search for the latest release package, check if it&rsquo;s up to date, download it, unzip it, install internal configuration recipe, compile, initialize & run it. Not all of that can be easily automated, but I thought that at least searching & downloading phase can be done from the terminal in a semi-automated way. That&rsquo;s why I created ydownloader shell script."><meta name=author content="Piotr Wittchen"><link rel=canonical href=https://wittchen.io/notes/lifting-quality-of-a-shell-script/><link crossorigin=anonymous href=/assets/css/stylesheet.3e856885a53e44bbe2e6d65b620b74bcbb62fa7b127ddff6de7809a1b0b38891.css integrity="sha256-PoVohaU+RLvi5tZbYgt0vLti+nsSfd/23ngJobCziJE=" rel="preload stylesheet" as=style><link rel=icon href=https://wittchen.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wittchen.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wittchen.io/favicon-32x32.png><link rel=apple-touch-icon href=https://wittchen.io/apple-touch-icon.png><link rel=mask-icon href=https://wittchen.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wittchen.io/notes/lifting-quality-of-a-shell-script/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer crossorigin=anonymous src=/js/search-modal-bundle.min.464e703fc7e82294269b593c8221c39ec3b37e76ba58e5c9d41711b6f2945064.js integrity="sha256-Rk5wP8foIpQmm1k8giHDnsOzfna6WOXJ1BcRtvKUUGQ="></script><meta property="og:url" content="https://wittchen.io/notes/lifting-quality-of-a-shell-script/"><meta property="og:site_name" content="Piotr Wittchen"><meta property="og:title" content="Lifting quality of a shell script"><meta property="og:description" content="Introduction In release cycle of our team at work, we need to perform so-called system tests. In order to do that, we need to log into Artifactory, search for the latest release package, check if it’s up to date, download it, unzip it, install internal configuration recipe, compile, initialize & run it. Not all of that can be easily automated, but I thought that at least searching & downloading phase can be done from the terminal in a semi-automated way. That’s why I created ydownloader shell script."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2016-11-30T23:29:00+00:00"><meta property="article:modified_time" content="2016-11-30T23:29:00+00:00"><meta property="article:tag" content="Testing"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lifting quality of a shell script"><meta name=twitter:description content="Introduction
In release cycle of our team at work, we need to perform so-called system tests. In order to do that, we need to log into Artifactory, search for the latest release package, check if it&rsquo;s up to date, download it, unzip it, install internal configuration recipe, compile, initialize & run it. Not all of that can be easily automated, but I thought that at least searching & downloading phase can be done from the terminal in a semi-automated way. That&rsquo;s why I created ydownloader shell script."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://wittchen.io/notes/"},{"@type":"ListItem","position":2,"name":"Lifting quality of a shell script","item":"https://wittchen.io/notes/lifting-quality-of-a-shell-script/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Lifting quality of a shell script","name":"Lifting quality of a shell script","description":"Introduction In release cycle of our team at work, we need to perform so-called system tests. In order to do that, we need to log into Artifactory, search for the latest release package, check if it\u0026rsquo;s up to date, download it, unzip it, install internal configuration recipe, compile, initialize \u0026amp; run it. Not all of that can be easily automated, but I thought that at least searching \u0026amp; downloading phase can be done from the terminal in a semi-automated way. That\u0026rsquo;s why I created ydownloader shell script.\n","keywords":["testing","linux"],"articleBody":"Introduction In release cycle of our team at work, we need to perform so-called system tests. In order to do that, we need to log into Artifactory, search for the latest release package, check if it’s up to date, download it, unzip it, install internal configuration recipe, compile, initialize \u0026 run it. Not all of that can be easily automated, but I thought that at least searching \u0026 downloading phase can be done from the terminal in a semi-automated way. That’s why I created ydownloader shell script.\nWriting a script with unit tests and continuous integration I’m not an expert in shell scripting, so I also wanted to learn more about it. In addition, I wanted to apply best software development practices in that script. Someone can say that in the case of a simple shell script proper engineering may be a superfluity, but in my opinion, the simplicity of the project is not an excuse for doing it the right way. Especially, if we want to use it in the future. That’s why I divided this script into smaller functions, added command line arguments handling and help for the users. Moreover, I added unit tests with shunit2 (yes, we can write unit tests for the shell scripts) and continuous integration with Travis CI server. In the “Clean Code” book, we can read that code without unit tests is not clean by definition. After dividing script into smaller functions, it was much easier to test it. My script is accepting command line arguments, so I needed to do the following trick to make it testable and include it in the testing script:\nif [ \"$TEST_MODE\" == \"\" ] then TEST_MODE=false fi if [ \"$TEST_MODE\" = false ] ; then # parse command line arguments here... else echo \"TEST_MODE enabled\" fi Then, I could write unit tests:\nTEST_MODE=true . ./ydownloader # load script to be tested echo \"RUNNING UNIT TESTS...\" testCutLastChars() { # given valueToCut='testString' expectedValue='testStri' # when actualValue=$(echo $valueToCut | cutLastChars 3) # then assertEquals $expectedValue $actualValue } # more tests goes here... . ./shunit2/shunit2 # load shunit2 There are also other solutions for unit testing like bats, assert.sh and others. We can choose what we like. We can also use additional tools like shunit2-colorize to make our console output of shunit2 tests look like a rainbow if we are not fans of monochromatic terminal. Moreover, we can use static code analysis tools for shell scripts like shellcheck. In addition, I prepared simple install script, which allows to install script locally via curl or wget. Of course, project has sufficient documentation in README.md file.\nShort recap It was really nice coding exercise. Now, I feel much more comfortable with shell scripting, but there’s still a lot to learn. I recommend trying applying a similar approach in your scripts if you haven’t done it yet. If you want to browse complete project, check it out in my repository: https://github.com/pwittchen/ydownloader.\n","wordCount":"488","inLanguage":"en","datePublished":"2016-11-30T23:29:00Z","dateModified":"2016-11-30T23:29:00Z","author":{"@type":"Person","name":"Piotr Wittchen"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wittchen.io/notes/lifting-quality-of-a-shell-script/"},"publisher":{"@type":"Organization","name":"Piotr Wittchen","logo":{"@type":"ImageObject","url":"https://wittchen.io/favicon.ico"}}}</script><script defer data-website-id=dfid_D4sN47CVgrrCRR7KCciN3 data-domain=wittchen.io src=https://datafa.st/js/script.js></script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wittchen.io/ accesskey=h title="Piotr Wittchen (Alt + H)">Piotr Wittchen</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><button id=menu-toggle class=menu-toggle aria-label="Toggle menu" aria-expanded=false>
<svg class="hamburger-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
<svg class="close-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button><ul id=menu><li><a href=https://wittchen.io/about/ title=about><span>about</span></a></li><li><a href=https://wittchen.io/notes/ title=notes><span>notes</span></a></li><li><a href=https://wittchen.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://wittchen.io/talks/ title=talks><span>talks</span></a></li><li><a href=https://wittchen.io/projects/ title=projects><span>projects</span></a></li><li><a href=https://wittchen.io/search/ title="search (⌘K / Ctrl+K)"><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wittchen.io/>Home</a>&nbsp;»&nbsp;<a href=https://wittchen.io/notes/>Notes</a></div><h1 class="post-title entry-hint-parent">Lifting quality of a shell script</h1><div class=post-meta><span title='2016-11-30 23:29:00 +0000 UTC'>November 30, 2016</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;488 words&nbsp;·&nbsp;Piotr Wittchen&nbsp;|&nbsp;<a href=https://github.com/pwittchen/wittchen.io/blob/master/content/notes/lifting-quality-of-a-shell-script.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>In release cycle of our team at work, we need to perform so-called system tests. In order to do that, we need to log into Artifactory, search for the latest release package, check if it&rsquo;s up to date, download it, unzip it, install internal configuration recipe, compile, initialize & run it. Not all of that can be easily automated, but I thought that at least searching & downloading phase can be done from the terminal in a semi-automated way. That&rsquo;s why I created <a href=https://github.com/pwittchen/ydownloader><strong>ydownloader</strong></a> shell script.</p><h2 id=writing-a-script-with-unit-tests-and-continuous-integration>Writing a script with unit tests and continuous integration<a hidden class=anchor aria-hidden=true href=#writing-a-script-with-unit-tests-and-continuous-integration>#</a></h2><p>I&rsquo;m not an expert in shell scripting, so I also wanted to learn more about it. In addition, I wanted to apply best software development practices in that script. Someone can say that in the case of a simple shell script proper engineering may be a superfluity, but in my opinion, the simplicity of the project is not an excuse for doing it the right way. Especially, if we want to use it in the future. That&rsquo;s why I divided this script into smaller functions, added command line arguments handling and help for the users. Moreover, I added <a href=https://github.com/pwittchen/ydownloader/blob/master/test.sh>unit tests</a> with <a href=https://github.com/kward/shunit2>shunit2</a> (yes, we can write unit tests for the shell scripts) and <a href=https://travis-ci.org/pwittchen/ydownloader>continuous integration with Travis CI</a> server. In the &ldquo;Clean Code&rdquo; book, we can read that code without unit tests is not clean by definition. After dividing script into smaller functions, it was much easier to test it. My script is accepting command line arguments, so I needed to do the following trick to make it testable and include it in the testing script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$TEST_MODE</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span> <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nv>TEST_MODE</span><span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$TEST_MODE</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=nb>false</span> <span class=o>]</span> <span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=c1># parse command line arguments here...</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;TEST_MODE enabled&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><p>Then, I could write unit tests:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>TEST_MODE</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>. ./ydownloader <span class=c1># load script to be tested</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;RUNNING UNIT TESTS...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>testCutLastChars<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1># given</span>
</span></span><span class=line><span class=cl>  <span class=nv>valueToCut</span><span class=o>=</span><span class=s1>&#39;testString&#39;</span>
</span></span><span class=line><span class=cl>  <span class=nv>expectedValue</span><span class=o>=</span><span class=s1>&#39;testStri&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># when</span>
</span></span><span class=line><span class=cl>  <span class=nv>actualValue</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=nv>$valueToCut</span> <span class=p>|</span> cutLastChars 3<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># then</span>
</span></span><span class=line><span class=cl>  assertEquals <span class=nv>$expectedValue</span> <span class=nv>$actualValue</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># more tests goes here...</span>
</span></span><span class=line><span class=cl>. ./shunit2/shunit2 <span class=c1># load shunit2</span>
</span></span></code></pre></div><p>There are also other solutions for unit testing like <a href=https://github.com/sstephenson/bats>bats</a>, <a href=https://github.com/lehmannro/assert.sh>assert.sh</a> and others. We can choose what we like. We can also use additional tools like <a href=https://github.com/joelpurra/shunit2-colorize>shunit2-colorize</a> to make our console output of shunit2 tests look like a rainbow if we are not fans of monochromatic terminal. Moreover, we can use static code analysis tools for shell scripts like <a href=https://github.com/koalaman/shellcheck>shellcheck</a>. In addition, I prepared simple <a href=https://github.com/pwittchen/ydownloader/blob/master/install.sh>install script</a>, which allows to install script locally via <code>curl</code> or <code>wget</code>. Of course, project has sufficient documentation in <code>README.md</code> file.</p><h2 id=short-recap>Short recap<a hidden class=anchor aria-hidden=true href=#short-recap>#</a></h2><p>It was really nice coding exercise. Now, I feel much more comfortable with shell scripting, but there&rsquo;s still a lot to learn. I recommend trying applying a similar approach in your scripts if you haven&rsquo;t done it yet. If you want to browse complete project, check it out in my repository: <a href=https://github.com/pwittchen/ydownloader><strong>https://github.com/pwittchen/ydownloader</strong></a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wittchen.io/tags/testing/>Testing</a></li><li><a href=https://wittchen.io/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://wittchen.io/notes/automate-boring-stuff/><span class=title>« Prev</span><br><span>Automate boring stuff</span>
</a><a class=next href=https://wittchen.io/notes/dockerizing-hybris/><span class=title>Next »</span><br><span>Dockerizing Hybris</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://wittchen.io/>Piotr Wittchen</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a> · theme modifications inspired by <a href=https://ui.shadcn.com/ rel=noopener target=_blank>shadcn-ui</a> · <a href=https://github.com/pwittchen/wittchen.io rel=noopener target=_blank>open-source</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const e=document.querySelector(".header");if(!e)return;function t(){window.scrollY>10?e.classList.add("scrolled"):e.classList.remove("scrolled")}window.addEventListener("scroll",t,{passive:!0}),t()})(),function(){const t=document.getElementById("menu-toggle"),e=document.getElementById("menu");if(!t||!e)return;function s(){const n=t.getAttribute("aria-expanded")==="true";t.setAttribute("aria-expanded",!n),e.classList.toggle("menu-open"),document.body.classList.toggle("menu-open"),n||window.scrollTo(0,0)}function n(){t.setAttribute("aria-expanded","false"),e.classList.remove("menu-open"),document.body.classList.remove("menu-open")}t.addEventListener("click",s),e.querySelectorAll("a").forEach(e=>{e.addEventListener("click",n)}),document.addEventListener("keydown",function(t){t.key==="Escape"&&e.classList.contains("menu-open")&&n()}),window.addEventListener("resize",function(){window.innerWidth>768&&e.classList.contains("menu-open")&&n()})}()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>