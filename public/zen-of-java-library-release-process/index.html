<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Zen of the Java library release process · Piotr Wittchen</title><meta name="description" content="Zen of the Java library release process - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"></head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Zen of the Java library release process</h1><div class="post-info">Jun 8, 2019</div><div class="post-content"><p>In my <a href="/publishing-jar-aar-to-maven-central/">previous article</a> I published information about publishing JAR/AAR library to the Maven Central Repository. A few steps of that process were automated, but a few of them were still manual. I mean closing and release process which had to be done by manual clicking on the Sonatype website. Fortunately, it’s possible to automate it. In order to do that, I used <a href="https://github.com/Codearte/gradle-nexus-staging-plugin" target="_blank" rel="noopener">gradle-nexus-staging-plugin</a> developed by <a href="https://github.com/Codearte" target="_blank" rel="noopener">Codearte</a>. Thanks to this plugin I could get rid of the remaining manual steps left in the release process. </p>
<p><strong>Please note</strong>, if you want to apply configuration described in this article to your project, you need to perform the steps described in the article about <a href="/publishing-jar-aar-to-maven-central/">Publishing JAR/AAR to the Maven Central</a>.</p>
<p>In my project, in the top-level <a href="https://github.com/pwittchen/ReactiveNetwork/blob/RxJava2.x/build.gradle" target="_blank" rel="noopener">build.gradle</a> file I had to do the following setup:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'io.codearte.nexus-staging'</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">  <span class="keyword">repositories</span> &#123;</span><br><span class="line">    google()</span><br><span class="line">    jcenter()</span><br><span class="line">    mavenCentral()</span><br><span class="line">    maven &#123;</span><br><span class="line">      url <span class="string">'https://plugins.gradle.org/m2/'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">dependencies</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">classpath</span> <span class="string">"io.codearte.gradle.nexus:gradle-nexus-staging-plugin:0.12.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getRepositoryUsername() &#123;</span><br><span class="line">  <span class="keyword">return</span> hasProperty(<span class="string">'NEXUS_USERNAME'</span>) ? NEXUS_USERNAME : <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getRepositoryPassword() &#123;</span><br><span class="line">  <span class="keyword">return</span> hasProperty(<span class="string">'NEXUS_PASSWORD'</span>) ? NEXUS_PASSWORD : <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nexusStaging &#123;</span><br><span class="line">  packageGroup = <span class="keyword">GROUP</span> <span class="comment">//optional if packageGroup == project.getGroup()</span></span><br><span class="line">  stagingProfileId = <span class="string">"YOUR_STAGING_PROFILE"</span> <span class="comment">//when not defined will be got from server using "packageGroup"</span></span><br><span class="line">  username = getRepositoryUsername()</span><br><span class="line">  password = getRepositoryPassword()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In order to get <code>YOUR_STAGING_PROFILE</code>, we need to call the following command available in the plugin:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew getStagingProfile</span><br></pre></td></tr></table></figure>

<p>When we are done, we can simply call:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew uploadArchives closeAndReleaseRepository</span><br></pre></td></tr></table></figure>

<p>These two gradle tasks will upload our artifact, close and release it, so we won’t have to perform any manual steps in that process. After that, we just need to wait for the Maven sync as usual.</p>
<p>My complete <code>release.sh</code> script looks like that:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">./gradlew clean build <span class="built_in">test</span> check uploadArchives closeAndReleaseRepository</span><br></pre></td></tr></table></figure>

<p>Before upload and release, I also clean everything, build an artifact, run tests and static code analysis. It’s not required, but it’s good to do that.</p>
<p>If you are interested in complete project configuration, you can have a look at the <a href="https://github.com/pwittchen/ReactiveNetwork" target="_blank" rel="noopener">https://github.com/pwittchen/ReactiveNetwork</a> repository. It’s an Android library, but the same configuration can be applied to any JVM project built with Gradle. I have performed library release with this plugin a few times and it seems to work well.</p>
</div></article></div></main><footer><div class="paginator"><a href="/arch-install-notes/" class="prev">PREV</a><a href="/publishing-jar-aar-to-maven-central/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'zen-of-java-library-release-process/';
var disqus_title = 'Zen of the Java library release process';
var disqus_url = 'http://wittchen.io/zen-of-java-library-release-process/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2019 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io">source</a> / <a href="/feed.xml">rss</a> / <a href="/archives">archives</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>