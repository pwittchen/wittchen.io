<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Air quality monitoring script for Argos (Linux) and BitBar (macOS) · Piotr Wittchen</title><meta name="description" content="Air quality monitoring script for Argos (Linux) and BitBar (macOS) - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">WRITING</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Air quality monitoring script for Argos (Linux) and BitBar (macOS)</h1><div class="post-info">Dec 29, 2017</div><div class="post-content"><p>From some time, I wanted to create my own app, which will display some data in top panel in macOS or Gnome environment on Linux. I collected some resources about that and I knew that for macOS I need to write an app in Obj-C and for Gnome I need to write a plugin in JavaScript. In both cases it requires some ceremony and preparation. Recently I’ve found a great app for macOS called <a href="https://getbitbar.com/" target="_blank" rel="noopener">BitBar</a> (by the way it’s <a href="https://github.com/matryer/bitbar" target="_blank" rel="noopener">open-source</a>). BitBar allows to put anything to macOS menu bar (top panel) in no time! With this project creating top panel apps is simplified to the limit. Moreover, there’s another project called <a href="https://extensions.gnome.org/extension/1176/argos/" target="_blank" rel="noopener">Argos</a>, which does the same thing, but for Linux with Gnome (it’s an <a href="https://github.com/p-e-w/argos" target="_blank" rel="noopener">open-source</a> Gnome Extension). In both cases, we just need to create a shell script, put it into appropriate directory (in case of Argos, it’s <code>~/.config/argos/</code> and in case of BitBar, we define it during the installation or first run) and then app displays our data automatically. We can also set refresh rate. E.g. if we want our script to be executed every 60 seconds, we can name it <code>script.60s.sh</code>. We can also create more advanced scripts and more details can be found in BitBar and Argos documentation. In my case, I wanted to create a script, which reads <code>CAQI</code> (Common Air Quality Index) in my current location based on <a href="http://airly.eu/" target="_blank" rel="noopener">Airly</a> sensors. Airly provides nice <a href="https://airly.eu/en/api/" target="_blank" rel="noopener">API</a>, which we can use in our projects. Please remember that most of the sensors are located in Poland. On my Ubuntu Linux with Gnome 3, I created a new script in the following path:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/.config/argos/caqi.60s.sh</span><br></pre></td></tr></table></figure>

<p>For a BitBar script location could be different. Both for BitBar and Argos follow the same naming convention. My script looks as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">CAQI=$(curl -s -X GET --header <span class="string">'Accept: application/json'</span> --header <span class="string">'apikey: YOUR_API_KEY'</span> \</span><br><span class="line">    <span class="string">'https://airapi.airly.eu/v1/nearestSensor/measurements?latitude=YOUR_LATITUDE&amp;longitude=YOUR_LONGITUDE&amp;maxDistance=1000'</span> \</span><br><span class="line">    | jq .airQualityIndex | cut -f1 -d<span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line">MSG=<span class="string">"Unknown"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> 1 <span class="keyword">in</span></span><br><span class="line">  $((<span class="variable">$CAQI</span> &lt;= 25)))  MSG=<span class="string">"Great!"</span>;;</span><br><span class="line">  $((<span class="variable">$CAQI</span> &lt;= 50)))  MSG=<span class="string">"Good!"</span>;;</span><br><span class="line">  $((<span class="variable">$CAQI</span> &lt;= 75)))  MSG=<span class="string">"Medium"</span>;;</span><br><span class="line">  $((<span class="variable">$CAQI</span> &lt;= 100))) MSG=<span class="string">"Bad"</span>;;</span><br><span class="line">  $((<span class="variable">$CAQI</span> &gt;= 101))) MSG=<span class="string">"Very Bad"</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"CAQI: <span class="variable">$CAQI</span> (<span class="variable">$MSG</span>)"</span></span><br></pre></td></tr></table></figure>

<p>Please note, script above was created for API v. 1. If you’re interested in the latest version of the script, have a look at <a href="https://github.com/pwittchen/airly.sh" target="_blank" rel="noopener">https://github.com/pwittchen/airly.sh</a> repository.</p>
<p>It works fine on Linux. The only requirement is to install <a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener">jq</a>. For macOS, I needed to change <code>jq</code> to <code>/usr/local/bin/jq</code> to make it work. I gathered information about air quality level from this website: <a href="https://www.airqualitynow.eu/pl/about_indices_definition.php" target="_blank" rel="noopener">https://www.airqualitynow.eu/pl/about_indices_definition.php</a> [PL]. Of course, we need to replace <code>API_KEY</code> with our api key, which we can get from <a href="https://developer.airly.eu/" target="_blank" rel="noopener">https://developer.airly.eu/</a> website as well as <code>YOUR_LATITUDE</code> and <code>YOUR_LONGITUDE</code> with coordinates of our location. It can be static location in our city. We can get them e.g. from Google Maps. </p>
<p>As a result, we have beautiful text in our top panel: </p>
<p><img src="/images/posts/2017/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/caqish.png" alt=""></p>
<p>This screenshot was taken on Ubuntu Linux with Gnome 3. On macOS it works the same (I checked it).</p>
</div></article></div></main><footer><div class="paginator"><a href="/quality-meetup-15-fixing-a-billion-dollar-mistake/" class="prev">PREV</a><a href="/creating-a-docker-container-with-alpine-linux-including-java-8-and-9/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/';
var disqus_title = 'Air quality monitoring script for Argos (Linux) and BitBar (macOS)';
var disqus_url = 'http://wittchen.io/air-quality-monitoring-script-for-argos-linux-and-bitbar-macos/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2019 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io" target="_blank" rel="noopener">source</a> / <a href="/feed.xml">rss</a> / <a href="/archives">writing</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest" target="_blank" rel="noopener">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>