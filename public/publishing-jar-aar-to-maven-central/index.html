<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Publishing a JAR/AAR to the Maven Central · Piotr Wittchen</title><meta name="description" content="Publishing a JAR/AAR to the Maven Central - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"><meta name="generator" content="Hexo 4.0.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">WRITING</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Publishing a JAR/AAR to the Maven Central</h1><div class="post-info">May 24, 2019</div><div class="post-content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>As a Java/JVM/Android developers we rely on the work of other people through frameworks and libraries. Many of them are open-source. Most of the developers are consumers of such projects. What if we would like to create our own library and distribute it to other developers? We can always create it and share a <code>*.jar</code> or <code>*.aar</code> file with others. Drawback of such solution is the fact that source of distribution may not be trusted. We also have problems with versioning. Consumers of the library have to constantly download and update their files. It’s much better to publish our library to Maven Central Repository and allow others to easily and seamlessly add it as an external dependency to <code>pom.xml</code> file (in case of Maven) or <code>build.gradle</code> file (in case of Gradle). In such case, dependency is managed by the appropriate build system and distributed via trusted source. This may be not easy for the first time that’s why I decided to collect information related to this topic in a single article. Let’s see how to do this.</p>
<h2 id="Generating-a-GPG-Key"><a href="#Generating-a-GPG-Key" class="headerlink" title="Generating a GPG Key"></a>Generating a GPG Key</h2><p>Before we upload library, we need to generate GPG key.</p>
<p>In order to generate GPG key, we need to open the terminal and type the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg2 --gen-key</span><br></pre></td></tr></table></figure>

<p>Then, we should see the output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">gpg: key YOUR_KEY_ID marked as ultimately trusted</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Read more at: <a href="https://alexcabal.com/creating-the-perfect-gpg-keypair" target="_blank" rel="noopener">https://alexcabal.com/creating-the-perfect-gpg-keypair</a></p>
<h2 id="Distributing-the-public-key"><a href="#Distributing-the-public-key" class="headerlink" title="Distributing the public key"></a>Distributing the public key</h2><p>Next, we need to distribute public key. We can do that as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver hkp://pool.sks-keyservers.net --send-keys YOUR_KEY_ID</span><br></pre></td></tr></table></figure>

<p>We can distribute our key to multiple servers to speed up the synchronization process (pgp.mit.edu, keyserver.ubuntu.com, etc.)</p>
<p>We can also list our keys as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg2 --list-keys</span><br></pre></td></tr></table></figure>

<p>To list secret keys, we can type:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg2 --list-secret-keys</span><br></pre></td></tr></table></figure>

<h2 id="Preparing-the-Gradle-configuration"><a href="#Preparing-the-Gradle-configuration" class="headerlink" title="Preparing the Gradle configuration"></a>Preparing the Gradle configuration</h2><p>In my case, I used Gradle as a build system, which works well for Java, Kotlin and Android projects. We can use Maven for this purpose as well. As a reference, I used <a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="noopener">a Gradle script prepared by Chris Banes</a>. You can have a look at it in <a href="https://github.com/pwittchen/ReactiveNetwork/blob/RxJava2.x/maven_push.gradle" target="_blank" rel="noopener">one of my projects</a>.</p>
<p>In my libraries, I usually have the following structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">├── library</span><br><span class="line">│   ├── gradle.properties</span><br><span class="line">│   └── build.gradle</span><br><span class="line">│</span><br><span class="line">├── build.gradle</span><br><span class="line">├── maven_push.gradle</span><br><span class="line">└── gradle.properties</span><br></pre></td></tr></table></figure>

<p>In <code>maven_push.gradle</code> I keep the mentioned release script. In the <code>library/gradle.properties</code>, I keep details about artifact released from a given directory:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POM_NAME=reactivenetwork</span><br><span class="line">POM_ARTIFACT_ID=reactivenetwork-rx2</span><br><span class="line">POM_PACKAGING=aar</span><br></pre></td></tr></table></figure>

<p>It can be <code>jar</code> if you’re releasing pure Java library. Here’s an example for Android library.</p>
<p>In the <code>/gradle.properties</code> file, I keep release configuration:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">VERSION_NAME=3.0.3</span><br><span class="line">VERSION_CODE=34</span><br><span class="line">GROUP=com.github.pwittchen</span><br><span class="line"></span><br><span class="line">POM_DESCRIPTION=Android library listening network connection state and Internet connectivity with RxJava Observables</span><br><span class="line">POM_URL=https://github.com/pwittchen/ReactiveNetwork</span><br><span class="line">POM_SCM_URL=https://github.com/pwittchen/ReactiveNetwork</span><br><span class="line">POM_SCM_CONNECTION=scm:git@github.com:pwittchen/ReactiveNetwork.git</span><br><span class="line">POM_SCM_DEV_CONNECTION=scm:git@github.com:pwittchen/ReactiveNetwork.git</span><br><span class="line">POM_LICENCE_NAME=The Apache Software License, Version 2.0</span><br><span class="line">POM_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt</span><br><span class="line">POM_LICENCE_DIST=repo</span><br><span class="line">POM_DEVELOPER_ID=pwittchen</span><br><span class="line">POM_DEVELOPER_NAME=Piotr Wittchen</span><br><span class="line"></span><br><span class="line">org.gradle.daemon=true</span><br><span class="line">org.gradle.jvmargs=-XX:MaxPermSize=1024m -XX:+CMSClassUnloadingEnabled -XX:+HeapDumpOnOutOfMemoryError -Xmx2048m</span><br></pre></td></tr></table></figure>

<p>In the <code>library/build.gradle</code> file I need to include release Gradle script:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apply from: &apos;../maven_push.gradle&apos;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>In the <code>$HOME/.gradle/gradle.properties</code> file, I keep system-wide release configuration for Sonatype:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">signing.keyId=YOUR_KEY_ID</span><br><span class="line">signing.password=YOUR_SIGNING_PASSWORD</span><br><span class="line">signing.secretKeyRingFile=/home/piotr/.gnupg/secring.gpg</span><br><span class="line"> </span><br><span class="line">NEXUS_USERNAME=YOUR_NEXUS_USERNAME</span><br><span class="line">NEXUS_PASSWORD=YOUR_NEXUS_PASSWORD</span><br></pre></td></tr></table></figure>

<p><code>YOUR_NEXUS_USERNAME</code> and <code>YOUR_NEXU_PASSWORD</code> can be defined during account creation on the <a href="http://oss.sonatype.org" target="_blank" rel="noopener">http://oss.sonatype.org</a> website.</p>
<p>Of course, you need to provide your own path to <code>secretKeyRingFile</code>, which was created during generating key.</p>
<p>If you’re interested in the complete project structure prepared for library release, you can have a look at the following examples:</p>
<ul>
<li>Java library (compiled into <code>*.jar</code> file): <a href="https://github.com/pwittchen/kirai" target="_blank" rel="noopener">https://github.com/pwittchen/kirai</a></li>
<li>Android library written in Java (compiled into <code>*.aar</code> file): <a href="https://github.com/pwittchen/ReactiveNetwork" target="_blank" rel="noopener">https://github.com/pwittchen/ReactiveNetwork</a></li>
<li>Android library written in Kotlin (compiled into <code>*.aar</code> file): <a href="https://github.com/pwittchen/RxBiometric" target="_blank" rel="noopener">https://github.com/pwittchen/RxBiometric</a></li>
</ul>
<h2 id="Creating-a-Jira-ticket-for-Sonatype"><a href="#Creating-a-Jira-ticket-for-Sonatype" class="headerlink" title="Creating a Jira ticket for Sonatype"></a>Creating a Jira ticket for Sonatype</h2><p>We should create a <a href="https://issues.sonatype.org/secure/Signup!default.jspa" target="_blank" rel="noopener">Sonatype Jira account</a> and <a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&pid=10134" target="_blank" rel="noopener">a new project ticket</a>. You can have a look at <a href="https://issues.sonatype.org/browse/OSSRH-13199" target="_blank" rel="noopener">my first issue</a>. It took a bit longer in my case, because I needed to adjust package name. </p>
<p>To avoid my mistakes, have a look at the following guides:</p>
<ul>
<li><a href="https://central.sonatype.org/pages/ossrh-guide.html" target="_blank" rel="noopener">https://central.sonatype.org/pages/ossrh-guide.html</a></li>
<li><a href="https://central.sonatype.org/pages/choosing-your-coordinates.html" target="_blank" rel="noopener">https://central.sonatype.org/pages/choosing-your-coordinates.html</a></li>
</ul>
<p>Please note, this step is required for the first time only as well as generating keys. After that, we we’ll be able to release as many artifacts under the given package name as we want. These steps need to be repeated in the case of registering the new package name.</p>
<p>This is reasonable from the security and stability perspective because random people cannot just override widely used packages what might cause serious problems in many projects around the world.</p>
<h2 id="Uploading-an-artifact"><a href="#Uploading-an-artifact" class="headerlink" title="Uploading an artifact"></a>Uploading an artifact</h2><p>Once, we have everything set up, we can go to our project via terminal, and type:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew uploadArchives</span><br></pre></td></tr></table></figure>

<p>and wait while artifacts are being uploaded.</p>
<h2 id="Releasing-an-artifact"><a href="#Releasing-an-artifact" class="headerlink" title="Releasing an artifact"></a>Releasing an artifact</h2><p>Next, we need to go to the <a href="http://oss.sonatype.org" target="_blank" rel="noopener">http://oss.sonatype.org</a> website, log in and on the left-hand side, click “Staging Repositories”. Then, we need to sort artifacts by date (Updated column), to view the recently updated items. We should find our artifact (it should be on the top) and click it. We can verify its contents to ensure that everything is ok (package name, version, etc.) and then, we should press “Release” on our artifact. Once release is done, we should press “Close” on the artifact.</p>
<h2 id="Commenting-the-Jira-ticket"><a href="#Commenting-the-Jira-ticket" class="headerlink" title="Commenting the Jira ticket"></a>Commenting the Jira ticket</h2><p>When we are done with the previous steps, we should go back to our Jira ticket and provide the comment:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I have promoted my first release. Thanks.</span><br></pre></td></tr></table></figure>

<h2 id="Waiting-for-the-Maven-sync"><a href="#Waiting-for-the-Maven-sync" class="headerlink" title="Waiting for the Maven sync"></a>Waiting for the Maven sync</h2><p>After all of these steps, we need to wait for the acceptance from the people from Sonatype and Maven Sync. Maven Sync can take no longer than 48 hours. It’s usually faster, but it won’t happen immediately after releasing and closing an artifact like in the release of the Python packages.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>We can see, that release process may be overwhelming and time consuming, but <strong>once we release the first artifact, we can skip most of these steps</strong> like generating keys and creating Jira ticket. We just need to have Gradle or Maven configuration, upload artifacts, release and close them via sonatype website and wait for the Maven Sync. Process of releasing new versions of the same artifact is the same as the first release (excluding mentioned first-time steps). During the next release, we simply need to bump library version in the Gradle configuration before uploading artifacts. In the future, I’m planning to write another article, which shows how to skip manual steps of going to Sonatype website and releasig artifacts via clicking on the page via Gradle plugins, so everything will be automated via CLI.</p>
<h2 id="Links-and-references"><a href="#Links-and-references" class="headerlink" title="Links and references"></a>Links and references</h2><ul>
<li><a href="https://stackoverflow.com/questions/28846802/how-to-manually-publish-jar-to-maven-central" target="_blank" rel="noopener">https://stackoverflow.com/questions/28846802/how-to-manually-publish-jar-to-maven-central</a></li>
<li><a href="https://chris.banes.dev/2013/08/27/pushing-aars-to-maven-central/" target="_blank" rel="noopener">https://chris.banes.dev/2013/08/27/pushing-aars-to-maven-central/</a></li>
<li><a href="https://dzone.com/articles/deploy-maven-central" target="_blank" rel="noopener">https://dzone.com/articles/deploy-maven-central</a></li>
<li><a href="https://central.sonatype.org/pages/gradle.html" target="_blank" rel="noopener">https://central.sonatype.org/pages/gradle.html</a></li>
<li><a href="https://central.sonatype.org/pages/apache-maven.html" target="_blank" rel="noopener">https://central.sonatype.org/pages/apache-maven.html</a></li>
<li><a href="https://central.sonatype.org/pages/working-with-pgp-signatures.html" target="_blank" rel="noopener">https://central.sonatype.org/pages/working-with-pgp-signatures.html</a></li>
<li><a href="https://alexcabal.com/creating-the-perfect-gpg-keypair" target="_blank" rel="noopener">https://alexcabal.com/creating-the-perfect-gpg-keypair</a></li>
<li><a href="https://central.sonatype.org/pages/ossrh-guide.html" target="_blank" rel="noopener">https://central.sonatype.org/pages/ossrh-guide.html</a></li>
<li><a href="https://central.sonatype.org/pages/choosing-your-coordinates.html" target="_blank" rel="noopener">https://central.sonatype.org/pages/choosing-your-coordinates.html</a></li>
<li><a href="https://gist.github.com/diegopacheco/13c0754f0ab36482f4f804ef3f05f989" target="_blank" rel="noopener">https://gist.github.com/diegopacheco/13c0754f0ab36482f4f804ef3f05f989</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/zen-of-java-library-release-process/" class="prev">PREV</a><a href="/kyma-meets-ccv2-hackathon-summary/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'publishing-jar-aar-to-maven-central/';
var disqus_title = 'Publishing a JAR/AAR to the Maven Central';
var disqus_url = 'http://wittchen.io/publishing-jar-aar-to-maven-central/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2019 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io" target="_blank" rel="noopener">source</a> / <a href="/feed.xml">rss</a> / <a href="/archives">writing</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest" target="_blank" rel="noopener">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>