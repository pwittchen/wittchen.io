<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Writing my first library in Kotlin · Piotr Wittchen</title><meta name="description" content="Writing my first library in Kotlin - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"></head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Writing my first library in Kotlin</h1><div class="post-info">Aug 19, 2018</div><div class="post-content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Recently, I decided to create a tiny Android library called <a href="https://github.com/pwittchen/RxBattery" target="_blank" rel="noopener">RxBattery</a>, which is monitoring battery state of the device with RxJava and RxKotlin. I created a few Java and Android libraries already and this time I decided to use <a href="https://kotlinlang.org/" target="_blank" rel="noopener">Kotlin</a> programming language instead of Java to learn something new and write something more complicated than “Hello World” app. Here are my observations.</p>
<h2 id="Build-System"><a href="#Build-System" class="headerlink" title="Build System"></a>Build System</h2><p>I used <a href="https://gradle.org/" target="_blank" rel="noopener">Gradle</a> to build the project. It’s popular for JVM and Android apps nowadays and works fine with Kotlin. I just needed to add Kotlin Gradle Plugin and Kotlin STD Lib to the <code>/library/build.gradle</code> file to the <code>classpath</code> dependencies in <code>buildscript</code> section. I also needed to define <code>sourceSets</code> to allow IntelliJ and Android Studio recognize directories with sources.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  sourceSets &#123;</span><br><span class="line">    androidTest.java.srcDirs += <span class="string">"src/androidTest/kotlin"</span></span><br><span class="line">    main.java.srcDirs += <span class="string">"src/main/kotlin"</span></span><br><span class="line">    test.java.srcDirs += <span class="string">"src/test/kotlin"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To keep the project clean, I defined all dependencies and version numbers in top-level <code>build.gradle</code> file, so I could reuse them in all modules.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ext &#123;</span><br><span class="line">  minSdkVersion = <span class="number">14</span></span><br><span class="line">  compileSdkVersion = <span class="number">28</span></span><br><span class="line">  buildToolsVersion = <span class="string">'28'</span></span><br><span class="line">  gradleVersion = <span class="string">'4.4.1'</span></span><br><span class="line">  kotlinVersion = <span class="string">'1.2.60'</span></span><br><span class="line">  detektVersion = <span class="string">'1.0.0.RC6-1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ext.deps = [ <span class="string">rxjava2              :</span> <span class="string">'io.reactivex.rxjava2:rxjava:2.2.0'</span>,</span><br><span class="line">             <span class="string">rxandroid2           :</span> <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.2'</span>,</span><br><span class="line">             <span class="string">rxkotlin2            :</span> <span class="string">'io.reactivex.rxjava2:rxkotlin:2.3.0'</span>,</span><br><span class="line">             <span class="string">supportannotations   :</span> <span class="string">'com.android.support:support-annotations:28.0.0-rc01'</span>,</span><br><span class="line">             <span class="string">appcompatv7          :</span> <span class="string">'com.android.support:appcompat-v7:28.0.0-rc01'</span>,</span><br><span class="line">             <span class="string">constraintlayout     :</span> <span class="string">'com.android.support.constraint:constraint-layout:1.1.2'</span>,</span><br><span class="line">             <span class="string">junit                :</span> <span class="string">'junit:junit:4.12'</span>,</span><br><span class="line">             <span class="string">truth                :</span> <span class="string">'com.google.truth:truth:0.42'</span>,</span><br><span class="line">             <span class="string">robolectric          :</span> <span class="string">'org.robolectric:robolectric:4.0-alpha-3'</span>,</span><br><span class="line">             <span class="string">mockitocore          :</span> <span class="string">'org.mockito:mockito-core:2.21.0'</span>,</span><br><span class="line">             <span class="string">mockitokotlin        :</span> <span class="string">'com.nhaarman.mockitokotlin2:mockito-kotlin:2.0.0-RC1'</span>,</span><br><span class="line">             <span class="string">dokka                :</span> <span class="string">'org.jetbrains.dokka:dokka-gradle-plugin:0.9.17'</span>,</span><br><span class="line">             <span class="string">detekt               :</span> <span class="string">"gradle.plugin.io.gitlab.arturbosch.detekt:detekt-gradle-plugin:$detektVersion"</span>,</span><br><span class="line">             <span class="string">ktlintgradle         :</span> <span class="string">"gradle.plugin.org.jlleitschuh.gradle:ktlint-gradle:4.1.0"</span>,</span><br><span class="line">             <span class="string">kotlinstdlib         :</span> <span class="string">"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlinVersion"</span>,</span><br><span class="line">             <span class="string">kotlingradleplugin   :</span> <span class="string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"</span> ]</span><br></pre></td></tr></table></figure>

<h2 id="Static-Code-Analysis"><a href="#Static-Code-Analysis" class="headerlink" title="Static Code Analysis"></a>Static Code Analysis</h2><p>For static code analysis, I used CheckStyle, FindBugs, PMD and Android Lint as usual. Moreover, I used <a href="https://github.com/shyiko/ktlint" target="_blank" rel="noopener">ktlint</a> via <a href="https://github.com/JLLeitschuh/ktlint-gradle" target="_blank" rel="noopener">ktlint-gradle plugin</a> and <a href="https://github.com/arturbosch/detekt" target="_blank" rel="noopener">detekt</a>. I’ve added these dependencies to <code>classpath</code> in <code>buildscript</code> section in <code>library/build.gradle</code> file as previosuly</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">    jcenter()</span><br><span class="line">    google()</span><br><span class="line">    maven &#123;</span><br><span class="line">      url <span class="string">'https://plugins.gradle.org/m2/'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dependencies &#123;</span><br><span class="line">    classpath deps.kotlingradleplugin</span><br><span class="line">    classpath deps.detekt</span><br><span class="line">    classpath deps.ktlintgradle</span><br><span class="line">    classpath deps.dokka</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I also applied minimal configuration for these plugins.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">detekt &#123;</span><br><span class="line">  version = rootProject.ext.detektVersion</span><br><span class="line">  profile(<span class="string">"main"</span>) &#123;</span><br><span class="line">    input = <span class="string">"$projectDir"</span></span><br><span class="line">    config = <span class="string">"$projectDir/detekt.yml"</span></span><br><span class="line">    filters = <span class="string">".*test.*,.*/resources/.*,.*/tmp/.*"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ktlint &#123;</span><br><span class="line">  verbose = <span class="literal">true</span></span><br><span class="line">  reporters = [<span class="string">"CHECKSTYLE"</span>, <span class="string">"PLAIN"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I also tried to generate <strong>code coverage report</strong>, to be able to verify what amount of code is covered by unit tests, but unfortunately Jacoco wasn’t able to analyze Kotlin code. I saw on the web that people struggled with the same problem and a few of them could have solved that issue. Maybe I missed something and I could update it in the future.</p>
<h2 id="Continuous-Integration"><a href="#Continuous-Integration" class="headerlink" title="Continuous Integration"></a>Continuous Integration</h2><p>In my open-source projects, I use <a href="https://travis-ci.org/" target="_blank" rel="noopener">Travis</a> for CI. Everything can be configured in <code>.travis.yml</code> file and setup looks exactly the same as for Android libraries written in Java.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">language: android</span><br><span class="line"></span><br><span class="line">android:</span><br><span class="line">  components:</span><br><span class="line">    - tools</span><br><span class="line">    - platform-tools</span><br><span class="line">    - build-tools-28</span><br><span class="line">    - android-28</span><br><span class="line">    - extra-android-support</span><br><span class="line">    - extra-android-m2repository</span><br><span class="line">  licenses:</span><br><span class="line">    - android-sdk-license-5be876d5</span><br><span class="line">    - android-sdk-license-c81a61d9</span><br><span class="line">    - &apos;android-sdk-preview-license-.+&apos;</span><br><span class="line">    - &apos;android-sdk-license-.+&apos;</span><br><span class="line">    - &apos;google-gdk-license-.+&apos;</span><br><span class="line"></span><br><span class="line">jdk: oraclejdk8</span><br><span class="line"></span><br><span class="line">before_install:</span><br><span class="line">  - yes | sdkmanager &quot;platforms;android-27&quot;</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">  - true</span><br><span class="line"></span><br><span class="line">script:</span><br><span class="line">  - ./gradlew clean build test check</span><br><span class="line"></span><br><span class="line">cache:</span><br><span class="line">  directories:</span><br><span class="line">- $HOME/.m2</span><br></pre></td></tr></table></figure>

<p>I suppose that in case of writing pure Kotlin (non-Android), library configuration would be the same as in regular Java project because everything is built via Gradle. Configuration, which works fine for one of my pure Java libraries looks like that:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">language: java</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">  # Check install section: http://docs.travis-ci.com/user/build-configuration/#install</span><br><span class="line">  # If you&apos;d like to skip the install stage entirely, set it to true and nothing will be run.</span><br><span class="line">  - true</span><br><span class="line"></span><br><span class="line">after_success:</span><br><span class="line">  - bash &lt;(curl -s https://codecov.io/bash)</span><br><span class="line">  - python &lt;(curl -s https://raw.githubusercontent.com/TouK/sputnik-ci/master/sputnik-ci.py)</span><br><span class="line"></span><br><span class="line">script:</span><br><span class="line">- ./gradlew clean build test check</span><br></pre></td></tr></table></figure>

<p>I don’t think that it would require any significant change in case of Kotlin.</p>
<h2 id="Kotlin-vs-Java"><a href="#Kotlin-vs-Java" class="headerlink" title="Kotlin vs. Java"></a>Kotlin vs. Java</h2><p>I’ve decided to use Kotlin instead of Java to learn a bit more about this language and try something new. Google promotes this language during Google I/O events and recommends to use it for Android development. Moreover, it’s regular JVM language, so we can use it anywhere we want - on Android (mobile), on servers and even on desktop apps. I haven’t discovered all the features of this language during writing this tiny project, but I have a few observations. Writing code is a bit strange because I got used to programming in Java. In Kotlin, we define the function or variable name first, then we put colon and we define the type next. It’s opposite to Java, where types are defined first. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">createBroadcastReceiver</span><span class="params">(emitter: <span class="type">FlowableEmitter</span>&lt;<span class="type">BatteryState</span>&gt;)</span></span>: BroadcastReceiver &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">val</span> status: <span class="built_in">Int</span> = intent.getIntExtra(BatteryManager.EXTRA_STATUS, UNKNOWN)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Moreover, there’s type inference in Kotlin and sometimes compiler is able to guess our type, so we don’t have to provide it. See the following example:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> emitter = mock(FlowableEmitter::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br></pre></td></tr></table></figure>

<p>In addition, we don’t have to put semicolon in the end of the statement as you can see on the code snippets above, what is really convenient. The thing, I really like about Kotlin is <strong>null safety</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (intent != <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">val</span> status: <span class="built_in">Int</span> = intent.getIntExtra(BatteryManager.EXTRA_STATUS, UNKNOWN)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If we don’t do that, code won’t compile. We can avoid such null-checks, by using <code>!!.</code> operator like here:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> status: <span class="built_in">Int</span> = intent!!.getIntExtra(BatteryManager.EXTRA_STATUS, UNKNOWN)</span><br></pre></td></tr></table></figure>

<p>but by looking at the code, we can see that there are two exclamation marks, so clearly something must be wrong here and we should think about improvement. Moreover, when NPE occurs, it’ll be easier to find.</p>
<p>Kotlin is also <strong>more concise</strong> than Java. It’s hard to say if it’s an advantage or drawback. In Java we have more code, but we clearly know what’s going on when the code is clean. In Kotlin a lot of stuff is <strong>implicit</strong>.</p>
<p>E.g. inheritance looks as follows:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>()</span><br></pre></td></tr></table></figure>

<p>and sometimes we don’t have variable provided in the lambda, when there’s only one value and we can invoke this value by calling <code>it</code> object</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">batteryDisposable = RxBattery</span><br><span class="line">  .observe(<span class="keyword">this</span>)</span><br><span class="line">  .subscribeOn(Schedulers.io())</span><br><span class="line">  .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">  .subscribe &#123; textView.text = it.toString() &#125;</span><br></pre></td></tr></table></figure>

<p>The thing I like about implicit Kotlin code is <strong>data classes</strong>. We can create something like that:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">BatteryState</span></span>(</span><br><span class="line">  <span class="keyword">val</span> status: <span class="built_in">Int</span>,</span><br><span class="line">  <span class="keyword">val</span> plugged: <span class="built_in">Int</span>,</span><br><span class="line">  <span class="keyword">val</span> health: <span class="built_in">Int</span>,</span><br><span class="line">  <span class="keyword">val</span> level: <span class="built_in">Int</span>,</span><br><span class="line">  <span class="keyword">val</span> temperature: <span class="built_in">Int</span>,</span><br><span class="line">  <span class="keyword">val</span> voltage: <span class="built_in">Int</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>and it will generate constructor with all these values, getters and <code>toString()</code> method. In Java, we would need to write it by hand, use code generators in the IDE or code generation libraries like Lombok.</p>
<p>When we take a look at the <strong>control flow</strong> in Kotlin, except for <code>if</code> expression, <code>for</code> and <code>while</code> loops, we also have <code>when</code> expression, which can be kind of neat equivalent to <code>switch</code> instruction in Java. It looks like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">fun</span> <span class="title">plugged</span><span class="params">()</span></span>: Plugged &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">when</span> (pluggedCode) &#123;</span><br><span class="line">     BatteryManager.BATTERY_PLUGGED_AC -&gt; Plugged.AC</span><br><span class="line">     BatteryManager.BATTERY_PLUGGED_USB -&gt; Plugged.USB</span><br><span class="line">     BatteryManager.BATTERY_PLUGGED_WIRELESS -&gt; Plugged.WIRELESS</span><br><span class="line">     <span class="keyword">else</span> -&gt; Plugged.UNKNOWN</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s worth to say that there’s good <strong>inter-operability</strong> between Java and Kotlin. We can use Kotlin modules and libraries in Java projects and vice-versa because everything compiles to the same byte-code. We can even create pure Java code in the Kotlin module. For example, I wanted to have static method called from the Kotlin library. In order to achieve that, I needed to wrap whole class in a Companion Object.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RxBattery</span> </span>&#123;</span><br><span class="line">  <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, in the Kotlin module, I could call it like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RxBattery.observe(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure>

<p>but in Java module it wasn’t possible and I needed to write something like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RxBattery.Companion.observe(context);</span><br></pre></td></tr></table></figure>

<p>I didn’t want library users to call this <code>Companion</code> value explicitely in Java projects, so I created additional Java class.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RxBatteryFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">RxBatteryFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Flowable&lt;BatteryState&gt; <span class="title">observe</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> RxBattery.Companion.observe(context);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and put it next to the Kotlin classes. Now In Java module, people could call method like that:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RxBatteryFactory.observe(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure>

<p>It’s good to know that it’s possible because when we got stuck with implicit Kotlin syntaxt, we can always use Java in one particular scenario.</p>
<p>Later, I figured out, we can simply add <code>@JvmStatic</code> annotation before the method signature and since now, method method will be visible as <code>static</code> in the Java modules as well and we no longer need additional Java code.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmStatic</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">observe</span><span class="params">(context: <span class="type">Context</span>)</span></span>: Flowable&lt;BatteryState&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Moreover, all classes created in Kotlin are <strong>final by default</strong>. It can cause a problems during writing unit tests and creating mocks. If we want to have non-final class (e.g. in order to mock it), we need to mark it explicitly as <code>open</code>.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br></pre></td></tr></table></figure>

<p>Of course, things mentioned above are not all features of Kotlin. There’s much more to discover - e.g. <a href="https://kotlinlang.org/docs/reference/coroutines.html" target="_blank" rel="noopener">couroutines</a>. To learn more, check <a href="https://kotlinlang.org/docs/reference/" target="_blank" rel="noopener">Kotlin Language Reference</a>, open-source projects in this language, books, and other articles on the web.</p>
<p>It’s hard to say if in more complex project Kotlin would be a better choice. Right now, I’m more familar and comfortable with Java, but on the other hand, Kotlin has a few interesting features, which makes development better. Maybe I’ll give this language more chances in the future to learn it better.</p>
<h2 id="Unit-Tests"><a href="#Unit-Tests" class="headerlink" title="Unit Tests"></a>Unit Tests</h2><p>Unit tests in Kotlin are pretty similar to Java.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">fun</span> <span class="title">shouldCreateBroadcastReceiver</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// given</span></span><br><span class="line">  <span class="keyword">val</span> emitter = mock(FlowableEmitter::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// when</span></span><br><span class="line">  <span class="keyword">val</span> broadcastReceiver: BroadcastReceiver = RxBattery.createBroadcastReceiver(</span><br><span class="line">    emitter <span class="keyword">as</span> FlowableEmitter&lt;BatteryState&gt;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="comment">// then</span></span><br><span class="line">  assertThat(broadcastReceiver).isNotNull()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can use JUnit and Java assertion libraries like Google Truth and mocking libraries like Mockito. There’s also <a href="https://github.com/nhaarman/mockito-kotlin" target="_blank" rel="noopener">mockit-kotlin</a> library, but in my case, I used <a href="https://github.com/mockito/mockito" target="_blank" rel="noopener">mockito-core</a>. There are also other mocking libraries like <a href="https://github.com/mockk/mockk" target="_blank" rel="noopener">Mockk</a> and libraries for BDD like <a href="https://github.com/spekframework/spek" target="_blank" rel="noopener">Spek</a>. Moreover, we can achieve more concise syntax for unit tests using various kotlin libraries like <a href="https://github.com/kotlintest/kotlintest" target="_blank" rel="noopener">kotlintest</a>. I haven’t used it in this project yet, but I may update it in the future.</p>
<h2 id="JavaDoc"><a href="#JavaDoc" class="headerlink" title="JavaDoc"></a>JavaDoc</h2><p>Generating JavaDoc (or KotlinDoc?) in Kotlin projects is not straightforward. In order to generate documentation, I used <a href="https://github.com/Kotlin/dokka" target="_blank" rel="noopener">dokka</a> gradle plugin. It’s pretty easy to use, we just need to add appropriate dependency, apply the plugin and create configuration in <code>build.gradle</code> file.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dokka &#123;</span><br><span class="line">  outputFormat = <span class="string">'html'</span></span><br><span class="line">  outputDirectory = <span class="string">"$buildDir/javadoc"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we just call: <code>./gradlew dokka</code> and our JavaDoc is generated in defined <code>outputDirectory</code>.</p>
<h2 id="Library-Deployment"><a href="#Library-Deployment" class="headerlink" title="Library Deployment"></a>Library Deployment</h2><p>Library deployment of the Kotlin project is exactly the same as Java project. I simply used <a href="https://github.com/pwittchen/RxBattery/blob/master/maven_push.gradle" target="_blank" rel="noopener"><code>maven_push.gradle</code></a> script created by Chris Banes some time ago, applied it in the library module and configured everything in <code>gradle.properties</code> and <code>library/gradle.properties</code>. Of course, I also needed to have my credentials configured in <code>~/.gradle/gradle.properties</code> file. Next, I could just call <code>./gradlew uploadArchives</code>, close and release library on the OSS SonaType website.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>To wrap up, Kotlin is an interesting language. It’s hard to say, if it’s really better than Java although it has a few interesting features. Nevertheless, it’s good to familiarize with it because it’s being promoted by Google and JetBrains. JetBrains company actually created and develops this language, so due to this fact, I’m able to put more trust in that project. If you would like to see complete code and configuration of the project mentioned in this article, check out my <a href="https://github.com/pwittchen/RxBattery" target="_blank" rel="noopener">RxBattery</a> repository on GitHub. Last, but not least, learning new things broadens our mind and horizon.</p>
</div></article></div></main><footer><div class="paginator"><a href="/testing-exceptions/" class="prev">PREV</a><a href="/solving-problems-with-avd-and-kvm-on-linux/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'writing-my-first-library-in-kotlin/';
var disqus_title = 'Writing my first library in Kotlin';
var disqus_url = 'http://wittchen.io/writing-my-first-library-in-kotlin/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2019 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io">source</a> / <a href="/feed.xml">rss</a> / <a href="/archives">archives</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>