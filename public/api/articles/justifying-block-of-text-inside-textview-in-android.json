{"title":"Justifying block of text inside TextView in Android","slug":"justifying-block-of-text-inside-textview-in-android","date":"2013-08-31T20:14:00.000Z","updated":"2019-07-03T22:51:02.813Z","comments":true,"path":"api/articles/justifying-block-of-text-inside-textview-in-android.json","excerpt":null,"covers":null,"content":"<p>Justifying text inside <code>TextView</code> in Android is not that simple as we may expect it to be. Unfortunately, Android does not have attribute for <code>TextView</code>, which supports justifying text. We can set alignment to the right or to the left, but we cannot simply justify text with generic attributes. In order to do that, we need to perform a few tricks. First of all, we need to create file named <code>justified_textview.css</code> and we need to put it into the <code>assets/</code> directory of our project. We will use it later in our custom view. Source code of this CSS stylesheet is presented below: </p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.0em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"built_in\">rgb</span>(0,0,0);</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: justify;</span><br><span class=\"line\">    <span class=\"comment\">/* background: rgba(217, 217, 217, 1.0);  you can set your background here,</span></span><br><span class=\"line\"><span class=\"comment\">                                              it's kind of fix for older versions of Android OS */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (-webkit-device-pixel-ratio: <span class=\"number\">1.5</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* CSS for high-density screens */</span></span><br><span class=\"line\">    <span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: <span class=\"number\">1.05em</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (-webkit-device-pixel-ratio: <span class=\"number\">2.0</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* CSS for extra high-density screens */</span></span><br><span class=\"line\">    <span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: <span class=\"number\">1.1em</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Next, we need to create class for customized view extending WebView. Let’s call it <em>JustifiedTextView</em>. </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.github.sample.view;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.res.TypedArray;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.graphics.Color;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Build;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.text.TextUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.AttributeSet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.TypedValue;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.view.View;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.webkit.WebView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.github.sample.R;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JustifiedTextView</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebView</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JustifiedTextView</span><span class=\"params\">(<span class=\"keyword\">final</span> Context context)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>(context, <span class=\"keyword\">null</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JustifiedTextView</span><span class=\"params\">(<span class=\"keyword\">final</span> Context context, <span class=\"keyword\">final</span> AttributeSet attrs)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>(context, attrs, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JustifiedTextView</span><span class=\"params\">(<span class=\"keyword\">final</span> Context context, <span class=\"keyword\">final</span> AttributeSet attrs, <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> defStyle)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(context, attrs, defStyle);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (attrs != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> TypedValue typedValue = <span class=\"keyword\">new</span> TypedValue();</span><br><span class=\"line\">            <span class=\"keyword\">final</span> TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.JustifiedTextView, defStyle, <span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (typedArray != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                typedArray.getValue(R.styleable.JustifiedTextView_text, typedValue);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (typedValue.resourceId &gt; <span class=\"number\">0</span> &amp;&amp; TextUtils.isEmpty(text)) &#123;</span><br><span class=\"line\">                    text = context.getString(typedValue.resourceId);</span><br><span class=\"line\">                    text.replace(<span class=\"string\">\"\\n\"</span>, <span class=\"string\">\"&lt;br /&gt;\"</span>);</span><br><span class=\"line\">                    loadDataWithBaseURL(<span class=\"string\">\"file:///android_asset/\"</span>, <span class=\"string\">\"&lt;html&gt;&lt;head&gt;\"</span> +</span><br><span class=\"line\">                            <span class=\"string\">\"&lt;link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"justified_textview.css\\\" /&gt;\"</span> +</span><br><span class=\"line\">                            <span class=\"string\">\"&lt;/head&gt;&lt;body&gt;\"</span> + text + <span class=\"string\">\"&lt;/body&gt;&lt;/html&gt;\"</span>, <span class=\"string\">\"text/html\"</span>, <span class=\"string\">\"UTF8\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                setTransparentBackground();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setTransparentBackground</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= <span class=\"number\">11</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                setLayerType(View.LAYER_TYPE_SOFTWARE, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">final</span> NoSuchMethodError e) &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            setBackgroundColor(Color.TRANSPARENT);</span><br><span class=\"line\">            setBackgroundDrawable(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            setBackgroundResource(<span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getText</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setText</span><span class=\"params\">(String currentText)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.text = currentText;</span><br><span class=\"line\">        text.replace(<span class=\"string\">\"\\n\"</span>, <span class=\"string\">\"&lt;br /&gt;\"</span>);</span><br><span class=\"line\">        loadDataWithBaseURL(<span class=\"string\">\"file:///android_asset/\"</span>, <span class=\"string\">\"&lt;html&gt;&lt;head&gt;\"</span> +</span><br><span class=\"line\">                <span class=\"string\">\"&lt;link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"justified_textview.css\\\" /&gt;\"</span> +</span><br><span class=\"line\">                <span class=\"string\">\"&lt;/head&gt;&lt;body&gt;\"</span> + text + <span class=\"string\">\"&lt;/body&gt;&lt;/html&gt;\"</span>, <span class=\"string\">\"text/html\"</span>, <span class=\"string\">\"UTF8\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        setTransparentBackground();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>After that, we need to update <code>res/values/attrs.xml</code> file and put inside the following declaration: </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">declare-styleable</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JustifiedTextView\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">attr</span> <span class=\"attr\">name</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">format</span>=<span class=\"string\">\"reference\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Now, we are ready to use our custom <code>JustifiedTextView</code>. In order to do that, we need to create layout containing <code>JustifiedTextView</code> as follows: </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">com.github.sample.view.JustifiedTextView</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/tv_information\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Next, we can access <code>JustifiedTextView</code> in our activity: </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> JustifiedTextView tvInformation;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\ttvInformation = (JustifiedTextView) findViewById(R.id.tv_information);</span><br><span class=\"line\">\ttVinformation.setText(<span class=\"string\">\"sample text\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure>\n\n<p>We can also set text inside XML layout instead of doing this programmatically. It depends on our project. We also should turn off hardware acceleration for given activity in <code>AndroidManifest.xml</code> file in order to bring this solution to work. </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:name</span>=<span class=\"string\">\".activity.justifiedTextViewActivity\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:configChanges</span>=<span class=\"string\">\"orientation|keyboardHidden\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">android:hardwareAccelerated</span>=<span class=\"string\">\"false\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>That’s it. It’s not perfect solution and it’s kind of workaround, but I haven’t found any better idea how to deal with this problem. I tested a few solutions and this one is, in my opinion, the best available and most elegant option for now. <strong>Please note: There may be a problem with proper execution of this solution on Android OS version lower than 3.0 (API 11).</strong></p>\n","more":"<p>Justifying text inside <code>TextView</code> in Android is not that simple as we may expect it to be. Unfortunately, Android does not have attribute for <code>TextView</code>, which supports justifying text. We can set alignment to the right or to the left, but we cannot simply justify text with generic attributes. In order to do that, we need to perform a few tricks. First of all, we need to create file named <code>justified_textview.css</code> and we need to put it into the <code>assets/</code> directory of our project. We will use it later in our custom view. Source code of this CSS stylesheet is presented below: </p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">1.0em</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: <span class=\"built_in\">rgb</span>(0,0,0);</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: justify;</span><br><span class=\"line\">    <span class=\"comment\">/* background: rgba(217, 217, 217, 1.0);  you can set your background here,</span></span><br><span class=\"line\"><span class=\"comment\">                                              it's kind of fix for older versions of Android OS */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (-webkit-device-pixel-ratio: <span class=\"number\">1.5</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* CSS for high-density screens */</span></span><br><span class=\"line\">    <span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: <span class=\"number\">1.05em</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"keyword\">media</span> screen and (-webkit-device-pixel-ratio: <span class=\"number\">2.0</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* CSS for extra high-density screens */</span></span><br><span class=\"line\">    <span class=\"selector-tag\">body</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">font-size</span>: <span class=\"number\">1.1em</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Next, we need to create class for customized view extending WebView. Let’s call it <em>JustifiedTextView</em>. </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.github.sample.view;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.Context;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.content.res.TypedArray;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.graphics.Color;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Build;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.text.TextUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.AttributeSet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.TypedValue;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.view.View;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.webkit.WebView;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.github.sample.R;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JustifiedTextView</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebView</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JustifiedTextView</span><span class=\"params\">(<span class=\"keyword\">final</span> Context context)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>(context, <span class=\"keyword\">null</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JustifiedTextView</span><span class=\"params\">(<span class=\"keyword\">final</span> Context context, <span class=\"keyword\">final</span> AttributeSet attrs)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>(context, attrs, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">JustifiedTextView</span><span class=\"params\">(<span class=\"keyword\">final</span> Context context, <span class=\"keyword\">final</span> AttributeSet attrs, <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> defStyle)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(context, attrs, defStyle);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (attrs != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> TypedValue typedValue = <span class=\"keyword\">new</span> TypedValue();</span><br><span class=\"line\">            <span class=\"keyword\">final</span> TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.JustifiedTextView, defStyle, <span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (typedArray != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                typedArray.getValue(R.styleable.JustifiedTextView_text, typedValue);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (typedValue.resourceId &gt; <span class=\"number\">0</span> &amp;&amp; TextUtils.isEmpty(text)) &#123;</span><br><span class=\"line\">                    text = context.getString(typedValue.resourceId);</span><br><span class=\"line\">                    text.replace(<span class=\"string\">\"\\n\"</span>, <span class=\"string\">\"&lt;br /&gt;\"</span>);</span><br><span class=\"line\">                    loadDataWithBaseURL(<span class=\"string\">\"file:///android_asset/\"</span>, <span class=\"string\">\"&lt;html&gt;&lt;head&gt;\"</span> +</span><br><span class=\"line\">                            <span class=\"string\">\"&lt;link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"justified_textview.css\\\" /&gt;\"</span> +</span><br><span class=\"line\">                            <span class=\"string\">\"&lt;/head&gt;&lt;body&gt;\"</span> + text + <span class=\"string\">\"&lt;/body&gt;&lt;/html&gt;\"</span>, <span class=\"string\">\"text/html\"</span>, <span class=\"string\">\"UTF8\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                setTransparentBackground();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setTransparentBackground</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= <span class=\"number\">11</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                setLayerType(View.LAYER_TYPE_SOFTWARE, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (<span class=\"keyword\">final</span> NoSuchMethodError e) &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            setBackgroundColor(Color.TRANSPARENT);</span><br><span class=\"line\">            setBackgroundDrawable(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">            setBackgroundResource(<span class=\"number\">0</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getText</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> text;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setText</span><span class=\"params\">(String currentText)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.text = currentText;</span><br><span class=\"line\">        text.replace(<span class=\"string\">\"\\n\"</span>, <span class=\"string\">\"&lt;br /&gt;\"</span>);</span><br><span class=\"line\">        loadDataWithBaseURL(<span class=\"string\">\"file:///android_asset/\"</span>, <span class=\"string\">\"&lt;html&gt;&lt;head&gt;\"</span> +</span><br><span class=\"line\">                <span class=\"string\">\"&lt;link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"justified_textview.css\\\" /&gt;\"</span> +</span><br><span class=\"line\">                <span class=\"string\">\"&lt;/head&gt;&lt;body&gt;\"</span> + text + <span class=\"string\">\"&lt;/body&gt;&lt;/html&gt;\"</span>, <span class=\"string\">\"text/html\"</span>, <span class=\"string\">\"UTF8\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        setTransparentBackground();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>After that, we need to update <code>res/values/attrs.xml</code> file and put inside the following declaration: </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">declare-styleable</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JustifiedTextView\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">attr</span> <span class=\"attr\">name</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">format</span>=<span class=\"string\">\"reference\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Now, we are ready to use our custom <code>JustifiedTextView</code>. In order to do that, we need to create layout containing <code>JustifiedTextView</code> as follows: </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">com.github.sample.view.JustifiedTextView</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/tv_information\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Next, we can access <code>JustifiedTextView</code> in our activity: </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> JustifiedTextView tvInformation;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\ttvInformation = (JustifiedTextView) findViewById(R.id.tv_information);</span><br><span class=\"line\">\ttVinformation.setText(<span class=\"string\">\"sample text\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure>\n\n<p>We can also set text inside XML layout instead of doing this programmatically. It depends on our project. We also should turn off hardware acceleration for given activity in <code>AndroidManifest.xml</code> file in order to bring this solution to work. </p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">activity</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:name</span>=<span class=\"string\">\".activity.justifiedTextViewActivity\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:configChanges</span>=<span class=\"string\">\"orientation|keyboardHidden\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"attr\">android:hardwareAccelerated</span>=<span class=\"string\">\"false\"</span>/&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>That’s it. It’s not perfect solution and it’s kind of workaround, but I haven’t found any better idea how to deal with this problem. I tested a few solutions and this one is, in my opinion, the best available and most elegant option for now. <strong>Please note: There may be a problem with proper execution of this solution on Android OS version lower than 3.0 (API 11).</strong></p>\n","categories":[],"tags":[{"name":"android","path":"api/tags/android.json"}]}