{"title":"Basic usage of YaaS as a proxy for the microservice","slug":"yaas-as-a-proxy-for-microservice","date":"2017-04-30T20:45:00.000Z","updated":"2019-07-03T22:51:02.816Z","comments":true,"path":"api/articles/yaas-as-a-proxy-for-microservice.json","excerpt":null,"covers":["/images/posts/2017/yaas-as-a-proxy-for-microservice/yaas_header.jpg","/images/posts/2017/yaas-as-a-proxy-for-microservice/yass_builder_service.png","/images/posts/2017/yaas-as-a-proxy-for-microservice/yaas_builder_rule.png","/images/posts/2017/yaas-as-a-proxy-for-microservice/calling_yaas_microservice_diagram.png"],"content":"<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>The company, where I currently work - <a href=\"http://hybris.com\" target=\"_blank\" rel=\"noopener\">SAP Hybris</a> is developing a project called <a href=\"https://www.yaas.io/\" target=\"_blank\" rel=\"noopener\">YaaS</a>, which is an abbreviation of Hybris as a Service. Unfortunately, this article is not sponsored yet :). What a pity :(. I just like to understand many things &amp; how they work to see the bigger picture. Moreover, company strategy is to leverage YaaS and search for the new possibilities and use cases of this project. There are situations where delegating some work to a separate service makes sense so this knowledge may be useful even when we’re developing the monolithic enterprise applications. That’s why I wrote this article. I work in a completely different project - Enterprise Commerce Platform, where I’m the part of the Backoffice team. As you can read on the official website, <em>YaaS is a microservices ecosystem helping businesses to rapidly augment and build new, highly flexible solutions</em>. It’s kind of marketing statement, which business people may like. Nevertheless, for developers, it’s just a bunch of buzzwords, which does not help you to understand this project. One of the aims of this article is to explain it in a simple and clear way. <a href=\"http://yaas.io\" target=\"_blank\" rel=\"noopener\"><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/yaas_header.jpg\" alt=\"yaas - hybris as a service\"></a> From <strong>the technical point of view</strong>, YaaS gives you the following possibilities:</p>\n<ul>\n<li>it can be a proxy for your microservice, which can be deployed anywhere</li>\n<li>it gives you separate proxy servers for EU and US, which you can use depending on the server or user location</li>\n<li>it provides you a domain like <code>api.eu.yaas.io/yourorganization/yourservice/</code></li>\n<li>it provides secured connection</li>\n<li>it gives a mechanism, which allows you to secure endpoints of your microservice via dynamically generated token</li>\n<li>it gives you the possibility to manage access to your service for advanced use cases with features like clients, roles, etc.</li>\n<li>it gives you monitoring possibilities</li>\n<li>it allows you to perform versioning of your API</li>\n<li>it allows you to integrate other services/packages from <a href=\"https://market.yaas.io/\" target=\"_blank\" rel=\"noopener\">YaaS Market</a> with your service</li>\n<li>it gives you web interface called <a href=\"https://builder.yaas.io/\" target=\"_blank\" rel=\"noopener\">YaaS Builder</a>, which you can use for managing your projects and organization</li>\n</ul>\n<p>YaaS <strong>is NOT</strong>:</p>\n<ul>\n<li>the hosting platform like Heroku or AWS - you need to have another place where you can deploy your service (like Heroku or whatever)</li>\n<li>the part of the Core Hybris Platform - it’s completely separate project, but it can be integrated with the Hybris Platform</li>\n</ul>\n<p>The official website of the project is: <a href=\"https://www.yaas.io/\" target=\"_blank\" rel=\"noopener\">www.yaas.io</a>. In this article, I won’t explain all the features of YaaS. I will simply show you:</p>\n<ul>\n<li>how to create a simple proxy for your microservice</li>\n<li>how to secure endpoint of your microservice</li>\n<li>how to access secured endpoint of your microservice</li>\n</ul>\n<p>Maybe I’ll explain more features in the separate articles in the future.</p>\n<h2 id=\"Creating-a-simple-proxy-for-the-microservice\"><a href=\"#Creating-a-simple-proxy-for-the-microservice\" class=\"headerlink\" title=\"Creating a simple proxy for the microservice\"></a>Creating a simple proxy for the microservice</h2><p>We need to do the following steps:</p>\n<ol>\n<li>Go to <a href=\"https://builder.yaas.io\" target=\"_blank\" rel=\"noopener\">https://builder.yaas.io</a></li>\n<li>Create an account &amp; log in</li>\n<li>Create an organization</li>\n<li>Create a project</li>\n<li>Within the project create a service</li>\n<li>Provide address to your service</li>\n<li>Provide API version (e.g. <code>v1</code>)</li>\n<li>Deploy service</li>\n<li>Right now, your service is deployed, but not accessible yet</li>\n<li>Create a Client and assign it to your service</li>\n<li>Now you should be able to access your service at: <code>https://api.eu.yaas.io/orgranization/service/v1</code></li>\n</ol>\n<p>Below you can see a screenshot from service configuration inside the YaaS Builder. </p>\n<p><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/yass_builder_service.png\" alt></p>\n<h2 id=\"Securing-the-endpoint-of-the-microservice\"><a href=\"#Securing-the-endpoint-of-the-microservice\" class=\"headerlink\" title=\"Securing the endpoint of the microservice\"></a>Securing the endpoint of the microservice</h2><p>We have created our service. Now, we want to secure its endpoint. To do so, we can create Authorization Rule from the Service configuration inside YaaS Builder. </p>\n<p><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/yaas_builder_rule.png\" alt></p>\n<p>We can define methods of the HTTP request, endpoint address, and other parameters. When we’re done, we can proceed to more tricky part. Authorization procedure of the microservice endpoint is presented in the scheme below. </p>\n<p><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/calling_yaas_microservice_diagram.png\" alt=\"calling microservice with authorization via YaaS proxy\"></p>\n<p>First, we need to obtain Bearer ID. To do so, we need to perform HTTP request with Client ID and Client Secret. We can do it from terminal via curl:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -i </span><br><span class=\"line\">-H &quot;Content-Type: application/x-www-form-urlencoded&quot; </span><br><span class=\"line\">-d &quot;grant_type=client_credentials&amp;client_id=YOUR_CLIENT_ID&amp;client_secret=YOUR_CLIENT_SECRET&quot; </span><br><span class=\"line\">https://api.eu.yaas.io/hybris/oauth2/v1/token</span><br></pre></td></tr></table></figure>\n\n<p>Then, we’ll receive a response like that:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;token_type&quot;:&quot;Bearer&quot;,&quot;access_token&quot;:&quot;023-018f03da-cdb7-4710-a4cf-70f89e23003f&quot;,&quot;expires_in&quot;:3600,&quot;scope&quot;:&quot;hybris.tenant=pwtest&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>and we can make an authorized call to our microservice:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -i </span><br><span class=\"line\">-H &quot;Authorization: Bearer 023-018f03da-cdb7-4710-a4cf-70f89e23003f&quot; </span><br><span class=\"line\">-H &quot;Content-Type: application/json&quot; </span><br><span class=\"line\">-d &quot;&quot; </span><br><span class=\"line\">https://api.eu.yaas.io/pwittchen/test/v1/endpoint</span><br></pre></td></tr></table></figure>\n\n<p>after that, we should receive a response from the microservice. Note, that Bearer ID will be valid for the particular amount of time. <strong>Hint #1</strong>: To make calls more readable in the article, I split them into lines. If you’re making a real call it’s better to have whole instruction in <strong>a single line</strong>. <strong>Hint #2</strong>: You can get Client Secret and Client ID from the YaaS Builder while editing your Client.</p>\n<h2 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h2><p>As we could see, creating a microservice proxy and securing the endpoint is not so complicated, but it’s not straightforward as well. It requires some knowledge about YaaS and its design. Using this approach won’t be a good idea every time, but I think there are use cases when it can be useful. Especially, when we care about monitoring &amp; security and when we want to have unified &amp; controlled access to our services. Here are a few of my ideas of delegating work to the microservice from the monolithic enterprise commerce application:</p>\n<ul>\n<li>file or image storage</li>\n<li>backups of the data</li>\n<li>classification of the products - e.g. we can delegate images to the external service, which will use machine learning and neural networks to classify products by colors or by something else</li>\n<li>long running operations &amp; queues - e.g. we can delegate such things to the separate microservice to relieve CPU &amp; Memory of the server, where core system is running and simply receive push notification with final result of the operation from the microservice when the work is done</li>\n<li>sending e-mails and other types of notifications</li>\n<li>and more… (if you have your own ideas - share them in comments!)</li>\n</ul>\n<p>I think the basic idea could be the distribution of computations to the different servers, what may extend capabilities of the core system, make it faster, lighter and more stable. In addition, it should make work of developers easier and more joyful because they could work on the smaller parts of the system, which have a clearly specified goal and smaller codebase, which is easier to manage.</p>\n","more":"<h2 id=\"Introduction\"><a href=\"#Introduction\" class=\"headerlink\" title=\"Introduction\"></a>Introduction</h2><p>The company, where I currently work - <a href=\"http://hybris.com\" target=\"_blank\" rel=\"noopener\">SAP Hybris</a> is developing a project called <a href=\"https://www.yaas.io/\" target=\"_blank\" rel=\"noopener\">YaaS</a>, which is an abbreviation of Hybris as a Service. Unfortunately, this article is not sponsored yet :). What a pity :(. I just like to understand many things &amp; how they work to see the bigger picture. Moreover, company strategy is to leverage YaaS and search for the new possibilities and use cases of this project. There are situations where delegating some work to a separate service makes sense so this knowledge may be useful even when we’re developing the monolithic enterprise applications. That’s why I wrote this article. I work in a completely different project - Enterprise Commerce Platform, where I’m the part of the Backoffice team. As you can read on the official website, <em>YaaS is a microservices ecosystem helping businesses to rapidly augment and build new, highly flexible solutions</em>. It’s kind of marketing statement, which business people may like. Nevertheless, for developers, it’s just a bunch of buzzwords, which does not help you to understand this project. One of the aims of this article is to explain it in a simple and clear way. <a href=\"http://yaas.io\" target=\"_blank\" rel=\"noopener\"><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/yaas_header.jpg\" alt=\"yaas - hybris as a service\"></a> From <strong>the technical point of view</strong>, YaaS gives you the following possibilities:</p>\n<ul>\n<li>it can be a proxy for your microservice, which can be deployed anywhere</li>\n<li>it gives you separate proxy servers for EU and US, which you can use depending on the server or user location</li>\n<li>it provides you a domain like <code>api.eu.yaas.io/yourorganization/yourservice/</code></li>\n<li>it provides secured connection</li>\n<li>it gives a mechanism, which allows you to secure endpoints of your microservice via dynamically generated token</li>\n<li>it gives you the possibility to manage access to your service for advanced use cases with features like clients, roles, etc.</li>\n<li>it gives you monitoring possibilities</li>\n<li>it allows you to perform versioning of your API</li>\n<li>it allows you to integrate other services/packages from <a href=\"https://market.yaas.io/\" target=\"_blank\" rel=\"noopener\">YaaS Market</a> with your service</li>\n<li>it gives you web interface called <a href=\"https://builder.yaas.io/\" target=\"_blank\" rel=\"noopener\">YaaS Builder</a>, which you can use for managing your projects and organization</li>\n</ul>\n<p>YaaS <strong>is NOT</strong>:</p>\n<ul>\n<li>the hosting platform like Heroku or AWS - you need to have another place where you can deploy your service (like Heroku or whatever)</li>\n<li>the part of the Core Hybris Platform - it’s completely separate project, but it can be integrated with the Hybris Platform</li>\n</ul>\n<p>The official website of the project is: <a href=\"https://www.yaas.io/\" target=\"_blank\" rel=\"noopener\">www.yaas.io</a>. In this article, I won’t explain all the features of YaaS. I will simply show you:</p>\n<ul>\n<li>how to create a simple proxy for your microservice</li>\n<li>how to secure endpoint of your microservice</li>\n<li>how to access secured endpoint of your microservice</li>\n</ul>\n<p>Maybe I’ll explain more features in the separate articles in the future.</p>\n<h2 id=\"Creating-a-simple-proxy-for-the-microservice\"><a href=\"#Creating-a-simple-proxy-for-the-microservice\" class=\"headerlink\" title=\"Creating a simple proxy for the microservice\"></a>Creating a simple proxy for the microservice</h2><p>We need to do the following steps:</p>\n<ol>\n<li>Go to <a href=\"https://builder.yaas.io\" target=\"_blank\" rel=\"noopener\">https://builder.yaas.io</a></li>\n<li>Create an account &amp; log in</li>\n<li>Create an organization</li>\n<li>Create a project</li>\n<li>Within the project create a service</li>\n<li>Provide address to your service</li>\n<li>Provide API version (e.g. <code>v1</code>)</li>\n<li>Deploy service</li>\n<li>Right now, your service is deployed, but not accessible yet</li>\n<li>Create a Client and assign it to your service</li>\n<li>Now you should be able to access your service at: <code>https://api.eu.yaas.io/orgranization/service/v1</code></li>\n</ol>\n<p>Below you can see a screenshot from service configuration inside the YaaS Builder. </p>\n<p><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/yass_builder_service.png\" alt></p>\n<h2 id=\"Securing-the-endpoint-of-the-microservice\"><a href=\"#Securing-the-endpoint-of-the-microservice\" class=\"headerlink\" title=\"Securing the endpoint of the microservice\"></a>Securing the endpoint of the microservice</h2><p>We have created our service. Now, we want to secure its endpoint. To do so, we can create Authorization Rule from the Service configuration inside YaaS Builder. </p>\n<p><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/yaas_builder_rule.png\" alt></p>\n<p>We can define methods of the HTTP request, endpoint address, and other parameters. When we’re done, we can proceed to more tricky part. Authorization procedure of the microservice endpoint is presented in the scheme below. </p>\n<p><img src=\"/images/posts/2017/yaas-as-a-proxy-for-microservice/calling_yaas_microservice_diagram.png\" alt=\"calling microservice with authorization via YaaS proxy\"></p>\n<p>First, we need to obtain Bearer ID. To do so, we need to perform HTTP request with Client ID and Client Secret. We can do it from terminal via curl:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -i </span><br><span class=\"line\">-H &quot;Content-Type: application/x-www-form-urlencoded&quot; </span><br><span class=\"line\">-d &quot;grant_type=client_credentials&amp;client_id=YOUR_CLIENT_ID&amp;client_secret=YOUR_CLIENT_SECRET&quot; </span><br><span class=\"line\">https://api.eu.yaas.io/hybris/oauth2/v1/token</span><br></pre></td></tr></table></figure>\n\n<p>Then, we’ll receive a response like that:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;token_type&quot;:&quot;Bearer&quot;,&quot;access_token&quot;:&quot;023-018f03da-cdb7-4710-a4cf-70f89e23003f&quot;,&quot;expires_in&quot;:3600,&quot;scope&quot;:&quot;hybris.tenant=pwtest&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>and we can make an authorized call to our microservice:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST -i </span><br><span class=\"line\">-H &quot;Authorization: Bearer 023-018f03da-cdb7-4710-a4cf-70f89e23003f&quot; </span><br><span class=\"line\">-H &quot;Content-Type: application/json&quot; </span><br><span class=\"line\">-d &quot;&quot; </span><br><span class=\"line\">https://api.eu.yaas.io/pwittchen/test/v1/endpoint</span><br></pre></td></tr></table></figure>\n\n<p>after that, we should receive a response from the microservice. Note, that Bearer ID will be valid for the particular amount of time. <strong>Hint #1</strong>: To make calls more readable in the article, I split them into lines. If you’re making a real call it’s better to have whole instruction in <strong>a single line</strong>. <strong>Hint #2</strong>: You can get Client Secret and Client ID from the YaaS Builder while editing your Client.</p>\n<h2 id=\"Summary\"><a href=\"#Summary\" class=\"headerlink\" title=\"Summary\"></a>Summary</h2><p>As we could see, creating a microservice proxy and securing the endpoint is not so complicated, but it’s not straightforward as well. It requires some knowledge about YaaS and its design. Using this approach won’t be a good idea every time, but I think there are use cases when it can be useful. Especially, when we care about monitoring &amp; security and when we want to have unified &amp; controlled access to our services. Here are a few of my ideas of delegating work to the microservice from the monolithic enterprise commerce application:</p>\n<ul>\n<li>file or image storage</li>\n<li>backups of the data</li>\n<li>classification of the products - e.g. we can delegate images to the external service, which will use machine learning and neural networks to classify products by colors or by something else</li>\n<li>long running operations &amp; queues - e.g. we can delegate such things to the separate microservice to relieve CPU &amp; Memory of the server, where core system is running and simply receive push notification with final result of the operation from the microservice when the work is done</li>\n<li>sending e-mails and other types of notifications</li>\n<li>and more… (if you have your own ideas - share them in comments!)</li>\n</ul>\n<p>I think the basic idea could be the distribution of computations to the different servers, what may extend capabilities of the core system, make it faster, lighter and more stable. In addition, it should make work of developers easier and more joyful because they could work on the smaller parts of the system, which have a clearly specified goal and smaller codebase, which is easier to manage.</p>\n","categories":[],"tags":[{"name":"microservices","path":"api/tags/microservices.json"},{"name":"hybris","path":"api/tags/hybris.json"},{"name":"yaas","path":"api/tags/yaas.json"},{"name":"proxy","path":"api/tags/proxy.json"}]}