{"title":"Versioning Android applications","slug":"versioning-android-applications","date":"2014-09-13T10:49:00.000Z","updated":"2019-07-03T22:51:02.816Z","comments":true,"path":"api/articles/versioning-android-applications.json","excerpt":null,"covers":null,"content":"<p>When we work in a team projects, our code constantly changes and being tested. Often some bugs occur in a specific version of application and no longer exists in next version of the project, because one programmer might fixed the bug according to the <a href=\"http://programmer.97things.oreilly.com/wiki/index.php/The_Boy_Scout_Rule\" target=\"_blank\" rel=\"noopener\">Boy Scout Rule</a> and this is good. Nevertheless, sometimes we need to write documentation and check in which version bug occurred to be sure, that it was really fixed. In addition, <a href=\"http://en.wikipedia.org/wiki/Quality_assurance\" target=\"_blank\" rel=\"noopener\">QA</a> Engineer needs to know, which version of the project he or she should check. That’s why we should introduce versioning system to our project. In Android Manifest we have <code>versionCode</code> and <code>versionName</code>. The <code>versionCode</code> is used for updates on Google Play Store and it has to be integer value. We should increment <code>versionCode</code> before releasing new version of the application for the users. The <code>versionName</code> available in Android Manifest is a string value and we can use it to store information, which we need in a current project. When we use Git as a Version Control System, we can put SHA value of a specific commit into our version name. In addition, we can add date and time of compilation to this variable. After that, our <code>versionName</code> contains very detailed information about current version of our application. Exemplary <code>versionName</code> will look in as follows: <code>f935ea7-20140913144001</code>. We can obtain that with proper configuration of <code>build.gradle</code> file containing <code>buildTime()</code> method and <code>gitSha()</code> method. Please, take a look at creation of <code>versionName</code> in 35th line of the <code>build.gradle</code> file presented below.</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> buildTime() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">def</span> df = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyyMMddHHmmss\"</span>)</span><br><span class=\"line\">    df.setTimeZone(TimeZone.getTimeZone(<span class=\"string\">\"Europe/Warsaw\"</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> df.format(<span class=\"keyword\">new</span> Date())</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> gitSha() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'git rev-parse --short HEAD'</span>.execute().text.trim()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: <span class=\"string\">'android'</span></span><br><span class=\"line\">apply plugin: <span class=\"string\">'android-test'</span></span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">    packagingOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'LICENSE.txt'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/LICENSE'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/LICENSE.txt'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/NOTICE'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/NOTICE.txt'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'values/attrs.xml'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'values/dimens.xml'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'values/colors.xml'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    compileSdkVersion <span class=\"number\">19</span></span><br><span class=\"line\">    buildToolsVersion <span class=\"string\">\"19.0.3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        minSdkVersion <span class=\"number\">14</span></span><br><span class=\"line\">        targetSdkVersion <span class=\"number\">19</span></span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName gitSha() + <span class=\"string\">'-'</span> + buildTime()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">sourceCompatibility</span> JavaVersion.VERSION_1_7</span><br><span class=\"line\">        <span class=\"keyword\">targetCompatibility</span> JavaVersion.VERSION_1_7</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","more":"<p>When we work in a team projects, our code constantly changes and being tested. Often some bugs occur in a specific version of application and no longer exists in next version of the project, because one programmer might fixed the bug according to the <a href=\"http://programmer.97things.oreilly.com/wiki/index.php/The_Boy_Scout_Rule\" target=\"_blank\" rel=\"noopener\">Boy Scout Rule</a> and this is good. Nevertheless, sometimes we need to write documentation and check in which version bug occurred to be sure, that it was really fixed. In addition, <a href=\"http://en.wikipedia.org/wiki/Quality_assurance\" target=\"_blank\" rel=\"noopener\">QA</a> Engineer needs to know, which version of the project he or she should check. That’s why we should introduce versioning system to our project. In Android Manifest we have <code>versionCode</code> and <code>versionName</code>. The <code>versionCode</code> is used for updates on Google Play Store and it has to be integer value. We should increment <code>versionCode</code> before releasing new version of the application for the users. The <code>versionName</code> available in Android Manifest is a string value and we can use it to store information, which we need in a current project. When we use Git as a Version Control System, we can put SHA value of a specific commit into our version name. In addition, we can add date and time of compilation to this variable. After that, our <code>versionName</code> contains very detailed information about current version of our application. Exemplary <code>versionName</code> will look in as follows: <code>f935ea7-20140913144001</code>. We can obtain that with proper configuration of <code>build.gradle</code> file containing <code>buildTime()</code> method and <code>gitSha()</code> method. Please, take a look at creation of <code>versionName</code> in 35th line of the <code>build.gradle</code> file presented below.</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.text.SimpleDateFormat</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> buildTime() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">def</span> df = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyyMMddHHmmss\"</span>)</span><br><span class=\"line\">    df.setTimeZone(TimeZone.getTimeZone(<span class=\"string\">\"Europe/Warsaw\"</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> df.format(<span class=\"keyword\">new</span> Date())</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> gitSha() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'git rev-parse --short HEAD'</span>.execute().text.trim()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: <span class=\"string\">'android'</span></span><br><span class=\"line\">apply plugin: <span class=\"string\">'android-test'</span></span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">    packagingOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'LICENSE.txt'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/LICENSE'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/LICENSE.txt'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/NOTICE'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'META-INF/NOTICE.txt'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'values/attrs.xml'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'values/dimens.xml'</span></span><br><span class=\"line\">        <span class=\"keyword\">exclude</span> <span class=\"string\">'values/colors.xml'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    compileSdkVersion <span class=\"number\">19</span></span><br><span class=\"line\">    buildToolsVersion <span class=\"string\">\"19.0.3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    defaultConfig &#123;</span><br><span class=\"line\">        minSdkVersion <span class=\"number\">14</span></span><br><span class=\"line\">        targetSdkVersion <span class=\"number\">19</span></span><br><span class=\"line\">        versionCode <span class=\"number\">1</span></span><br><span class=\"line\">        versionName gitSha() + <span class=\"string\">'-'</span> + buildTime()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    compileOptions &#123;</span><br><span class=\"line\">        <span class=\"keyword\">sourceCompatibility</span> JavaVersion.VERSION_1_7</span><br><span class=\"line\">        <span class=\"keyword\">targetCompatibility</span> JavaVersion.VERSION_1_7</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":[{"name":"git","path":"api/tags/git.json"},{"name":"android","path":"api/tags/android.json"},{"name":"gradle","path":"api/tags/gradle.json"}]}