{"title":"Avoiding OutOfMemory Error while loading large Bitmaps in Android UI","slug":"avoiding-outofmemory-error-while-loading-large-bitmaps-in-android-ui","date":"2014-02-23T12:34:00.000Z","updated":"2019-07-03T22:51:02.810Z","comments":true,"path":"api/articles/avoiding-outofmemory-error-while-loading-large-bitmaps-in-android-ui.json","excerpt":null,"covers":null,"content":"<p>Sometimes we may encounter an error connected with loading too large Bitmaps into Android UI. In such cases, we may receive <code>OutOfMemoryError</code> in stack trace. In Android, we are working with limited memory and we shouldn’t load images with full resolution into UI. These images should be scaled down in order to save memory and increase performance of the application. It’s very well described in official Android documentation in section <a href=\"http://developer.android.com/training/displaying-bitmaps/load-bitmap.html\" target=\"_blank\" rel=\"noopener\" title=\"Loading Large Bitmaps Efficiently\">Loading Large Bitmaps Efficiently</a>. It’s worth reading. We can deal with memory problem in three easy steps:</p>\n<ol>\n<li>Read image dimensions and type</li>\n<li>Scale down image</li>\n<li>Load scaled down version of the image to memory</li>\n</ol>\n<p>Now, we are ready to display image in the UI. In Android documentation, available from the link placed above, you can find relevant code, which will help you to solve the problem. If you want to load image from file path instead of resources, you can use my code snippet available below. </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Bitmap <span class=\"title\">decodeSampledBitmap</span><span class=\"params\">(String filePath, <span class=\"keyword\">int</span> reqWidth, <span class=\"keyword\">int</span> reqHeight)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> BitmapFactory.Options options = <span class=\"keyword\">new</span> BitmapFactory.Options();</span><br><span class=\"line\">    options.inJustDecodeBounds = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    BitmapFactory.decodeFile(filePath,options);</span><br><span class=\"line\">    options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight);</span><br><span class=\"line\">    options.inJustDecodeBounds = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> BitmapFactory.decodeFile(filePath,options);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Source of the <code>calculateInSampleSize</code> method is available in <a href=\"http://developer.android.com/training/displaying-bitmaps/load-bitmap.html\" target=\"_blank\" rel=\"noopener\">Android documentation</a>. </p>\n<p><strong>Update:</strong> There is a library, which solves this problem and provides caching. It’s <a href=\"http://square.github.io/picasso/\" target=\"_blank\" rel=\"noopener\">Picasso</a> from Square. I recommend to use this library especially, when you’re dealing with a lot of images, ListViews and Adapters.</p>\n","more":"<p>Sometimes we may encounter an error connected with loading too large Bitmaps into Android UI. In such cases, we may receive <code>OutOfMemoryError</code> in stack trace. In Android, we are working with limited memory and we shouldn’t load images with full resolution into UI. These images should be scaled down in order to save memory and increase performance of the application. It’s very well described in official Android documentation in section <a href=\"http://developer.android.com/training/displaying-bitmaps/load-bitmap.html\" target=\"_blank\" rel=\"noopener\" title=\"Loading Large Bitmaps Efficiently\">Loading Large Bitmaps Efficiently</a>. It’s worth reading. We can deal with memory problem in three easy steps:</p>\n<ol>\n<li>Read image dimensions and type</li>\n<li>Scale down image</li>\n<li>Load scaled down version of the image to memory</li>\n</ol>\n<p>Now, we are ready to display image in the UI. In Android documentation, available from the link placed above, you can find relevant code, which will help you to solve the problem. If you want to load image from file path instead of resources, you can use my code snippet available below. </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Bitmap <span class=\"title\">decodeSampledBitmap</span><span class=\"params\">(String filePath, <span class=\"keyword\">int</span> reqWidth, <span class=\"keyword\">int</span> reqHeight)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> BitmapFactory.Options options = <span class=\"keyword\">new</span> BitmapFactory.Options();</span><br><span class=\"line\">    options.inJustDecodeBounds = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    BitmapFactory.decodeFile(filePath,options);</span><br><span class=\"line\">    options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight);</span><br><span class=\"line\">    options.inJustDecodeBounds = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> BitmapFactory.decodeFile(filePath,options);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Source of the <code>calculateInSampleSize</code> method is available in <a href=\"http://developer.android.com/training/displaying-bitmaps/load-bitmap.html\" target=\"_blank\" rel=\"noopener\">Android documentation</a>. </p>\n<p><strong>Update:</strong> There is a library, which solves this problem and provides caching. It’s <a href=\"http://square.github.io/picasso/\" target=\"_blank\" rel=\"noopener\">Picasso</a> from Square. I recommend to use this library especially, when you’re dealing with a lot of images, ListViews and Adapters.</p>\n","categories":[],"tags":[{"name":"java","path":"api/tags/java.json"},{"name":"android","path":"api/tags/android.json"}]}