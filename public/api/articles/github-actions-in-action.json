{"title":"GitHub Actions in action!","slug":"github-actions-in-action","date":"2019-11-04T13:11:36.000Z","updated":"2019-11-04T13:11:36.719Z","comments":true,"path":"api/articles/github-actions-in-action.json","excerpt":null,"covers":null,"content":"<p>Recently GitHub introduced really interesting feature to their service called <a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener\">Actions</a>. Actions can be used for automating various tasks related to the repositories like CI, CD, testing, deployment and whatnot. The general concept is as follows: We can create so called action, which can be based on a JavaScript project or a Docker container. We can also use existing actions in the <a href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" rel=\"noopener\">Marketplace</a>. Next, we can create workflow in the <code>yml</code> file, where we define our workflow. Workflow can consist of on a job with many steps using different actions. We can also define multiple jobs, where one depends on another. Workflows can be triggered in many ways. E.g. by push, pull request, creating issue, publishing release, scheduled event or external event.</p>\n<p>E.g. we can define scheduled event, which will trigger workflow every hour as follows:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on:</span><br><span class=\"line\">  schedule:</span><br><span class=\"line\">    - cron:  &apos;0 * * * *&apos;</span><br></pre></td></tr></table></figure>\n\n<p>It has the same syntax like cron.</p>\n<p>We can do many things with workflows and actions like deploying websites, artifacts with libraries, run tests on multiple environments, execute shell scripts on external servers and more. Have a look at the <a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions\" target=\"_blank\" rel=\"noopener\">official Github documenation</a> and <a href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" rel=\"noopener\">Marketplace</a> to see what kind of actions people are creating.</p>\n<p>I wanted to try out these actions and workflows, so I automated the deployment process of my website (this one, which you’re visiting right now). Its code is open source and you can see it at <a href=\"https://github.com/pwittchen/wittchen.io\" target=\"_blank\" rel=\"noopener\">https://github.com/pwittchen/wittchen.io</a>. I host my website on the external web server. I can access it via FTP and SSH. Website is based in <a href=\"http://hexo.io\" target=\"_blank\" rel=\"noopener\">hexo</a> framework for static website generation. Before deployment I regenerate contents of the <code>public/</code> directory with command:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make regenerate</span><br></pre></td></tr></table></figure>\n\n<p>Then, I can commit and push my changes to the GitHub repository. My action is triggered whenever I push a change to the <code>public/</code> directory on the repository on the <code>master</code> branch. Once it’s done, workflows checks out my repository and starts copying files the the FTP server in the defined directory. GitHub allows us to keep the secrects like usernames and passwords, tokens etc. inside the repository configuration. we can access it via repository settings on the GitHub website. Once they’re created, they cannot be viewed or edited. We can just delete them (and create again if we want to). Our workflow file has to be located in the <code>.github/workflows/</code> directory. We can have more than one workflow.</p>\n<p>You can see my <code>deploy.yml</code> workflow below:</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Publish</span> <span class=\"string\">Website</span></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\"><span class=\"attr\">  push:</span></span><br><span class=\"line\"><span class=\"attr\">    branches:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    paths:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">'public/*'</span></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\"><span class=\"attr\">  FTP-Deploy-Action:</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">FTP-Deploy-Action</span></span><br><span class=\"line\"><span class=\"attr\">    runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\"><span class=\"attr\">    steps:</span></span><br><span class=\"line\"><span class=\"attr\">    - uses:</span> <span class=\"string\">actions/checkout@master</span></span><br><span class=\"line\"><span class=\"attr\">    - name:</span> <span class=\"string\">FTP-Deploy-Action</span></span><br><span class=\"line\"><span class=\"attr\">      uses:</span> <span class=\"string\">SamKirkland/FTP-Deploy-Action@2.0.0</span></span><br><span class=\"line\"><span class=\"attr\">      env:</span></span><br><span class=\"line\"><span class=\"attr\">        FTP_SERVER:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_SERVER</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        FTP_USERNAME:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_USERNAME</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        FTP_PASSWORD:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_PASSWORD</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        REMOTE_DIR:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_REMOTE_DIR</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">        <span class=\"string\">LOCAL_DIR</span> <span class=\"string\">:</span> <span class=\"string\">\"public\"</span></span><br><span class=\"line\"><span class=\"attr\">        ARGS:</span> <span class=\"bullet\">--delete</span> <span class=\"bullet\">--transfer-all</span></span><br></pre></td></tr></table></figure>\n\n<p>I we can see, I defined secrects for FTP server address, username, password and remote directory.</p>\n<p>Previously I was using <code>deploy.sh</code> bash script, which looked like that:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> .ftpconfig</span><br><span class=\"line\">lftp ftp://<span class=\"variable\">$USER</span>:<span class=\"variable\">$PASS</span>@<span class=\"variable\">$HOST</span> -e <span class=\"string\">\"set ftp:ssl-allow no; rm domains/<span class=\"variable\">$HOST</span>/public_html/css/apollo.css; mirror -R -v --only-newer public domains/<span class=\"variable\">$HOST</span>/public_html; quit\"</span></span><br></pre></td></tr></table></figure>\n\n<p>I had to be careful to avoid commiting <code>.ftpconfig</code> file and exclude it from commits like that:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git update-index --assume-unchanged .ftpconfig</span><br></pre></td></tr></table></figure>\n\n<p>In my workflow, I used <a href=\"https://github.com/SamKirkland/FTP-Deploy-Action\" target=\"_blank\" rel=\"noopener\">FTP-Deploy-Action</a>, which uses <code>lftp</code> program for the deployment, so it’s the same program I used for deployment of my website before, but now it’s executed on the GitHub infrastructure - not my computer. Thanks to that, I have automated website deployment process and whenever I update my website and push the changes, it’s uploaded automatically to my server via FTP.</p>\n<p>As we could see, GitHub actions can be hosted in the GitHub repositories, we can use them directly in our workflows and define our own custom actions in the same way.</p>\n<p>On the <a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener\">GitHub website</a>, we can read that depending on our subscription status, we can have several amounts of free minutes for executing actions and after crossing given thershold, we will be charged per minute in pay-as-you go model. As far I as see, amount of minutes is enough for personal usage and prices are reasonable.</p>\n<p>If you’re using GitHub, then Actions are definitely worth considering for automation, because they give you endless opportunities for automating your work and CI/CD pipelines with huge flexibility and stability thanks to Docker containers. In the future, probably I’ll play more with it and maybe automate the last stage of the release process of my Java and Kotlin libraries with that feature.</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ul>\n<li><a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener\">https://github.com/features/actions</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions/configuring-a-workflow\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions/configuring-a-workflow</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions/building-actions\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions/building-actions</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions/setting-up-continuous-integration-on-github\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions/setting-up-continuous-integration-on-github</a></li>\n<li><a href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" rel=\"noopener\">https://github.com/marketplace?type=actions</a></li>\n<li><a href=\"https://github.com/maddox/actions\" target=\"_blank\" rel=\"noopener\">https://github.com/maddox/actions</a></li>\n</ul>\n","more":"<p>Recently GitHub introduced really interesting feature to their service called <a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener\">Actions</a>. Actions can be used for automating various tasks related to the repositories like CI, CD, testing, deployment and whatnot. The general concept is as follows: We can create so called action, which can be based on a JavaScript project or a Docker container. We can also use existing actions in the <a href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" rel=\"noopener\">Marketplace</a>. Next, we can create workflow in the <code>yml</code> file, where we define our workflow. Workflow can consist of on a job with many steps using different actions. We can also define multiple jobs, where one depends on another. Workflows can be triggered in many ways. E.g. by push, pull request, creating issue, publishing release, scheduled event or external event.</p>\n<p>E.g. we can define scheduled event, which will trigger workflow every hour as follows:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">on:</span><br><span class=\"line\">  schedule:</span><br><span class=\"line\">    - cron:  &apos;0 * * * *&apos;</span><br></pre></td></tr></table></figure>\n\n<p>It has the same syntax like cron.</p>\n<p>We can do many things with workflows and actions like deploying websites, artifacts with libraries, run tests on multiple environments, execute shell scripts on external servers and more. Have a look at the <a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions\" target=\"_blank\" rel=\"noopener\">official Github documenation</a> and <a href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" rel=\"noopener\">Marketplace</a> to see what kind of actions people are creating.</p>\n<p>I wanted to try out these actions and workflows, so I automated the deployment process of my website (this one, which you’re visiting right now). Its code is open source and you can see it at <a href=\"https://github.com/pwittchen/wittchen.io\" target=\"_blank\" rel=\"noopener\">https://github.com/pwittchen/wittchen.io</a>. I host my website on the external web server. I can access it via FTP and SSH. Website is based in <a href=\"http://hexo.io\" target=\"_blank\" rel=\"noopener\">hexo</a> framework for static website generation. Before deployment I regenerate contents of the <code>public/</code> directory with command:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make regenerate</span><br></pre></td></tr></table></figure>\n\n<p>Then, I can commit and push my changes to the GitHub repository. My action is triggered whenever I push a change to the <code>public/</code> directory on the repository on the <code>master</code> branch. Once it’s done, workflows checks out my repository and starts copying files the the FTP server in the defined directory. GitHub allows us to keep the secrects like usernames and passwords, tokens etc. inside the repository configuration. we can access it via repository settings on the GitHub website. Once they’re created, they cannot be viewed or edited. We can just delete them (and create again if we want to). Our workflow file has to be located in the <code>.github/workflows/</code> directory. We can have more than one workflow.</p>\n<p>You can see my <code>deploy.yml</code> workflow below:</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Publish</span> <span class=\"string\">Website</span></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\"><span class=\"attr\">  push:</span></span><br><span class=\"line\"><span class=\"attr\">    branches:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">master</span></span><br><span class=\"line\"><span class=\"attr\">    paths:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">'public/*'</span></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\"><span class=\"attr\">  FTP-Deploy-Action:</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">FTP-Deploy-Action</span></span><br><span class=\"line\"><span class=\"attr\">    runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\"><span class=\"attr\">    steps:</span></span><br><span class=\"line\"><span class=\"attr\">    - uses:</span> <span class=\"string\">actions/checkout@master</span></span><br><span class=\"line\"><span class=\"attr\">    - name:</span> <span class=\"string\">FTP-Deploy-Action</span></span><br><span class=\"line\"><span class=\"attr\">      uses:</span> <span class=\"string\">SamKirkland/FTP-Deploy-Action@2.0.0</span></span><br><span class=\"line\"><span class=\"attr\">      env:</span></span><br><span class=\"line\"><span class=\"attr\">        FTP_SERVER:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_SERVER</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        FTP_USERNAME:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_USERNAME</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        FTP_PASSWORD:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_PASSWORD</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        REMOTE_DIR:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.FTP_REMOTE_DIR</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">        <span class=\"string\">LOCAL_DIR</span> <span class=\"string\">:</span> <span class=\"string\">\"public\"</span></span><br><span class=\"line\"><span class=\"attr\">        ARGS:</span> <span class=\"bullet\">--delete</span> <span class=\"bullet\">--transfer-all</span></span><br></pre></td></tr></table></figure>\n\n<p>I we can see, I defined secrects for FTP server address, username, password and remote directory.</p>\n<p>Previously I was using <code>deploy.sh</code> bash script, which looked like that:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> .ftpconfig</span><br><span class=\"line\">lftp ftp://<span class=\"variable\">$USER</span>:<span class=\"variable\">$PASS</span>@<span class=\"variable\">$HOST</span> -e <span class=\"string\">\"set ftp:ssl-allow no; rm domains/<span class=\"variable\">$HOST</span>/public_html/css/apollo.css; mirror -R -v --only-newer public domains/<span class=\"variable\">$HOST</span>/public_html; quit\"</span></span><br></pre></td></tr></table></figure>\n\n<p>I had to be careful to avoid commiting <code>.ftpconfig</code> file and exclude it from commits like that:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git update-index --assume-unchanged .ftpconfig</span><br></pre></td></tr></table></figure>\n\n<p>In my workflow, I used <a href=\"https://github.com/SamKirkland/FTP-Deploy-Action\" target=\"_blank\" rel=\"noopener\">FTP-Deploy-Action</a>, which uses <code>lftp</code> program for the deployment, so it’s the same program I used for deployment of my website before, but now it’s executed on the GitHub infrastructure - not my computer. Thanks to that, I have automated website deployment process and whenever I update my website and push the changes, it’s uploaded automatically to my server via FTP.</p>\n<p>As we could see, GitHub actions can be hosted in the GitHub repositories, we can use them directly in our workflows and define our own custom actions in the same way.</p>\n<p>On the <a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener\">GitHub website</a>, we can read that depending on our subscription status, we can have several amounts of free minutes for executing actions and after crossing given thershold, we will be charged per minute in pay-as-you go model. As far I as see, amount of minutes is enough for personal usage and prices are reasonable.</p>\n<p>If you’re using GitHub, then Actions are definitely worth considering for automation, because they give you endless opportunities for automating your work and CI/CD pipelines with huge flexibility and stability thanks to Docker containers. In the future, probably I’ll play more with it and maybe automate the last stage of the release process of my Java and Kotlin libraries with that feature.</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ul>\n<li><a href=\"https://github.com/features/actions\" target=\"_blank\" rel=\"noopener\">https://github.com/features/actions</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions/configuring-a-workflow\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions/configuring-a-workflow</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions/building-actions\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions/building-actions</a></li>\n<li><a href=\"https://help.github.com/en/github/automating-your-workflow-with-github-actions/setting-up-continuous-integration-on-github\" target=\"_blank\" rel=\"noopener\">https://help.github.com/en/github/automating-your-workflow-with-github-actions/setting-up-continuous-integration-on-github</a></li>\n<li><a href=\"https://github.com/marketplace?type=actions\" target=\"_blank\" rel=\"noopener\">https://github.com/marketplace?type=actions</a></li>\n<li><a href=\"https://github.com/maddox/actions\" target=\"_blank\" rel=\"noopener\">https://github.com/maddox/actions</a></li>\n</ul>\n","categories":[],"tags":[{"name":"git","path":"api/tags/git.json"},{"name":"ci","path":"api/tags/ci.json"},{"name":"github","path":"api/tags/github.json"},{"name":"automation","path":"api/tags/automation.json"}]}