{"title":"Test coverage report for Android application","slug":"test-coverage-in-android-applications","date":"2015-06-03T16:22:00.000Z","updated":"2019-10-02T13:05:26.141Z","comments":true,"path":"api/articles/test-coverage-in-android-applications.json","excerpt":null,"covers":["/images/posts/2015/test-coverage/prefser_test_coverage_report_03.06.2015.png","/images/posts/2015/test-coverage/prefser_test_coverage_04.06.2015.png"],"content":"<p><strong>Update:</strong> see newer article about <a href=\"/unit-test-coverage-report-with-travis-ci-for-robolectric-on-android/\"><strong>Unit test coverage report with Travis CI for Robolectric on Android</strong></a>. For a long time, I wasn’t able to find the right way to generate test coverage reports for Android instrumentation unit tests created with AndroidJUnit4 runner. In the past I’ve found many solutions, but none of them was working or they were compatible only with Robolectric, which I currently don’t use. Other developers also stopped using it for the new projects. E.g. <a href=\"https://github.com/square/sqlbrite\" target=\"_blank\" rel=\"noopener\">Sqlbrite</a> from Square is using AndroidJUnit4 runner as my projects do. Recently, I’ve found <a href=\"http://www.reddit.com/r/androiddev/comments/2v1n2u/code_coverage_in_android_studio/\" target=\"_blank\" rel=\"noopener\">an interesting discussion on Reddit</a>, where we can find information about enabling test coverage very easily without additional plugins, scripts and many lines of configuration. Moreover, Android SDK currently has built-in support for <a href=\"http://emma.sourceforge.net/\" target=\"_blank\" rel=\"noopener\">Emma Test Coverage</a>, what we can read in <a href=\"http://developer.android.com/reference/android/test/InstrumentationTestRunner.html\" target=\"_blank\" rel=\"noopener\">official documentation</a>. Basically, the only thing we need to do, is to apply <code>jacoco-android</code> plugin in <code>build.gradle</code> file:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: <span class=\"string\">'jacoco-android'</span></span><br><span class=\"line\"></span><br><span class=\"line\">and then set `testCoverageEnabled` parameter to `<span class=\"keyword\">true</span>` as follows:</span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">   buildTypes &#123;</span><br><span class=\"line\">      debug &#123;</span><br><span class=\"line\">         testCoverageEnabled = <span class=\"keyword\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>In order to create test coverage report, we need Android device or emulator connected to the computer, because <code>connectedCheck</code> task needs to be executed before creating the report. Next, we can execute the following Gradle task from CLI:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew createDebugCoverageReport</span><br></pre></td></tr></table></figure>\n\n<p>Task will analyze code of our project in <code>/src/main/java/</code> directory and unit tests placed in <code>/src/androidTest/java/</code> directory. After executing this task, we can find test coverage report in the following directory of the module:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/build/outputs/reports/coverage/debug/</span><br></pre></td></tr></table></figure>\n\n<p>When we open <code>index.html</code> file, we can see visual report from test coverage, which can be viewed in a web browser. Moreover, in the same directory, we can find <code>report.xml</code> file, which can used for test coverage analysis on continuous integration server. Besides mentioned files, Gradle will generate <code>coverage.ec</code> file in the following directory:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/build/outputs/code-coverage/connected/</span><br></pre></td></tr></table></figure>\n\n<p>In some cases, we may need this file. E.g. if chosen Jenkins plugin or another tool will need it in order to generate test coverage report properly. Below, you can see exemplary test coverage report for <a href=\"https://github.com/pwittchen/prefser\" target=\"_blank\" rel=\"noopener\">Prefser</a>, which is an open-source Android library.</p>\n<p><img src=\"/images/posts/2015/test-coverage/prefser_test_coverage_report_03.06.2015.png\" alt=\"prefser_test_coverage_report_03.06.2015\"></p>\n<p>This report was generated with <a href=\"http://www.eclemma.org/jacoco/\" target=\"_blank\" rel=\"noopener\">JaCoCo</a> code coverage library. After analyzing test coverage report, I’ve added a few new unit tests, slightly modified the project and managed to obtain <strong>100% test coverage</strong>.</p>\n<p><img src=\"/images/posts/2015/test-coverage/prefser_test_coverage_04.06.2015.png\" alt=\"prefser_test_coverage_04.06.2015\"></p>\n<p>In order to publish our report on Jenkins CI, we can use test coverage plugins, but I am not sure about their stability. Another solution is <a href=\"https://wiki.jenkins-ci.org/display/JENKINS/HTML+Publisher+Plugin\" target=\"_blank\" rel=\"noopener\">HTML Publisher plugin</a>. We can add post-build action and publish our test coverage report generated by default as HTML website inside Jenkins job. In my opinion, it’s quite convenient solution, because it is easy to set up and allows us to navigate to the code, browse uncovered lines, methods and branches. Finally, with this clean and fast solution we can easily monitor test coverage of our Android projects, find bottlenecks and increase overall quality of the applications and libraries.</p>\n<p><strong>Link to the old blog post archive with comments of the users</strong>: <a href=\"https://web.archive.org/web/20171210224809/http://blog.wittchen.biz.pl/test-coverage-report-for-android-application\" target=\"_blank\" rel=\"noopener\">https://web.archive.org/web/20171210224809/http://blog.wittchen.biz.pl/test-coverage-report-for-android-application</a></p>\n","more":"<p><strong>Update:</strong> see newer article about <a href=\"/unit-test-coverage-report-with-travis-ci-for-robolectric-on-android/\"><strong>Unit test coverage report with Travis CI for Robolectric on Android</strong></a>. For a long time, I wasn’t able to find the right way to generate test coverage reports for Android instrumentation unit tests created with AndroidJUnit4 runner. In the past I’ve found many solutions, but none of them was working or they were compatible only with Robolectric, which I currently don’t use. Other developers also stopped using it for the new projects. E.g. <a href=\"https://github.com/square/sqlbrite\" target=\"_blank\" rel=\"noopener\">Sqlbrite</a> from Square is using AndroidJUnit4 runner as my projects do. Recently, I’ve found <a href=\"http://www.reddit.com/r/androiddev/comments/2v1n2u/code_coverage_in_android_studio/\" target=\"_blank\" rel=\"noopener\">an interesting discussion on Reddit</a>, where we can find information about enabling test coverage very easily without additional plugins, scripts and many lines of configuration. Moreover, Android SDK currently has built-in support for <a href=\"http://emma.sourceforge.net/\" target=\"_blank\" rel=\"noopener\">Emma Test Coverage</a>, what we can read in <a href=\"http://developer.android.com/reference/android/test/InstrumentationTestRunner.html\" target=\"_blank\" rel=\"noopener\">official documentation</a>. Basically, the only thing we need to do, is to apply <code>jacoco-android</code> plugin in <code>build.gradle</code> file:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: <span class=\"string\">'jacoco-android'</span></span><br><span class=\"line\"></span><br><span class=\"line\">and then set `testCoverageEnabled` parameter to `<span class=\"keyword\">true</span>` as follows:</span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">   buildTypes &#123;</span><br><span class=\"line\">      debug &#123;</span><br><span class=\"line\">         testCoverageEnabled = <span class=\"keyword\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>In order to create test coverage report, we need Android device or emulator connected to the computer, because <code>connectedCheck</code> task needs to be executed before creating the report. Next, we can execute the following Gradle task from CLI:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew createDebugCoverageReport</span><br></pre></td></tr></table></figure>\n\n<p>Task will analyze code of our project in <code>/src/main/java/</code> directory and unit tests placed in <code>/src/androidTest/java/</code> directory. After executing this task, we can find test coverage report in the following directory of the module:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/build/outputs/reports/coverage/debug/</span><br></pre></td></tr></table></figure>\n\n<p>When we open <code>index.html</code> file, we can see visual report from test coverage, which can be viewed in a web browser. Moreover, in the same directory, we can find <code>report.xml</code> file, which can used for test coverage analysis on continuous integration server. Besides mentioned files, Gradle will generate <code>coverage.ec</code> file in the following directory:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/build/outputs/code-coverage/connected/</span><br></pre></td></tr></table></figure>\n\n<p>In some cases, we may need this file. E.g. if chosen Jenkins plugin or another tool will need it in order to generate test coverage report properly. Below, you can see exemplary test coverage report for <a href=\"https://github.com/pwittchen/prefser\" target=\"_blank\" rel=\"noopener\">Prefser</a>, which is an open-source Android library.</p>\n<p><img src=\"/images/posts/2015/test-coverage/prefser_test_coverage_report_03.06.2015.png\" alt=\"prefser_test_coverage_report_03.06.2015\"></p>\n<p>This report was generated with <a href=\"http://www.eclemma.org/jacoco/\" target=\"_blank\" rel=\"noopener\">JaCoCo</a> code coverage library. After analyzing test coverage report, I’ve added a few new unit tests, slightly modified the project and managed to obtain <strong>100% test coverage</strong>.</p>\n<p><img src=\"/images/posts/2015/test-coverage/prefser_test_coverage_04.06.2015.png\" alt=\"prefser_test_coverage_04.06.2015\"></p>\n<p>In order to publish our report on Jenkins CI, we can use test coverage plugins, but I am not sure about their stability. Another solution is <a href=\"https://wiki.jenkins-ci.org/display/JENKINS/HTML+Publisher+Plugin\" target=\"_blank\" rel=\"noopener\">HTML Publisher plugin</a>. We can add post-build action and publish our test coverage report generated by default as HTML website inside Jenkins job. In my opinion, it’s quite convenient solution, because it is easy to set up and allows us to navigate to the code, browse uncovered lines, methods and branches. Finally, with this clean and fast solution we can easily monitor test coverage of our Android projects, find bottlenecks and increase overall quality of the applications and libraries.</p>\n<p><strong>Link to the old blog post archive with comments of the users</strong>: <a href=\"https://web.archive.org/web/20171210224809/http://blog.wittchen.biz.pl/test-coverage-report-for-android-application\" target=\"_blank\" rel=\"noopener\">https://web.archive.org/web/20171210224809/http://blog.wittchen.biz.pl/test-coverage-report-for-android-application</a></p>\n","categories":[],"tags":[{"name":"android","path":"api/tags/android.json"},{"name":"testing","path":"api/tags/testing.json"},{"name":"coverage","path":"api/tags/coverage.json"}]}