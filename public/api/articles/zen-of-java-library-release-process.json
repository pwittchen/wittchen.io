{"title":"Zen of the Java library release process","slug":"zen-of-java-library-release-process","date":"2019-06-08T08:58:10.000Z","updated":"2019-07-03T22:51:02.816Z","comments":true,"path":"api/articles/zen-of-java-library-release-process.json","excerpt":null,"covers":null,"content":"<p>In my <a href=\"/publishing-jar-aar-to-maven-central/\">previous article</a> I published information about publishing JAR/AAR library to the Maven Central Repository. A few steps of that process were automated, but a few of them were still manual. I mean closing and release process which had to be done by manual clicking on the Sonatype website. Fortunately, it’s possible to automate it. In order to do that, I used <a href=\"https://github.com/Codearte/gradle-nexus-staging-plugin\" target=\"_blank\" rel=\"noopener\">gradle-nexus-staging-plugin</a> developed by <a href=\"https://github.com/Codearte\" target=\"_blank\" rel=\"noopener\">Codearte</a>. Thanks to this plugin I could get rid of the remaining manual steps left in the release process. </p>\n<p><strong>Please note</strong>, if you want to apply configuration described in this article to your project, you need to perform the steps described in the article about <a href=\"/publishing-jar-aar-to-maven-central/\">Publishing JAR/AAR to the Maven Central</a>.</p>\n<p>In my project, in the top-level <a href=\"https://github.com/pwittchen/ReactiveNetwork/blob/RxJava2.x/build.gradle\" target=\"_blank\" rel=\"noopener\">build.gradle</a> file I had to do the following setup:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: <span class=\"string\">'io.codearte.nexus-staging'</span></span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">buildscript</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">repositories</span> &#123;</span><br><span class=\"line\">    google()</span><br><span class=\"line\">    jcenter()</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">    maven &#123;</span><br><span class=\"line\">      url <span class=\"string\">'https://plugins.gradle.org/m2/'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">classpath</span> <span class=\"string\">\"io.codearte.gradle.nexus:gradle-nexus-staging-plugin:0.12.0\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> getRepositoryUsername() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> hasProperty(<span class=\"string\">'NEXUS_USERNAME'</span>) ? NEXUS_USERNAME : <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> getRepositoryPassword() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> hasProperty(<span class=\"string\">'NEXUS_PASSWORD'</span>) ? NEXUS_PASSWORD : <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">nexusStaging &#123;</span><br><span class=\"line\">  packageGroup = <span class=\"keyword\">GROUP</span> <span class=\"comment\">//optional if packageGroup == project.getGroup()</span></span><br><span class=\"line\">  stagingProfileId = <span class=\"string\">\"YOUR_STAGING_PROFILE\"</span> <span class=\"comment\">//when not defined will be got from server using \"packageGroup\"</span></span><br><span class=\"line\">  username = getRepositoryUsername()</span><br><span class=\"line\">  password = getRepositoryPassword()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>In order to get <code>YOUR_STAGING_PROFILE</code>, we need to call the following command available in the plugin:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew getStagingProfile</span><br></pre></td></tr></table></figure>\n\n<p>When we are done, we can simply call:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew uploadArchives closeAndReleaseRepository</span><br></pre></td></tr></table></figure>\n\n<p>These two gradle tasks will upload our artifact, close and release it, so we won’t have to perform any manual steps in that process. After that, we just need to wait for the Maven sync as usual.</p>\n<p>My complete <code>release.sh</code> script looks like that:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\">./gradlew clean build <span class=\"built_in\">test</span> check uploadArchives closeAndReleaseRepository</span><br></pre></td></tr></table></figure>\n\n<p>Before upload and release, I also clean everything, build an artifact, run tests and static code analysis. It’s not required, but it’s good to do that.</p>\n<p>If you are interested in complete project configuration, you can have a look at the <a href=\"https://github.com/pwittchen/ReactiveNetwork\" target=\"_blank\" rel=\"noopener\">https://github.com/pwittchen/ReactiveNetwork</a> repository. It’s an Android library, but the same configuration can be applied to any JVM project built with Gradle. I have performed library release with this plugin a few times and it seems to work well.</p>\n","more":"<p>In my <a href=\"/publishing-jar-aar-to-maven-central/\">previous article</a> I published information about publishing JAR/AAR library to the Maven Central Repository. A few steps of that process were automated, but a few of them were still manual. I mean closing and release process which had to be done by manual clicking on the Sonatype website. Fortunately, it’s possible to automate it. In order to do that, I used <a href=\"https://github.com/Codearte/gradle-nexus-staging-plugin\" target=\"_blank\" rel=\"noopener\">gradle-nexus-staging-plugin</a> developed by <a href=\"https://github.com/Codearte\" target=\"_blank\" rel=\"noopener\">Codearte</a>. Thanks to this plugin I could get rid of the remaining manual steps left in the release process. </p>\n<p><strong>Please note</strong>, if you want to apply configuration described in this article to your project, you need to perform the steps described in the article about <a href=\"/publishing-jar-aar-to-maven-central/\">Publishing JAR/AAR to the Maven Central</a>.</p>\n<p>In my project, in the top-level <a href=\"https://github.com/pwittchen/ReactiveNetwork/blob/RxJava2.x/build.gradle\" target=\"_blank\" rel=\"noopener\">build.gradle</a> file I had to do the following setup:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apply plugin: <span class=\"string\">'io.codearte.nexus-staging'</span></span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">buildscript</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">repositories</span> &#123;</span><br><span class=\"line\">    google()</span><br><span class=\"line\">    jcenter()</span><br><span class=\"line\">    mavenCentral()</span><br><span class=\"line\">    maven &#123;</span><br><span class=\"line\">      url <span class=\"string\">'https://plugins.gradle.org/m2/'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">dependencies</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">classpath</span> <span class=\"string\">\"io.codearte.gradle.nexus:gradle-nexus-staging-plugin:0.12.0\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> getRepositoryUsername() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> hasProperty(<span class=\"string\">'NEXUS_USERNAME'</span>) ? NEXUS_USERNAME : <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> getRepositoryPassword() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> hasProperty(<span class=\"string\">'NEXUS_PASSWORD'</span>) ? NEXUS_PASSWORD : <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">nexusStaging &#123;</span><br><span class=\"line\">  packageGroup = <span class=\"keyword\">GROUP</span> <span class=\"comment\">//optional if packageGroup == project.getGroup()</span></span><br><span class=\"line\">  stagingProfileId = <span class=\"string\">\"YOUR_STAGING_PROFILE\"</span> <span class=\"comment\">//when not defined will be got from server using \"packageGroup\"</span></span><br><span class=\"line\">  username = getRepositoryUsername()</span><br><span class=\"line\">  password = getRepositoryPassword()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>In order to get <code>YOUR_STAGING_PROFILE</code>, we need to call the following command available in the plugin:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew getStagingProfile</span><br></pre></td></tr></table></figure>\n\n<p>When we are done, we can simply call:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew uploadArchives closeAndReleaseRepository</span><br></pre></td></tr></table></figure>\n\n<p>These two gradle tasks will upload our artifact, close and release it, so we won’t have to perform any manual steps in that process. After that, we just need to wait for the Maven sync as usual.</p>\n<p>My complete <code>release.sh</code> script looks like that:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\">./gradlew clean build <span class=\"built_in\">test</span> check uploadArchives closeAndReleaseRepository</span><br></pre></td></tr></table></figure>\n\n<p>Before upload and release, I also clean everything, build an artifact, run tests and static code analysis. It’s not required, but it’s good to do that.</p>\n<p>If you are interested in complete project configuration, you can have a look at the <a href=\"https://github.com/pwittchen/ReactiveNetwork\" target=\"_blank\" rel=\"noopener\">https://github.com/pwittchen/ReactiveNetwork</a> repository. It’s an Android library, but the same configuration can be applied to any JVM project built with Gradle. I have performed library release with this plugin a few times and it seems to work well.</p>\n","categories":[],"tags":[{"name":"java","path":"api/tags/java.json"},{"name":"open-source","path":"api/tags/open-source.json"},{"name":"gradle","path":"api/tags/gradle.json"},{"name":"library","path":"api/tags/library.json"},{"name":"release","path":"api/tags/release.json"}]}