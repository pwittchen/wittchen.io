{"title":"Cleaning root partition on Linux","slug":"cleaning-root-partition-on-linux","date":"2019-10-17T07:57:56.000Z","updated":"2019-10-17T08:02:15.030Z","comments":true,"path":"api/articles/cleaning-root-partition-on-linux.json","excerpt":null,"covers":null,"content":"<p>Size of the root partition <code>/</code> on my system is 25 GB. I recently had a situation where I received notification from the system that there’s too little free space on that partition, which was around 1 GB. My first attempt was to clean pacman cache with <code>sudo pacman -Sc</code>. It helped for a moment, but I kept receiving this notification. I searched for the solutions regarding extending the root partition and noticed that it wouldn’t be that easy and probably require making backup and reinstalling the system. Although installing Arch is not scary for me anymore, I didn’t want to do that again, because it takes some time and after that I will have to configure all my stuff, install apps, etc. which is a lot of work. Due to this fact I started search for the solutions about cleaning root partition. I found nice program called <code>ncdu</code>, which is abbreviation for NCurses Disk Usage according to the man page. You can install it with pacman: <code>sudo pacman -S ncdu</code>. This program shows usage of the directories and shows directories, which take the biggest amount of space on the disk. Once you have that program, you can go to the root partition and run it:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /</span><br><span class=\"line\">ncdu</span><br></pre></td></tr></table></figure>\n\n<p>It will do the analysis and return an interactive output with directories, size and visualisation of the size:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- / -------------------------</span><br><span class=\"line\">. 99,8 GiB  [##########] /home</span><br><span class=\"line\">.  12,1 GiB [#         ] /usr</span><br><span class=\"line\">.   7,8 GiB [          ] /var</span><br><span class=\"line\">. 689,2 MiB [          ] /opt</span><br><span class=\"line\">. 191,4 MiB [          ] /tmp</span><br><span class=\"line\">   55,0 MiB [          ] /boot</span><br><span class=\"line\">.  11,3 MiB [          ] /etc</span><br><span class=\"line\">.   1,8 MiB [          ] /run</span><br><span class=\"line\">. 912,0 KiB [          ] /dev</span><br><span class=\"line\">!  16,0 KiB [          ] /lost+found</span><br><span class=\"line\">   12,0 KiB [          ] /srv</span><br><span class=\"line\">!   4,0 KiB [          ] /root</span><br><span class=\"line\">e   4,0 KiB [          ] /mnt</span><br><span class=\"line\">.   0,0   B [          ] /proc</span><br><span class=\"line\">.   0,0   B [          ] /sys</span><br><span class=\"line\">@   0,0   B [          ]  snap</span><br><span class=\"line\">@   0,0   B [          ]  sbin</span><br><span class=\"line\">@   0,0   B [          ]  lib64</span><br><span class=\"line\">@   0,0   B [          ]  lib</span><br><span class=\"line\">@   0,0   B [          ]  bin</span><br></pre></td></tr></table></figure>\n\n<p>We can naviagte through this directories and locate places which takes space on disk, which can be free.</p>\n<p>For example, here are the contents of the <code>/usr/</code> directory:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--- /usr ------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">.   5,9 GiB [##########] /share</span><br><span class=\"line\">    5,2 GiB [########  ] /lib</span><br><span class=\"line\">  816,9 MiB [#         ] /bin</span><br><span class=\"line\">  279,8 MiB [          ] /include</span><br><span class=\"line\">   15,5 MiB [          ] /local</span><br><span class=\"line\">   13,1 MiB [          ] /src</span><br><span class=\"line\">    5,5 MiB [          ] /lib32</span><br><span class=\"line\">    2,5 MiB [          ] /doc</span><br><span class=\"line\">@   0,0   B [          ]  sbin</span><br><span class=\"line\">@   0,0   B [          ]  lib64</span><br></pre></td></tr></table></figure>\n\n<p>I’ve noticed that there were logs in <code>/var/log/journal/</code>, which have significant size. I also had a lot of downloaded packages in <code>/var/cache/pacman/</code>. As I noticed <code>pacman -Sc</code> command doesn’t clean all the cache and keeps the newest packages, so if we want to remove everything or almost everything, we can configure pacman appropriately or remove packages manually. These data could be cleaned and saved me a few GB of space, so I stopped seeing system notification. During cleanup, we can also have a look at other cache data, logs and <code>/tmp/</code> directory. To verify disk sizes and used space, we can use <code>df -H</code> command.</p>\n<p>I hope, you’ll find this tips useful and avoid resizing root partition or system re-installation.</p>\n","more":"<p>Size of the root partition <code>/</code> on my system is 25 GB. I recently had a situation where I received notification from the system that there’s too little free space on that partition, which was around 1 GB. My first attempt was to clean pacman cache with <code>sudo pacman -Sc</code>. It helped for a moment, but I kept receiving this notification. I searched for the solutions regarding extending the root partition and noticed that it wouldn’t be that easy and probably require making backup and reinstalling the system. Although installing Arch is not scary for me anymore, I didn’t want to do that again, because it takes some time and after that I will have to configure all my stuff, install apps, etc. which is a lot of work. Due to this fact I started search for the solutions about cleaning root partition. I found nice program called <code>ncdu</code>, which is abbreviation for NCurses Disk Usage according to the man page. You can install it with pacman: <code>sudo pacman -S ncdu</code>. This program shows usage of the directories and shows directories, which take the biggest amount of space on the disk. Once you have that program, you can go to the root partition and run it:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /</span><br><span class=\"line\">ncdu</span><br></pre></td></tr></table></figure>\n\n<p>It will do the analysis and return an interactive output with directories, size and visualisation of the size:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- / -------------------------</span><br><span class=\"line\">. 99,8 GiB  [##########] /home</span><br><span class=\"line\">.  12,1 GiB [#         ] /usr</span><br><span class=\"line\">.   7,8 GiB [          ] /var</span><br><span class=\"line\">. 689,2 MiB [          ] /opt</span><br><span class=\"line\">. 191,4 MiB [          ] /tmp</span><br><span class=\"line\">   55,0 MiB [          ] /boot</span><br><span class=\"line\">.  11,3 MiB [          ] /etc</span><br><span class=\"line\">.   1,8 MiB [          ] /run</span><br><span class=\"line\">. 912,0 KiB [          ] /dev</span><br><span class=\"line\">!  16,0 KiB [          ] /lost+found</span><br><span class=\"line\">   12,0 KiB [          ] /srv</span><br><span class=\"line\">!   4,0 KiB [          ] /root</span><br><span class=\"line\">e   4,0 KiB [          ] /mnt</span><br><span class=\"line\">.   0,0   B [          ] /proc</span><br><span class=\"line\">.   0,0   B [          ] /sys</span><br><span class=\"line\">@   0,0   B [          ]  snap</span><br><span class=\"line\">@   0,0   B [          ]  sbin</span><br><span class=\"line\">@   0,0   B [          ]  lib64</span><br><span class=\"line\">@   0,0   B [          ]  lib</span><br><span class=\"line\">@   0,0   B [          ]  bin</span><br></pre></td></tr></table></figure>\n\n<p>We can naviagte through this directories and locate places which takes space on disk, which can be free.</p>\n<p>For example, here are the contents of the <code>/usr/</code> directory:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--- /usr ------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">.   5,9 GiB [##########] /share</span><br><span class=\"line\">    5,2 GiB [########  ] /lib</span><br><span class=\"line\">  816,9 MiB [#         ] /bin</span><br><span class=\"line\">  279,8 MiB [          ] /include</span><br><span class=\"line\">   15,5 MiB [          ] /local</span><br><span class=\"line\">   13,1 MiB [          ] /src</span><br><span class=\"line\">    5,5 MiB [          ] /lib32</span><br><span class=\"line\">    2,5 MiB [          ] /doc</span><br><span class=\"line\">@   0,0   B [          ]  sbin</span><br><span class=\"line\">@   0,0   B [          ]  lib64</span><br></pre></td></tr></table></figure>\n\n<p>I’ve noticed that there were logs in <code>/var/log/journal/</code>, which have significant size. I also had a lot of downloaded packages in <code>/var/cache/pacman/</code>. As I noticed <code>pacman -Sc</code> command doesn’t clean all the cache and keeps the newest packages, so if we want to remove everything or almost everything, we can configure pacman appropriately or remove packages manually. These data could be cleaned and saved me a few GB of space, so I stopped seeing system notification. During cleanup, we can also have a look at other cache data, logs and <code>/tmp/</code> directory. To verify disk sizes and used space, we can use <code>df -H</code> command.</p>\n<p>I hope, you’ll find this tips useful and avoid resizing root partition or system re-installation.</p>\n","categories":[],"tags":[{"name":"linux","path":"api/tags/linux.json"}]}