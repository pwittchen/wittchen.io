{"title":"Separate execution of unit and integration tests in Gradle","slug":"separate-execution-of-unit-and-integration-tests-in-gradle","date":"2018-09-22T14:51:47.000Z","updated":"2019-07-03T22:51:02.813Z","comments":true,"path":"api/articles/separate-execution-of-unit-and-integration-tests-in-gradle.json","excerpt":null,"covers":null,"content":"<p>During development process, we often write unit and integration tests. While unit tests verify corectness of the small pieces of code, integration tests verify software as a whole project and sometimes can treat it as a black box where concrete results are expected. During development of the REST API, we can write integration tests for such API with <a href=\"https://github.com/rest-assured/rest-assured\" target=\"_blank\" rel=\"noopener\">REST Assured</a>. Integration tests are usually slower, because they need to start the server and sometimes do other stuff. That’s why it’s good to separate their execution from regular unit tests. On the CI server we can even have separate job for them.</p>\n<p>We can define the following project structure:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ src</span><br><span class=\"line\">|</span><br><span class=\"line\">+- main</span><br><span class=\"line\">|  |</span><br><span class=\"line\">|  +- java</span><br><span class=\"line\">|    |</span><br><span class=\"line\">|    +- com ...</span><br><span class=\"line\">|</span><br><span class=\"line\">+- test</span><br><span class=\"line\">  |</span><br><span class=\"line\">  +- java</span><br><span class=\"line\">    |</span><br><span class=\"line\">    +- com ... (unit tests)</span><br><span class=\"line\">    |</span><br><span class=\"line\">    +- integration (integration tests)</span><br></pre></td></tr></table></figure>\n\n<p>In the <code>java/com/</code> directory we can put unit tests and in the <code>integration/</code> directory we can put integration tests.</p>\n<p>Now, we can prepare the following configuration in the <code>build.gradle</code>:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (System.properties[<span class=\"string\">'test.profile'</span>] != <span class=\"string\">'integration'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">exclude</span> <span class=\"string\">'**/*integration*'</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">exclude</span> <span class=\"string\">'**/*com/*'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>As you can see, when <code>test.profile</code> is different than <code>integration/</code>, we’re excluding <code>integration/</code> directory from tests. Otherwise, we’re excluding <code>com/</code> directory.</p>\n<p>Now, when we want to execute unit tests only, we can type the following command:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew test</span><br></pre></td></tr></table></figure>\n\n<p>but when we want to run unit test, we can type:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew test -Dtest.profile=integration</span><br></pre></td></tr></table></figure>\n\n<p>When we want to execute all tests, we can redefine configuration above, write another gradle task or perform one execution after another:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew test &amp;&amp; ./gradlew test -Dtest.profile=integration</span><br></pre></td></tr></table></figure>\n\n<p>That’s it!</p>\n","more":"<p>During development process, we often write unit and integration tests. While unit tests verify corectness of the small pieces of code, integration tests verify software as a whole project and sometimes can treat it as a black box where concrete results are expected. During development of the REST API, we can write integration tests for such API with <a href=\"https://github.com/rest-assured/rest-assured\" target=\"_blank\" rel=\"noopener\">REST Assured</a>. Integration tests are usually slower, because they need to start the server and sometimes do other stuff. That’s why it’s good to separate their execution from regular unit tests. On the CI server we can even have separate job for them.</p>\n<p>We can define the following project structure:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ src</span><br><span class=\"line\">|</span><br><span class=\"line\">+- main</span><br><span class=\"line\">|  |</span><br><span class=\"line\">|  +- java</span><br><span class=\"line\">|    |</span><br><span class=\"line\">|    +- com ...</span><br><span class=\"line\">|</span><br><span class=\"line\">+- test</span><br><span class=\"line\">  |</span><br><span class=\"line\">  +- java</span><br><span class=\"line\">    |</span><br><span class=\"line\">    +- com ... (unit tests)</span><br><span class=\"line\">    |</span><br><span class=\"line\">    +- integration (integration tests)</span><br></pre></td></tr></table></figure>\n\n<p>In the <code>java/com/</code> directory we can put unit tests and in the <code>integration/</code> directory we can put integration tests.</p>\n<p>Now, we can prepare the following configuration in the <code>build.gradle</code>:</p>\n<figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (System.properties[<span class=\"string\">'test.profile'</span>] != <span class=\"string\">'integration'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">exclude</span> <span class=\"string\">'**/*integration*'</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">exclude</span> <span class=\"string\">'**/*com/*'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>As you can see, when <code>test.profile</code> is different than <code>integration/</code>, we’re excluding <code>integration/</code> directory from tests. Otherwise, we’re excluding <code>com/</code> directory.</p>\n<p>Now, when we want to execute unit tests only, we can type the following command:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew test</span><br></pre></td></tr></table></figure>\n\n<p>but when we want to run unit test, we can type:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew test -Dtest.profile=integration</span><br></pre></td></tr></table></figure>\n\n<p>When we want to execute all tests, we can redefine configuration above, write another gradle task or perform one execution after another:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./gradlew test &amp;&amp; ./gradlew test -Dtest.profile=integration</span><br></pre></td></tr></table></figure>\n\n<p>That’s it!</p>\n","categories":[],"tags":[{"name":"java","path":"api/tags/java.json"},{"name":"gradle","path":"api/tags/gradle.json"},{"name":"testing","path":"api/tags/testing.json"}]}