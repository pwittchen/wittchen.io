<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Poor Man&#39;s Dropbox · Piotr Wittchen</title><meta name="description" content="Poor Man&amp;#39;s Dropbox - Piotr Wittchen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400"><link rel="search" type="application/opensearchdescription+xml" href="http://wittchen.io/atom.xml" title="Piotr Wittchen"><link rel="alternate" href="/feed.xml" title="Piotr Wittchen" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><div>Piotr Wittchen</div></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">WRITING</a></li><li class="nav-list-item"><a href="/code" target="_self" class="nav-list-link">CODE</a></li><li class="nav-list-item"><a href="/projects" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/talks" target="_self" class="nav-list-link">TALKS</a></li><li class="nav-list-item"><a href="/contact" target="_self" class="nav-list-link">CONTACT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Poor Man&#39;s Dropbox</h1><div class="post-info">Aug 12, 2018</div><div class="post-content"><h2 id="Dropbox-abandons-Linux-users"><a href="#Dropbox-abandons-Linux-users" class="headerlink" title="Dropbox abandons Linux users"></a>Dropbox abandons Linux users</h2><p>Recently, I’ve started receiving a notification from Dropbox desktop app on Linux that they’ll stop syncing my files in November. I couldn’t understand why. I’m using this service for some time and I find it really useful. Moreover, I want to backup several important files on the web server in case of my disk crashes or I’ll need to access them from another computer or mobile device. I googled this issue and found pretty long thread on the <a href="https://www.dropboxforum.com/t5/Syncing-and-uploads/Dropbox-client-warns-me-that-it-ll-stop-syncing-in-Nov-why/td-p/290058" target="_blank" rel="noopener">Dropbox Forum</a>. There’s also <a href="https://www.reddit.com/r/linux/comments/966xt0/linux_dropbox_client_will_stop_syncing_on_any/" target="_blank" rel="noopener">ongoing discussion on reddit</a>.</p>
<p>If you don’t want to read all of this stuff, I can make a short summary:</p>
<ul>
<li>Dropbox app will support the following file systems: NTFS for Windows, HFS+ or APFS for Mac, and Ext4 for Linux</li>
<li>Dropbox app will not support encrypted directories even if you’re using Ext4 file system on Linux</li>
</ul>
<p>I had a few options:</p>
<ul>
<li>leave my Dropbox directory unencrypted</li>
<li>switch to another OS</li>
<li>change service provider to something else</li>
<li>create my own solution</li>
</ul>
<p>I’m not going to change my OS now and existing alternatives to Dropbox aren’t good enough.</p>
<h2 id="Preparing-Poor-Man’s-Dropbox"><a href="#Preparing-Poor-Man’s-Dropbox" class="headerlink" title="Preparing Poor Man’s Dropbox"></a>Preparing Poor Man’s Dropbox</h2><p>I’ve decided to create Poor Man’s Dropbox with <code>bash</code>, <code>lftp</code> and <code>cron</code>. I think it’s nice opportunity to learn something new and solve my own problem at the same time. I have my own personal FTP server where I host my website. This server has about 4 GB of disk space. I’m not using all of this space because my website has only text and maybe a few small pics. I also store my photos on the local drive, Google Photos and external physical drive and I’m not going to backup them on the FTP server. I’d like to backup a several dirs with documents, config files, text files and spreadsheets. In such case, mentioned amount of disk space is enough.</p>
<p>In the beginning, I’ve created a special directory for backup in my local file system: <code>~/Backup/</code>.<br>Next, I’ve created <code>backup/</code> directory on the FTP server.</p>
<p>After that, I’ve prepared <code>make_ftp_backup</code> script:</p>
<h3 id="Backup-script"><a href="#Backup-script" class="headerlink" title="Backup script"></a>Backup script</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"starting backup process"</span></span><br><span class="line"></span><br><span class="line">rm -rf ~/Backup/*</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"preparing directories to backup"</span></span><br><span class="line"></span><br><span class="line">cp -avr ~/Dokumenty/finance ~/Backup/finance</span><br><span class="line">cp -avr ~/Dokumenty/gym ~/Backup/gym</span><br><span class="line">cp -avr ~/Dokumenty/licenses ~/Backup/licenses</span><br><span class="line">cp -avr ~/Dokumenty/secret ~/Backup/secret</span><br><span class="line">cp -avr ~/Dokumenty/sonatype ~/Backup/sonatype</span><br><span class="line">cp -avr ~/Dokumenty/presentations ~/Backup/presentations</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"uploading data to the FTP server"</span></span><br><span class="line"></span><br><span class="line">USER=your-user</span><br><span class="line">PASS=your-password</span><br><span class="line">HOST=your-host.com</span><br><span class="line"></span><br><span class="line">lftp ftp://<span class="variable">$USER</span>:<span class="variable">$PASS</span>@<span class="variable">$HOST</span> -e <span class="string">"set ftp:ssl-allow no; mirror -R -v --delete-first ~/Backup backup; quit"</span></span><br><span class="line"></span><br><span class="line">date &gt;&gt; ~/Dokumenty/logs/ftp_backup.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"backup process finished"</span></span><br></pre></td></tr></table></figure>

<p>Once I had my script ready, I made it executable: <code>chmod +x make_ftp_backup</code><br>and placed it in <code>/usr/local/bin/</code> directory.</p>
<p>Now, I could test it by typing the following command in the terminal: <code>make_ftp_backup</code>.</p>
<p>Script is pretty simple. It deletes old backup files from the local directory, copies updated files to this directory, removes old files on the FTP server and uploads fresh backup files to the server.</p>
<h3 id="Scheduling-backup"><a href="#Scheduling-backup" class="headerlink" title="Scheduling backup"></a>Scheduling backup</h3><p>Of course, I’m not going to make backups manually, so I used <code>cron</code> to automate this job.<br>I’ve typed <code>crontab -e</code> to define new cron job via <code>vim</code> (you can use any editor of your choice).</p>
<p>It looks as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Backup my important files to my FTP server every hour at minute zero</span><br><span class="line">0 * * * * /usr/local/bin/make_ftp_backup</span><br></pre></td></tr></table></figure>

<p>Please note, we should not rely on <code>$PATH</code> or other environmental variables in <code>crontab</code> because most of them are ignored by this service. That’s why I provided complete path to the script.</p>
<p>We can list our cron jobs by typing <code>crontab -l</code>.</p>
<p>After editing, we could call:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service cron reload</span><br></pre></td></tr></table></figure>

<p>or (if it didn’t work):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service cron restart</span><br></pre></td></tr></table></figure>

<p>Cron job should work start working without it, but in case of problems, you can invoke that commands.</p>
<p>As you can see in the comments, I’m running my script every hour every day at minute zero.<br>I’ve found <a href="https://www.youtube.com/watch?v=QZJ1drMQz1A" target="_blank" rel="noopener">very nice video explaining how to use cron</a>. If you’re not familiar with it, check this link.<br>Author of the video created <a href="https://github.com/CoreyMSchafer/code_snippets/tree/master/Cron-Tasks" target="_blank" rel="noopener">useful code snippets</a> explaining crontab syntax.</p>
<p>Reference information for cron jobs placed there looks as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># ┌───────────── minute (0 - 59)</span><br><span class="line"># │ ┌───────────── hour (0 - 23)</span><br><span class="line"># │ │ ┌───────────── day of month (1 - 31)</span><br><span class="line"># │ │ │ ┌───────────── month (1 - 12)</span><br><span class="line"># │ │ │ │ ┌───────────── day of week (0 - 6) (Sunday to Saturday;</span><br><span class="line"># │ │ │ │ │                                   7 is also Sunday on some systems)</span><br><span class="line"># │ │ │ │ │</span><br><span class="line"># │ │ │ │ │</span><br><span class="line"># * * * * *  command_to_execute</span><br></pre></td></tr></table></figure>

<p>It really helps for preparing new cron jobs schedule. You can also visit <a href="http://crontab.guru/" target="_blank" rel="noopener">crontab.guru</a> website to test your cron jobs definitions. It’s also good to read more about <a href="https://serverfault.com/questions/449651/why-is-my-crontab-not-working-and-how-can-i-troubleshoot-it" target="_blank" rel="noopener">troubleshooting crontab</a> in case of encountering any problems.</p>
<h3 id="Copying-data-from-the-server-to-the-local-directory"><a href="#Copying-data-from-the-server-to-the-local-directory" class="headerlink" title="Copying data from the server to the local directory"></a>Copying data from the server to the local directory</h3><p>Solution above just uploads local files to the remote server. Sometimes we may want to add some data from another computer or mobile device and access them later on the local computer. We shouldn’t place this data to the <code>backup</code> directory because it may be overriden by the backup script. To solve this problem, we can create <code>input</code> directory on the remote server and <code>input</code> directory in the local file system. After that, we can create <code>get_ftp_input</code> script, which will copy remote directory to local file system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">USER=your-user</span><br><span class="line">PASS=your-password</span><br><span class="line">HOST=your-host.com</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"downloading input from the server"</span></span><br><span class="line"></span><br><span class="line">lftp ftp://<span class="variable">$USER</span>:<span class="variable">$PASS</span>@<span class="variable">$HOST</span> -e <span class="string">"set ftp:ssl-allow no; mirror -v input ~/Dokumenty/input; quit"</span></span><br><span class="line"></span><br><span class="line">date &gt;&gt; ~/Dokumenty/logs/ftp_input.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"download complete"</span></span><br></pre></td></tr></table></figure>

<p>It’s not real synchronization like in the Dropbox, but at least we have simple way add new files to the local computer from the different device with Internet access and FTP client. We can add this script to the crontab too, if we want to.</p>
<h3 id="Accessing-files-on-the-go"><a href="#Accessing-files-on-the-go" class="headerlink" title="Accessing files on the go"></a>Accessing files on the go</h3><p>On my Android phone, I’m using <a href="https://play.google.com/store/apps/details?id=pl.solidexplorer2" target="_blank" rel="noopener">Solid Explorer app</a> for browsing files and directories. It’s really good app and it has FTP client built-in, so I can access my backup folder from my mobile phone if I need to.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>I know this solution is far from perfect (I call it poor myself) and it doesn’t handle two way synchronization, but at least I have full control over it and nobody tells me what file system or operating system I have to use or what I need to leave encrypted or unencrypted. It’s clean, simple and fine for me now. Maybe I’ll enhance this solution some day. E.g. I can add a new script performing backup whenever I change any file in defined list of directories. In order to do that, I’ll need a file watcher running as a system service in the background. The biggest room is the room for improvement.</p>
</div></article></div></main><footer><div class="paginator"><a href="/solving-problems-with-avd-and-kvm-on-linux/" class="prev">PREV</a><a href="/squashing-commits/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'wittchenio';
var disqus_identifier = 'poor-mans-dropbox/';
var disqus_title = 'Poor Man&amp;#39;s Dropbox';
var disqus_url = 'http://wittchen.io/poor-mans-dropbox/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//undefined.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2019 <a href="http://wittchen.io">Piotr Wittchen</a></p><p><a href="https://github.com/pwittchen/wittchen.io">source</a> / <a href="https://stats.uptimerobot.com/ZwxAGU5rxy">uptime</a> / <a href="/feed.xml">rss</a> / <a href="/archives">writing</a> / <a href="/tags">tags</a> / <a href="https://github.com/pwittchen/wittchen.io#rest">api</a> / <a href="/gh">github</a> / <a href="/so">stackoverflow</a> / <a href="/in">linkedin</a> / <a href="mailto:piotr@wittchen.io">email</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-2194664-7",'auto');ga('send','pageview');</script></body></html>